{
  "hash": "757c4172d5a0ac9ee89dfdca450981bb",
  "result": {
    "markdown": "---\ntitle: \"Correlations in R\"\nauthor: \"Arvind Venkatadri\"\ndate: \"2023-01-12\"\noutput:\n  html_document:\n    theme: flatly\n    toc: TRUE\n    toc_float: TRUE\n    toc_depth: 2\n    df_print: paged\n    number_sections: TRUE\n    code_folding: show\n    code_download: TRUE\n---\n\n\n# Introduction\n\nWe will craate Tables for Correlations, and graphs for Correlations in\nR. As always, we will consistently use the [**Project\nMosaic**](https://mosaic-web.org) ecosystem of packages in R (`mosaic`,\n`mosaicData` and `ggformula`).\n\n\n::: {.cell}\n\n:::\n\n\n::: {#note .illustration style=\"background: beige\"}\nNote the standard method for all commands from the `mosaic` package:\n\ngoal( y \\~ x \\| z, data = mydata, ...)\n:::\n\n## Case Study -1: Dataset from `mosaicData`\n\nLet us inspect what datasets are available in the package `mosaicData`.\nRun this command in your Console:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run in Console\ndata(package = \"mosaicData\")\n\n```\n:::\n\n\nThe popup tab shows a lot of datasets we could use. Let us continue to\nuse the famous `Galton` dataset and `inspect` it:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"Galton\")\ninspect(Galton)\n#> \n#> categorical variables:  \n#>     name  class levels   n missing\n#> 1 family factor    197 898       0\n#> 2    sex factor      2 898       0\n#>                                    distribution\n#> 1 185 (1.7%), 166 (1.2%), 66 (1.2%) ...        \n#> 2 M (51.8%), F (48.2%)                         \n#> \n#> quantitative variables:  \n#>     name   class min Q1 median   Q3  max      mean       sd   n missing\n#> 1 father numeric  62 68   69.0 71.0 78.5 69.232851 2.470256 898       0\n#> 2 mother numeric  58 63   64.0 65.5 70.5 64.084410 2.307025 898       0\n#> 3 height numeric  56 64   66.5 69.7 79.0 66.760690 3.582918 898       0\n#> 4  nkids integer   1  4    6.0  8.0 15.0  6.135857 2.685156 898       0\n```\n:::\n\n\nThe `inspect` command already gives us a series of statistical measures\nof different variables of interest. As discussed previously, we can\nretain the output of `inspect` and use it in our reports: (there are\nways of dressing up these tables too)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\ngalton_describe <- inspect(Galton)\n\ngalton_describe$categorical\n#> # A tibble: 2 × 6\n#>   name   class  levels     n missing distribution                               \n#>   <chr>  <chr>   <int> <int>   <int> <chr>                                      \n#> 1 family factor    197   898       0 \"185 (1.7%), 166 (1.2%), 66 (1.2%) ...    …\n#> 2 sex    factor      2   898       0 \"M (51.8%), F (48.2%)                     …\ngalton_describe$quantitative\n#> # A tibble: 4 × 11\n#>   name   class     min    Q1 median    Q3   max  mean    sd     n missing\n#> * <chr>  <chr>   <dbl> <dbl>  <dbl> <dbl> <dbl> <dbl> <dbl> <int>   <int>\n#> 1 father numeric    62    68   69    71    78.5 69.2   2.47   898       0\n#> 2 mother numeric    58    63   64    65.5  70.5 64.1   2.31   898       0\n#> 3 height numeric    56    64   66.5  69.7  79   66.8   3.58   898       0\n#> 4 nkids  integer     1     4    6     8    15    6.14  2.69   898       0\n```\n:::\n\n\nTry `help(\"Galton\")` in your Console. The dataset is described as:\n\n> A data frame with 898 observations on the following variables.\\\n> - `family` a factor with levels for each family\\\n> - `father` the father's height (in inches)\\\n> - `mother` the mother's height (in inches)\\\n> - `sex` the child's sex: F or M\\\n> - `height` the child's height as an adult (in inches)\\\n> - `nkids` the number of adult children in the family, or, at least,\n> the number whose heights Galton recorded.\n\nThere is a lot of Description generated by the `mosaic::inspect()`\ncommand ! What can we say about the dataset and its variables? How big\nis the dataset? How many variables? What types are they, Quant or Qual?\nIf they are Qual, what are the *levels*? Are they *ordered* levels?\nDiscuss!\n\n## Correlations and Plots\n\nWhat Questions might we have, that we could answer with a Statistical\nMeasure, or Correlation chart?\n\nQ.1 Which are the variables that have significant pair-wise\ncorrelations? What polarity are these correlations?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n\n# Pulling out the list of Quant variables from NHANES\ngalton_quant <- galton_describe$quantitative\ngalton_quant$name\n#> [1] \"father\" \"mother\" \"height\" \"nkids\"\n\nGGally::ggpairs(\n  Galton,\n  columns = c(\"father\", \"mother\", \"height\", \"nkids\"),\n  diag = list(\"densityDiag\"),\n  title = \"Galton Data Correlations Plot\"\n)\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nCan we plot a Correlogram for this dataset?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#library(corrplot)\n\ngalton_num_var <- Galton %>% select(father, mother, height, nkids)\ngalton_cor <- cor(galton_num_var)\ngalton_correlogram <- galton_cor %>%\n  corrplot(method = \"ellipse\",\n           type = \"lower\",\n           main = \"Correlogram for Galton dataset\")\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\ngalton_correlogram\n#> $corr\n#>             father      mother     height       nkids\n#> father  1.00000000  0.07366461  0.2753548 -0.16002294\n#> mother  0.07366461  1.00000000  0.2016549 -0.02002964\n#> height  0.27535483  0.20165489  1.0000000 -0.12691012\n#> nkids  -0.16002294 -0.02002964 -0.1269101  1.00000000\n#> \n#> $corrPos\n#>     xName  yName x y        corr\n#> 1  father father 1 4  1.00000000\n#> 2  father mother 1 3  0.07366461\n#> 3  father height 1 2  0.27535483\n#> 4  father  nkids 1 1 -0.16002294\n#> 5  mother mother 2 3  1.00000000\n#> 6  mother height 2 2  0.20165489\n#> 7  mother  nkids 2 1 -0.02002964\n#> 8  height height 3 2  1.00000000\n#> 9  height  nkids 3 1 -0.12691012\n#> 10  nkids  nkids 4 1  1.00000000\n#> \n#> $arg\n#> $arg$type\n#> [1] \"lower\"\n```\n:::\n\n\nClearly `height` is positvely correlated to `father` and `mother`;\ninterestingly, `height` is negatively correlated ( slightly) with\n`nkids`.\n\nQ.2: Let us confirm with a test:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmosaic::cor_test(height ~ father, data = Galton)\n#> \n#> \tPearson's product-moment correlation\n#> \n#> data:  height and father\n#> t = 8.5737, df = 896, p-value < 2.2e-16\n#> alternative hypothesis: true correlation is not equal to 0\n#> 95 percent confidence interval:\n#>  0.2137851 0.3347455\n#> sample estimates:\n#>       cor \n#> 0.2753548\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmosaic::cor_test(height ~ mother, data = Galton)\n#> \n#> \tPearson's product-moment correlation\n#> \n#> data:  height and mother\n#> t = 6.1628, df = 896, p-value = 1.079e-09\n#> alternative hypothesis: true correlation is not equal to 0\n#> 95 percent confidence interval:\n#>  0.1380554 0.2635982\n#> sample estimates:\n#>       cor \n#> 0.2016549\n```\n:::\n\n\nQ.3 What does this correlation look when split by `sex` of Child?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n# For the sons\ncor_test(height ~ father, data = Galton %>% filter(sex == \"M\"))\n#> \n#> \tPearson's product-moment correlation\n#> \n#> data:  height and father\n#> t = 9.1498, df = 463, p-value < 2.2e-16\n#> alternative hypothesis: true correlation is not equal to 0\n#> 95 percent confidence interval:\n#>  0.3114667 0.4656805\n#> sample estimates:\n#>       cor \n#> 0.3913174\ncor_test(height ~ mother, data = Galton %>% filter(sex == \"M\"))\n#> \n#> \tPearson's product-moment correlation\n#> \n#> data:  height and mother\n#> t = 7.628, df = 463, p-value = 1.367e-13\n#> alternative hypothesis: true correlation is not equal to 0\n#> 95 percent confidence interval:\n#>  0.2508178 0.4125305\n#> sample estimates:\n#>       cor \n#> 0.3341309\n\n# For the daughters\ncor_test(height ~ father, data = Galton %>% filter(sex == \"F\"))\n#> \n#> \tPearson's product-moment correlation\n#> \n#> data:  height and father\n#> t = 10.719, df = 431, p-value < 2.2e-16\n#> alternative hypothesis: true correlation is not equal to 0\n#> 95 percent confidence interval:\n#>  0.3809944 0.5300812\n#> sample estimates:\n#>       cor \n#> 0.4587605\ncor_test(height ~ mother, data = Galton %>% filter(sex == \"F\"))\n#> \n#> \tPearson's product-moment correlation\n#> \n#> data:  height and mother\n#> t = 6.8588, df = 431, p-value = 2.421e-11\n#> alternative hypothesis: true correlation is not equal to 0\n#> 95 percent confidence interval:\n#>  0.2261463 0.3962226\n#> sample estimates:\n#>       cor \n#> 0.3136984\n```\n:::\n\n\nQ.4. How can we show this correlation in a set of Scatter Plots +\nRegression Lines? Can we recreate Galton's famous diagram?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For the sons\ngf_point(height ~ father, data = Galton %>% filter(sex == \"M\")) %>% gf_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\ngf_point(height ~ mother, data = Galton %>% filter(sex == \"M\")) %>% gf_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# For the daughters\ngf_point(height ~ father, data = Galton %>% filter(sex == \"F\")) %>% gf_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n\n```{.r .cell-code}\ngf_point(height ~ mother, data = Galton %>% filter(sex == \"F\")) %>% gf_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-9-4.png){width=672}\n:::\n:::\n\n\nAn approximation to Galton's famous plot (see Wikipedia):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngf_point(height ~ (father + mother)/2, data = Galton) %>% gf_smooth(method = \"lm\") %>% gf_density_2d(n = 8) %>% gf_abline(slope = 1)\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nHow would you interpret this plot?\n\n## Case Study -2: Dataset from `NHANES`\n\nWe will \"live code\" this in class!\n\n# Conclusion\n\nWe have a decent Correlations related *workflow* in R:\\\n- load the dataset\\\n- `inspect` the dataset, identify Quant and Qual variables\\\n- Develop Pair-Wise plots + Correlations using `GGally::ggpairs()`\\\n- Develop Correlogram `corrplot::corrplot`\\\n- Check everything with a `cor_test`\\\n- Plot scatter plots using `gf_point` if needed.\\\n- Add extra lines using `gf_abline()` to compare hypotheses that you may\nhave.\n",
    "supporting": [
      "correlations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}