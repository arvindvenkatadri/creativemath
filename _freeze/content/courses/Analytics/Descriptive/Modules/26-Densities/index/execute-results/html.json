{
  "hash": "1bf127edddbb0f086ac93222dc107444",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"\\U0001F4CA Densities: Plotting Distributions\"\nsubtitle: \"The Hills are Shadows, said Tennyson\"\nauthor: \"Arvind V.\"\ndate: 22/Jun/2024\ndate-modified: \"2024-07-19\"\nabstract: \"Quant and Qual Variable Graphs and their Siblings\"\norder: 26\nimage: preview.jpg\nimage-alt: Image by rawpixel.com\ndf-print: paged\ncategories:\n- Quant Variables\n- Qual Variables\n- Density Plots\n- Ridge Plots\nbibliography: \n  - references.bib\n  - grateful-refs.bib\ncitation: true\n#suppress-bibliography: true\n# editor: \n#   markdown: \n#     wrap: 72\nwebr:\n  packages: ['readr', 'tidyr', 'dplyr','mosaic', 'skimr', 'ggformula','ggridges', 'palmerpenguins']\n\n---\n\n\n\n\n## {{< fa folder-open >}} Slides and Tutorials\n\n|                                                                                                 |                                                                                                    |                                                                                        |\n|------------------------|------------------------|------------------------|\n| <a href=\"./files/distributions.qmd\"><i class=\"fa-brands fa-r-project\"></i> R (Static Viz)</a>   | <a href=\"./files/distributions.rda\"> <i class=\"fa-solid fa-person-rays\"></i> Radiant Tutorial</a>  | <a href=\"./files/data/qdd-data.zip\"> <i class=\"fa-solid fa-database\"></i> Datasets</a> |\n\n## {{< iconify noto-v1 package >}} Setting up R Packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(paged.print = TRUE)\nlibrary(tidyverse)\nlibrary(mosaic)\nlibrary(ggformula)\n\n#install.packages(\"remotes\")\n#library(remotes)\n#remotes::install_github(\"wilkelab/ggridges\")\nlibrary(ggridges)\nlibrary(skimr)\n\nlibrary(palmerpenguins) # Our new favourite dataset\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n## {{< iconify fxemoji japanesesymbolforbeginner >}} What graphs will we see today?\n\n| Variable #1 | Variable #2 | Chart Names |                    Chart Shape    | \n|:-------------:|:--------------:|:------------------:|:--------------------:|:------:|\n|    Quant    |    None     |  Density plot, Ridge Density Plot  | {{< iconify  mdi chart-bell-curve size=4x >}} |\n\n\n## {{< iconify tabler variable >}} What kind of Data Variables will we choose?\n\n::: column-page-inset-right\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> No </th>\n   <th style=\"text-align:left;\"> Pronoun </th>\n   <th style=\"text-align:left;\"> Answer </th>\n   <th style=\"text-align:left;\"> Variable/Scale </th>\n   <th style=\"text-align:left;\"> Example </th>\n   <th style=\"text-align:left;\"> What Operations? </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> How Many / Much / Heavy? Few? Seldom? Often? When? </td>\n   <td style=\"text-align:left;\"> Quantities, with Scale and a Zero Value.Differences and Ratios /Products are meaningful. </td>\n   <td style=\"text-align:left;\"> Quantitative/Ratio </td>\n   <td style=\"text-align:left;\"> Length,Height,Temperature in Kelvin,Activity,Dose Amount,Reaction Rate,Flow Rate,Concentration,Pulse,Survival Rate </td>\n   <td style=\"text-align:left;\"> Correlation </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n:::\n\n## {{< iconify  mdi chart-bell-curve >}} What is a \"Density Plot\"?\n\nAs we saw earlier, **Histograms** are best to show the distribution of raw **Quantitative data**, by displaying the number of values that fall within defined ranges, often called *buckets* or *bins*. \n\nSometimes it is useful to consider a chart where the *bucket width* shrinks to zero! \n\nYou might imagine a density chart as a histogram where the buckets are\ninfinitesimally small, i.e. zero width. Think of the frequency density as a [differentiation (as in calculus)]() of the histogram. By taking the smallest of steps $\\sim 0$, we get a measure of the *slope* of distribution. This may seem counter-intuitive,\nbut densities have their uses in spotting the ranges in the data where\nthere are more frequent values. In this, they serve a similar purpose as\ndo histograms, but may offer insights not readily apparent with\nhistograms, especially with default bucket widths. The *chunkiness* that we see in the histograms is removed and gives us a smooth curve showing in which *range* the data are more *frequent*. \n\n## {{< iconify grommet-icons test >}} Case Study-1: `penguins` dataset\n\nWe will first look at at a dataset that is directly available in R, the\n`penguins` dataset.\n\n### {{< iconify file-icons influxdata >}} Examine the Data\n\nAs per our Workflow, we will look at the data using all the three\nmethods we have seen.\n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke;\"}\n\n### {{< iconify la r-project >}} R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <fct> male, female, female, NA, female, male, female, male…\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(penguins)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |         |\n|:------------------------|:--------|\n|Name                     |penguins |\n|Number of rows           |344      |\n|Number of columns        |8        |\n|_______________________  |         |\n|Column type frequency:   |         |\n|factor                   |3        |\n|numeric                  |5        |\n|________________________ |         |\n|Group variables          |None     |\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts                  |\n|:-------------|---------:|-------------:|:-------|--------:|:---------------------------|\n|species       |         0|          1.00|FALSE   |        3|Ade: 152, Gen: 124, Chi: 68 |\n|island        |         0|          1.00|FALSE   |        3|Bis: 168, Dre: 124, Tor: 52 |\n|sex           |        11|          0.97|FALSE   |        2|mal: 168, fem: 165          |\n\n\n**Variable type: numeric**\n\n|skim_variable     | n_missing| complete_rate|    mean|     sd|     p0|     p25|     p50|    p75|   p100|hist  |\n|:-----------------|---------:|-------------:|-------:|------:|------:|-------:|-------:|------:|------:|:-----|\n|bill_length_mm    |         2|          0.99|   43.92|   5.46|   32.1|   39.23|   44.45|   48.5|   59.6|▃▇▇▆▁ |\n|bill_depth_mm     |         2|          0.99|   17.15|   1.97|   13.1|   15.60|   17.30|   18.7|   21.5|▅▅▇▇▂ |\n|flipper_length_mm |         2|          0.99|  200.92|  14.06|  172.0|  190.00|  197.00|  213.0|  231.0|▂▇▃▅▂ |\n|body_mass_g       |         2|          0.99| 4201.75| 801.95| 2700.0| 3550.00| 4050.00| 4750.0| 6300.0|▃▇▆▃▂ |\n|year              |         0|          1.00| 2008.03|   0.82| 2007.0| 2007.00| 2008.00| 2009.0| 2009.0|▇▁▇▁▇ |\n\n\n:::\n:::\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n\n```{webr-r}\n#| label: glimpse-penguins-webr\nglimpse(penguins)\n\n```\n\n```{webr-r}\n#| label: skim-penguins-webr\nskim(penguins)\n\n```\n\n\n:::\n\n\n::: callout-note\n### Business Insights on Examining the `penguins` dataset\n\n-   This is a smallish dataset (344 rows, 8 columns).\n-   There are several Qualitative variables: `species`, `island` and\n    `sex`. These have 3, 3, and 2 levels respectively. They are all `<fct>`, i.e. factors. \n\n-   `bill_length_mm`, `bill_length_mm`, `flipper_length_mm`, and `body_mass_g  ` are\n    Quantitative variables.\n-   There are a few missing values in `sex`(11 missing entries) and all the Quant variables (2 missing entries each).\n:::\n\n\n\n\n### {{< iconify mdi chart-bell-curve >}} Plotting Densities\n\n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke;\"}\n\n\n### Using ggformula\n\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\npenguins <- penguins %>% drop_na()\n\ngf_density( ~ body_mass_g, data = penguins) %>%\n  gf_labs(title = \"Plot A: Penguin Masses\", caption = \"ggformula\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggformula-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\npenguins %>% gf_density( ~ body_mass_g, fill = ~ species, color = \"black\") %>%\n  gf_refine(scale_color_viridis_d(option = \"magma\", aesthetics = c(\"colour\", \"fill\"))) %>%\n  gf_labs(title = \"Plot B: Penguin Body Mass by Species\", caption = \"ggformula\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggformula-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\npenguins %>%\n  gf_density(\n    ~ body_mass_g,\n    fill = ~ species,\n    color = \"black\",\n    alpha = 0.3\n  ) %>%\n  gf_facet_wrap(vars(sex)) %>%\n  gf_labs(title = \"Plot C: Penguin Body Mass by Species and facetted by Sex\", caption = \"ggformula\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggformula-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\npenguins %>%\n  gf_density( ~ body_mass_g, fill = ~ species, color = \"black\") %>%\n  gf_facet_wrap(vars(sex), scales = \"free_y\", nrow = 2) %>%\n  gf_labs(title = \"Plot D: Penguin Body Mass by Species and facetted by Sex\",\n          subtitle = \"Free y-scale\",\n          caption = \"ggformula\") %>%\n  gf_theme(theme(axis.text.x = element_text(angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggformula-4.png){width=2100}\n:::\n:::\n\n\n\n\n### Using ggplot\n\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n## Remove the rows containing NA (11 rows!)\npenguins <- penguins %>% drop_na()\n\nggplot(data = penguins) + \n  geom_density(aes(x = body_mass_g)) + \n  labs(title = \"Plot A: Penguin Masses\",caption = \"ggplot\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggplot-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\npenguins %>% \n  ggplot() + \n  geom_density(aes(x = body_mass_g, fill = species),\n                   color = \"black\") + \n  scale_color_viridis_d(option = \"magma\",\n                        aesthetics = c(\"colour\", \"fill\")) +\n  labs(title = \"Plot B: Penguin Body Mass by Species\",\n       caption = \"ggplot\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggplot-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\npenguins %>% ggplot() + \n  geom_density(aes(x = body_mass_g, fill = species),\n                   color = \"black\",\n                   alpha = 0.3) + \n  facet_wrap(vars(sex)) + \n  labs(title = \"Plot C: Penguin Body Mass by Species and facetted by Sex\",caption = \"ggplot\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggplot-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\npenguins %>% ggplot() + \n  geom_density(aes(x = body_mass_g, fill = species), \n                   color = \"black\") + \n  facet_wrap(vars(sex), scales = \"free_y\", nrow = 2) + \n  labs(title = \"Plot D: Penguin Body Mass by Species and facetted by Sex\", \n       subtitle = \"Free y-scale\", caption = \"ggplot\") %>%\n  theme(theme(axis.text.x = element_text(angle = 45,hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/density-charts-ggplot-4.png){width=2100}\n:::\n:::\n\n\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n```{webr-r}\n#| label: density-charts-ggformula-webr\n\npenguins <- penguins %>% drop_na()\n\ngf_density( ~ body_mass_g, data = penguins) %>%\n  gf_labs(title = \"Plot A: Penguin Masses\", caption = \"ggformula\")\n\n```\n\n```{webr-r}\npenguins %>% \n  gf_density( ~ body_mass_g, fill = ~ species, \n                             color = \"black\") %>%\n  gf_refine(scale_color_viridis_d(option = \"magma\", \n            aesthetics = c(\"colour\", \"fill\"))) %>%\n  gf_labs(title = \"Plot B: Penguin Body Mass by Species\", \n          caption = \"ggformula\")\n\n```\n\n```{webr-r}\npenguins %>%\n  gf_density(\n    ~ body_mass_g,\n    fill = ~ species,\n    color = \"black\",\n    alpha = 0.3\n  ) %>%\n  gf_facet_wrap(vars(sex)) %>%\n  gf_labs(title = \"Plot C: Penguin Body Mass by Species and facetted by Sex\", caption = \"ggformula\")\n\n```\n\n```{webr-r}\n\npenguins %>%\n  gf_density( ~ body_mass_g, fill = ~ species, color = \"black\") %>%\n  gf_facet_wrap(vars(sex), scales = \"free_y\", nrow = 2) %>%\n  gf_labs(title = \"Plot D: Penguin Body Mass by Species and facetted by Sex\",\n          subtitle = \"Free y-scale\",\n          caption = \"ggformula\") %>%\n  gf_theme(theme(axis.text.x = element_text(angle = 45, hjust = 1)))\n\n\n```\n\n```{webr-r}\n#| label: density-charts-ggplot-webr\npenguins <- penguins %>% drop_na()\n\nggplot(data = penguins) + \n  geom_density(aes(x = body_mass_g)) + \n  labs(title = \"Plot A: Penguin Masses\",caption = \"ggplot\")\n\n```\n\n```{webr-r}\npenguins %>% \n  ggplot() + \n  geom_density(aes(x = body_mass_g, fill = species),\n                   color = \"black\") + \n  scale_color_viridis_d(option = \"magma\",\n                        aesthetics = c(\"colour\", \"fill\")) +\n  labs(title = \"Plot B: Penguin Body Mass by Species\",\n       caption = \"ggplot\")\n\n```\n\n```{webr-r}\npenguins %>% ggplot() + \n  geom_density(aes(x = body_mass_g, fill = species),\n                   color = \"black\",\n                   alpha = 0.3) + \n  facet_wrap(vars(sex)) + \n  labs(title = \"Plot C: Penguin Body Mass by Species and facetted by Sex\",caption = \"ggplot\")  \n\n```\n\n```{webr-r}\npenguins %>% ggplot() + \n  geom_density(aes(x = body_mass_g, fill = species, \n                   color = \"black\")) + \n  facet_wrap(vars(sex), scales = \"free_y\", nrow = 2) + \n  labs(title = \"Plot D: Penguin Body Mass by Species and facetted by Sex\", \n       subtitle = \"Free y-scale\", caption = \"ggplot\") %>%\n  theme(theme(axis.text.x = element_text(angle = 45,hjust = 1)))\n\n\n```\n:::\n\n::: callout-note\n### Business Insights from `penguin` Densities\n\nPretty much similar conclusions as with histograms. Although densities\nmay not be used much in business contexts, they are *better* than\nhistograms when *comparing multiple distributions*! So you should use\nthems!\n:::\n\n\n\n### {{< iconify streamline nature-ecology-rainbow-arch-rain-colorful-rainbow-curve-half-circle >}} Ridge Plots\n\nSometimes we may wish to show the distribution/density of a Quant\nvariable, against several *levels* of a Qual variable. For instance, the\nprices of different items of furniture, based on the furniture \"style\"\nvariable. Or the `sales` of a particular line of products, across\ndifferent shops or cities. We did this with both histograms and\ndensities, by colouring based on a Qual variable, and by facetting using\na Qual variable. There is a third way, using what is called a *ridge \nplot*. `ggformula` support this plot by importing/depending upon the `ggridges` package; however, `ggplot` itself appears to not have this capability. \n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke;\"}\n\n### Using ggformula\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\n\n\ngf_density_ridges(drv ~ hwy, fill = ~ drv, \n                  alpha = 0.3, \n                  rel_min_height = 0.005, data = mpg) %>% \n  gf_refine(scale_y_discrete(expand = c(0.01, 0)),\n            scale_x_continuous(expand = c(0.01, 0))) %>% \n  gf_labs(title = \"Ridge Plot\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/more-charts-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n\n```{webr-r}\n#| label: more-charts-webr\n\ngf_density_ridges(drv ~ hwy, fill = ~ drv, \n                  alpha = 0.3, \n                  rel_min_height = 0.005, data = mpg) %>% \n  gf_refine(scale_y_discrete(expand = c(0.01, 0)),\n            scale_x_continuous(expand = c(0.01, 0))) %>% \n  gf_labs(title = \"Ridge Plot\")\n\n\n```\n\n\n:::\n\n\n\n::: callout-note\n### Business Insights from `mpg` Ridge Plots\n\nThis is another way of visualizing multiple distributions, of a Quant\nvariable at different levels of a Qual variable. We see that the\ndistribution of `hwy` mileage varies substantially with `drv` type.\n:::\n\n\n## {{< iconify grommet-icons test >}} Case Study-2: \n\nTo be created !!\n\n## {{< iconify fluent-mdl2 decision-solid >}} Conclusion\n\n-   Histograms and Frequency Distributions are both used for\n    Quantitative data variables\n-   Whereas Histograms \"dwell upon\" **counts**, **ranges**, **means** and **standard deviations**\n-   Frequency Density plots \"dwell upon\" **probabilities** and\n    **densities**\n-   Ridge Plots are **density plots** used for describing one Quant and\n    one Qual variable (by inherent splitting)\n-   We can split all these plots on the basis of another Qualitative\n    variable.(Ridge Plots are already split)\n-   Long tailed distributions need care in visualization and in\n    inference making!\n\n## {{< iconify openmoji person >}} Your Turn\n\n<a href=\"./files/data/qdd-data.zip\">\n<i class=\"fa-solid fa-database\"></i> Datasets</a>\n\n1.  Click on the Dataset Icon above, and unzip that archive. Try to make\n    distribution plots with each of the three tools.\n2.  A dataset from calmcode.io <https://calmcode.io/datasets.html>\n3.  Old Faithful Data in R (Find it!)\n\n`inspect` the dataset in each case and develop a set of Questions, that\ncan be answered by appropriate stat measures, or by using a chart to\nshow the distribution.\n\n## {{< iconify ri slash-commands-2>}} R Commands Used Here{.hidden}\n\n\n\n\n\n\n\n\n\n## {{< iconify ooui references-rtl >}} References\n\n1. See the scrolly animation for a histogram at this website: *Exploring Histograms, an essay by Aran Lunzer and Amelia McNamara*\n<https://tinlizzie.org/histograms/?s=09>\\\n1. Minimal R using\n`mosaic`.<https://cran.r-project.org/web/packages/mosaic/vignettes/MinimalRgg.pdf>\\\n1. Sebastian Sauer, *Plotting multiple plots using purrr::map and ggplot* [](https://data-se.netlify.app/2021/02/06/plotting-multiple-plots-using-purrr-map-and-ggplot/)\\\n\n::: {#refs style=\"font-size: 60%;\"}\n###### {{< iconify lucide package-check >}} R Package Citations\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nPackage         Version   Citation       \n--------------  --------  ---------------\nggridges        0.5.6     @ggridges      \nNHANES          2.1.0     @NHANES        \nTeachHist       0.2.1     @TeachHist     \nTeachingDemos   2.13      @TeachingDemos \nvisualize       4.5.0     @visualize     \n\n\n:::\n:::\n\n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../../../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../../../../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}