{
  "hash": "3403f5cbec553f64daaf8b286258016e",
  "result": {
    "markdown": "---\ntitle: \"\\U0001F578 Evolution and Flow\"\nsubtitle: \"Evolution and Flow\"\nauthor: \"Arvind Venkatadri\"\ndate: 22/Nov/2022\ndate-modified: \"2023-04-26\"\norder: 40\nabstract: \"Changes in Information over space and time\"\nimage: preview.jpg\nimage-alt: image from rawpixel.com\ncategories:\n- Line and Area Plots\n- Stream Charts\n- Alluvial Plots\n- Sankey Diagrams\n- Chord Diagrams\n- Waterfall Plots\n- Bump Charts\n---\n\n\n## {{< fa folder-open >}} Slides and Tutorials\n\n|                                                                                        |                                                                                                                       |                                                                                                 |                                                                               |\n|------------------|-------------------|------------------|------------------|\n| <a href=\"./files/evolutions.qmd\"><i class=\"fa-brands fa-r-project\"></i> R Tutorial</a> | <a href=\"./files/evolutions.ows\"> <iconify-icon icon=\"fluent-emoji:orange-circle\"></iconify-icon> Orange Tutorial</a> | <a href=\"./files/evolutions.rda\"> <i class=\"fa-solid fa-person-rays\"></i> Radiant Tutorial </a> | <a href=\"./data/data.zip\"> <i class=\"fa-solid fa-database\"> </i> Datasets</a> |\n\n## {{< iconify noto-v1 package >}} Setting up R Packages\n\n\n::: {.cell hash='evol-flow_cache/html/setup_d7e6c43b9edea4e7f5606cf8cb5f4dbd'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(ggstream)\n\n# remotes::install_github(\"corybrunson/ggalluvial@main\", build_vignettes = TRUE)\nlibrary(ggalluvial)\nlibrary(ggformula)\n```\n:::\n\n\n## What Time Evolution Charts can we plot?\n\nIn these cases, the x-axis is typically *time*...and we chart the\nvariable of another Quant variable with respect to time, using a *line*\ngeometry.\n\nLet is take a healthcare budget dataset from [Our World in\nData](https://ourworldindata.org/grapher/public-health-expenditure-share-GDP-OWID):\nWe will plot graphs for 5 countries (India, China, Brazil, Russia,\nCanada ). Download this data by clicking on the button below:\n\n{{< downloadthis data/public-health-expenditure-share-GDP-OWID.csv dname=\"public-health-expenditure-share-GDP-OWID\" label=\"Download the Health data\" icon=\"database-fill-down\" type=\"info\">}}\n\n\n::: {.cell hash='evol-flow_cache/html/unnamed-chunk-2_34096c15add3494211c8d437067ac82f'}\n\n```{.r .cell-code}\nhealth <-\n  read_csv(\"data/public-health-expenditure-share-GDP-OWID.csv\")\nhealth_filtered <- health %>%\n  filter(Entity %in% c(\n    \"India\",\n    \"China\",\n    \"United States\",\n    \"United Kingdom\",\n    \"Russia\",\n    \"Sweden\"\n  ))\n```\n:::\n\n::: {.cell hash='evol-flow_cache/html/unnamed-chunk-3_3cf31705b3b9b40ba2cab55d02c09e20'}\n\n```{.r .cell-code}\np1 <- gf_point(data = health_filtered,\n             public_health_expenditure_pc_gdp ~ Year, \n             colour = ~ Entity, \n             ylab = \"Healthcare Budget\\n as % of GDP\")\n\np2 <-  \n  gf_area(data = health_filtered,\n          public_health_expenditure_pc_gdp ~ Year, \n          fill = ~ Entity, alpha = 0.3, \n          ylab = \"Healthcare Budget\\n as % of GDP\") %>% \n  gf_line(colour = ~ Entity)\n```\n:::\n\n::: {.cell hash='evol-flow_cache/html/unnamed-chunk-4_dfbb6249baf7cd70bf8df1a6c207b322'}\n::: {.cell-output-display}\n![](evol-flow_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## What Space Evolution Charts can we plot?\n\nHere, the *space* can be any Qual variable, and we can chart another\nQuant or Qual variable move across levels of the first chosen Qual\nvariable.\n\nFor instance we can contemplate Enrollment at a University, and show how\nstudents move from course to course in a University. Or how customers\ndrift from one category of products or brands to another....or the\nmovement of cricket players from one IPL Team to another !!\n\n> A Sankey diagram is a visualization used to depict a flow from one set\n> of values to another. The things being connected are called\n> **stages/axes**, **nodes / strata** and the connections are called\n> **flows / links / alluvia**. Sankeys are best used when you want to\n> show a many-to-many mapping between two domains or multiple paths\n> through a set of stages E.g Students going through multiple courses\n> during a semester of study.\n\n![](images/sankey.png){fig-align=\"center\"}\n\n::: callout-note\n## Switching to ggplot here\n\nFor the next few charts, there are ( as yet) no equivalents in\n`ggformula`. Hence we will use `ggplot`.\n:::\n\n\n::: {.cell hash='evol-flow_cache/html/more-charts_3dfab9ce69e007252cc18a6b495fda41'}\n\n```{.r .cell-code}\nlibrary(ggalluvial)\ndata(\"Titanic\")\nTitanic %>% as_tibble() %>% \nggplot(data = .,\n       aes(axis1 = Class, \n           axis2 = Sex, \n           axis3 = Age,\n           y = n)) +\n  geom_alluvium(aes(fill = Survived),size = .25) +\n  geom_stratum() + \n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  \n  scale_x_discrete(limits = c(\"Class\", \"Sex\", \"Age\"), \n                   expand = c(.2, .05)) +\n  \n  scale_fill_manual(values = c(\"darkgoldenrod\", \"purple\")) + \n  \n  xlab(\"Demographic\") +\n  theme_minimal() +\n  ggtitle(\"passengers on the maiden voyage of the Titanic\",\n          \"stratified by demographics and survival\")\n```\n\n::: {.cell-output-display}\n![](evol-flow_files/figure-html/more-charts-1.png){width=672}\n:::\n:::\n\n\nHere is another example of a Sankey Diagram: This diagram show how\nenergy is converted or transmitted before being consumed or lost:\nsupplies are on the left, and demands are on the right. Data: Department\nof Energy & Climate Change via Tom Counsell:\n\n<iframe width=\"100%\" height=\"684\" frameborder=\"0\" src=\"https://observablehq.com/embed/@d3/sankey?cells=chart\">\n\n</iframe>\n\n## Chord Diagram\n\nWe will explore this diagram when we explore network graphs with the\n`tidygraph` and `ggraph` packages.\n\n## Conclusion\n\nWe see that we can visualize 'evolutions\" over time and space. The\nevolutions can represent changes in the **quantities** of things, or\ntheir **categorical** affiliations or groups.\n\nWhat business data would you depict in this way? Revenue streams?\nEmployment? Expenditures over time and market? There are many\npossibilities!\n\n## Your Turn\n\n1.  Within the `ggalluvial` package are two datasets, `majors` and\n    `vaccinations`. Plot alluvial charts for both of these.\n2.  Go to the [American Life Panel\n    Website](https://alpdata.rand.org/index.php?page=data) where you\n    will find many public datasets. Try to take one and make charts from\n    it that we have learned in this Module.\n\n## References\n\n1.  Global Migration, <https://download.gsb.bund.de/BIB/global_flow/> A\n    good example of the use of a Chord Diagram.\n2.  Cory Brunson, `ggalluvial,`\n    <https://corybrunson.github.io/ggalluvial/>\n3.  Other packages: [Sankey plot \\| the R Graph Gallery\n    (r-graph-gallery.com)](https://r-graph-gallery.com/sankey-diagram.html)\n4.  Another package: [Sankey diagrams in ggplot2 with ggsankey \\| R\n    CHARTS\n    (r-charts.com)](https://r-charts.com/flow/sankey-diagram-ggplot2/)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}