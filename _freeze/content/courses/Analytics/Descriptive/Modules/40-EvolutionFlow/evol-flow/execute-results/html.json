{
  "hash": "1292abe1ec03c7ba5215775404261d32",
  "result": {
    "markdown": "---\ntitle: \"\\U0001F578 Evolution and Flow\"\nsubtitle: \"Evolution and Flow\"\nauthor: \"Arvind Venkatadri\"\ndate: 22/Nov/2022\ndate-modified: \"2023-05-25\"\norder: 40\nabstract: \"Changes in Information over space and time\"\nimage: preview.jpg\nimage-alt: image from rawpixel.com\ncategories:\n- Line and Area Plots\n- Stream Charts\n- Alluvial Plots\n- Sankey Diagrams\n- Chord Diagrams\n- Waterfall Plots\n- Bump Charts\n---\n\n\n## {{< fa folder-open >}} Slides and Tutorials\n\n|                                                                                        |                                                                                                                       |                                                                                                 |                                                                               |\n|------------------|-------------------|------------------|------------------|\n| <a href=\"./files/evolutions.qmd\"><i class=\"fa-brands fa-r-project\"></i> R Tutorial</a> | <a href=\"./files/evolutions.ows\"> <iconify-icon icon=\"fluent-emoji:orange-circle\"></iconify-icon> Orange Tutorial</a> | <a href=\"./files/evolutions.rda\"> <i class=\"fa-solid fa-person-rays\"></i> Radiant Tutorial </a> | <a href=\"./data/data.zip\"> <i class=\"fa-solid fa-database\"> </i> Datasets</a> |\n\n## {{< iconify noto-v1 package >}} Setting up R Packages\n\n\n::: {.cell hash='evol-flow_cache/html/setup_e19bade89be84da50dce38d92f96931c'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggstream)\n\n# remotes::install_github(\"corybrunson/ggalluvial@main\", build_vignettes = TRUE)\nlibrary(ggalluvial)\nlibrary(ggformula)\n```\n:::\n\n\n## {{< iconify entypo line-graph >}} What Time Evolution Charts can we plot?\n\nIn these cases, the x-axis is typically *time*...and we chart the\nvariable of another Quant variable with respect to time, using a *line*\ngeometry.\n\nLet is take a healthcare budget dataset from [Our World in\nData](https://ourworldindata.org/grapher/public-health-expenditure-share-GDP-OWID):\nWe will plot graphs for 5 countries (India, China, Brazil, Russia,\nCanada ). Download this data by clicking on the button below:\n\n\n{{< downloadthis data/public-health-expenditure-share-GDP-OWID.csv dname=\"public-health-expenditure-share-GDP-OWID\" label=\"Download the Health data\" icon=\"database-fill-down\" type=\"info\" >}}\n\n\n::: {.cell hash='evol-flow_cache/html/unnamed-chunk-2_7359ecfda90d7b6e5ae93eedbb3ce74e'}\n\n```{.r .cell-code}\nhealth <-\n  read_csv(\"data/public-health-expenditure-share-GDP-OWID.csv\")\n\nhealth_filtered <- health %>%\n  filter(Entity %in% c(\n    \"India\",\n    \"China\",\n    \"United States\",\n    \"United Kingdom\",\n    \"Russia\",\n    \"Sweden\"\n  ))\n```\n:::\n\n::: {.cell layout-ncol=\"2\" hash='evol-flow_cache/html/unnamed-chunk-3_2a5a7d8f439585c35f0da8c8d53ac69f'}\n\n```{.r .cell-code}\ngf_point(data = health_filtered,\n             public_health_expenditure_pc_gdp ~ Year, \n             colour = ~ Entity, \n             ylab = \"Healthcare Budget\\n as % of GDP\",\n         title = \"Line Charts to show Evolution (over Time )\") %>% \n  gf_theme(theme_minimal())\n```\n\n::: {.cell-output-display}\n![](evol-flow_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ngf_area(data = health_filtered,\n          public_health_expenditure_pc_gdp ~ Year, \n          fill = ~ Entity, alpha = 0.3, \n          ylab = \"Healthcare Budget\\n as % of GDP\",\n        title = \"Area Charts to show Evolution (over Time )\") %>% \n  gf_line(colour = ~ Entity) %>% \n  gf_theme(theme_minimal())\n```\n\n::: {.cell-output-display}\n![](evol-flow_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n## {{< iconify carbon sankey-diagram-alt >}} What Space Evolution Charts can we plot?\n\nHere, the *space* can be any Qual variable, and we can chart another\nQuant or Qual variable move across levels of the first chosen Qual\nvariable.\n\nFor instance we can contemplate Enrollment at a University, and show how\nstudents move from course to course in a University. Or how customers\ndrift from one category of products or brands to another....or the\nmovement of cricket players from one IPL Team to another !!\n\n> A `Sankey diagram` is a visualization used to depict a flow from one\n> set of values to another. The things being connected are called\n> **`stages/axes`**`, nodes / strata / lodes,` and the connections are\n> called **`flows / links / alluvia`**. Sankeys are best used when you\n> want to show a many-to-many mapping between two domains or multiple\n> paths through a set of stages E.g Students going through multiple\n> courses during a semester of study.\n\n![](images/sankey.png){fig-align=\"center\" width=\"800\"}\n\n::: callout-note\n## Switching to ggplot here\n\nFor the next few charts, there are (as yet) no equivalents in\n`ggformula`. Hence we will use `ggplot`.\n:::\n\n\n::: {.cell layout-ncol=\"2\" hash='evol-flow_cache/html/more-charts_4fbefe5345410d22d0938a0d0da027fa'}\n\n```{.r .cell-code}\n# library(ggalluvial)\ndata(\"Titanic\")\nTitanic <- Titanic %>% as_tibble()\nTitanic\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Class\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Sex\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Age\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Survived\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1st\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"0\"},{\"1\":\"2nd\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"0\"},{\"1\":\"3rd\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"35\"},{\"1\":\"Crew\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"0\"},{\"1\":\"1st\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"0\"},{\"1\":\"2nd\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"0\"},{\"1\":\"3rd\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"17\"},{\"1\":\"Crew\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"No\",\"5\":\"0\"},{\"1\":\"1st\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"118\"},{\"1\":\"2nd\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"154\"},{\"1\":\"3rd\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"387\"},{\"1\":\"Crew\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"670\"},{\"1\":\"1st\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"4\"},{\"1\":\"2nd\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"13\"},{\"1\":\"3rd\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"89\"},{\"1\":\"Crew\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"No\",\"5\":\"3\"},{\"1\":\"1st\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"5\"},{\"1\":\"2nd\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"11\"},{\"1\":\"3rd\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"13\"},{\"1\":\"Crew\",\"2\":\"Male\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"0\"},{\"1\":\"1st\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"1\"},{\"1\":\"2nd\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"13\"},{\"1\":\"3rd\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"14\"},{\"1\":\"Crew\",\"2\":\"Female\",\"3\":\"Child\",\"4\":\"Yes\",\"5\":\"0\"},{\"1\":\"1st\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"57\"},{\"1\":\"2nd\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"14\"},{\"1\":\"3rd\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"75\"},{\"1\":\"Crew\",\"2\":\"Male\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"192\"},{\"1\":\"1st\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"140\"},{\"1\":\"2nd\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"80\"},{\"1\":\"3rd\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"76\"},{\"1\":\"Crew\",\"2\":\"Female\",\"3\":\"Adult\",\"4\":\"Yes\",\"5\":\"20\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n::: callout-note\n## Table Form Data\n\nNote that this data is in **tidy** and **table** form, with separate\ncolumns for each Qualitative variable and a separate `count` column,\nwhich we saw when we examined Categorical Data. This is intuitively the\nbest form of data to plot a Sankey plot with. But there are other forms,\nwhich you will find examples of on the ggalluvial website.\n<https://corybrunson.github.io/ggalluvial/>\n:::\n\n\n::: {.cell hash='evol-flow_cache/html/unnamed-chunk-5_a99fbd578948ff1631de029f897b96e1'}\n\n```{.r .cell-code}\nTitanic %>% ggplot(data = .,\n    \n# Select the Categorical Variables for the vertical Axes / Stages\n       aes(axis1 = Class, \n           axis2 = Sex, \n           axis3 = Age,\n           y = n), fill = \"white\") +\n  \n# Alluvials between Categorical Axes\n  geom_alluvium(aes(fill = Survived), \n                colour = \"black\", \n                linewidth = 0.25) +\n  \n# Vertical segments for each Categorical Variable2 \n  geom_stratum(colour = \"black\", \n               linewidth = 1, \n               fill = \"white\") + \n  \n# Labels for each \"level\" of the Categorical Axes\n  geom_text(stat = \"stratum\", \n            aes(label = after_stat(stratum))) +\n  \n\n  \n# Scales and Colours\n  scale_x_discrete(limits = c(\"Class\", \"Sex\", \"Age\"), \n                   expand = c(.2, .05)) +\n  \n  scale_fill_manual(values = c(\"darkgoldenrod\", \"purple\")) + \n  \n  xlab(\"Demographic\") +\n  theme_minimal() +\n  ggtitle(\"passengers on the maiden voyage of the Titanic\",\n          \"stratified by demographics and survival\")\n```\n\n::: {.cell-output-display}\n![](evol-flow_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n> Here is how the package `ggalluvial` defines the elements of a typical\n> alluvial plot:\n>\n> -   An **axis** is a dimension (variable) along which the data are\n>     vertically arranged at a fixed horizontal position. The plot above\n>     uses three categorical axes: Class, Sex, and Age.\n> -   The groups at each axis are depicted as opaque blocks called\n>     **strata**. For example, the Class axis contains four strata: 1st,\n>     2nd, 3rd, and Crew.\n> -   Horizontal (x-) splines called **alluvia** span the width of the\n>     plot. In this plot, each alluvium corresponds to a fixed value of\n>     each axis variable, indicated by its vertical position at the\n>     axis, as well as of the Survived variable, indicated by its fill\n>     color.\n> -   The segments of the alluvia between pairs of adjacent axes are\n>     **flows**.\n> -   The alluvia intersect the strata at **lodes**. The lodes are not\n>     visualized in the above plot, but they can be inferred as filled\n>     rectangles extending the flows through the strata at each end of\n>     the plot or connecting the flows on either side of the center\n>     stratum.\n\nHere is another example of a Sankey Diagram: This diagram show how\nenergy is converted or transmitted before being consumed or lost:\nsupplies are on the left, and demands are on the right. (Data:\nDepartment of Energy & Climate Change via Tom Counsell):\n\n<iframe width=\"100%\" height=\"684\" frameborder=\"0\" src=\"https://observablehq.com/embed/@d3/sankey?cells=chart\">\n\n</iframe>\n\nThis can be created using the package `ggforce`, which we might explore\nlater.\n\n## {{< iconify icon-park-outline chart-histogram >}} Chord Diagram\n\n![](images/chord.png){fig-align=\"center\"}\n\nWe will explore this diagram when we explore network graphs with the\n`tidygraph` and `ggraph` packages.\n\n## {{< iconify fluent-mdl2 decision-solid >}} Conclusion\n\nWe see that we can visualize \"evolutions\" over time and space. The\nevolutions can represent changes in the **quantities** of things, or\ntheir **categorical** affiliations or groups.\n\nWhat business data would you depict in this way? Revenue streams?\nEmployment? Expenditures over time and market? There are many\npossibilities!\n\n## Your Turn\n\n1.  Within the `ggalluvial` package are two datasets, `majors` and\n    `vaccinations`. Plot alluvial charts for both of these.\n2.  Go to the [American Life Panel\n    Website](https://alpdata.rand.org/index.php?page=data) where you\n    will find many public datasets. Try to take one and make charts from\n    it that we have learned in this Module.\n\n## {{< iconify ooui references-ltr >}} References\n\n1.  Global Migration, <https://download.gsb.bund.de/BIB/global_flow/> A\n    good example of the use of a Chord Diagram.\n2.  Cory Brunson, `ggalluvial,`\n    <https://corybrunson.github.io/ggalluvial/>\n3.  Other packages: [Sankey plot \\| the R Graph Gallery\n    (r-graph-gallery.com)](https://r-graph-gallery.com/sankey-diagram.html)\n4.  Another package: [Sankey diagrams in ggplot2 with ggsankey \\| R\n    CHARTS\n    (r-charts.com)](https://r-charts.com/flow/sankey-diagram-ggplot2/)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}