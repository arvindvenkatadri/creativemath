{
  "hash": "3b1ae863c404879b70fe496d190e3356",
  "result": {
    "markdown": "---\ntitle: \"\\U0001F4CE Correlations\"\nsubtitle: \"Correlations\"\nauthor: \"Arvind Venkatadri\"\ndate: 22/Nov/2022\ndate-modified: \"2023-09-02\"\norder: 30\nabstract: \"How one variable changes with another\"\nimage: preview.jpg\nimage-alt: image from rawpixel.com\ncategories:\n- Correlations  \n- Scatter Plots\n- Bubble Plots  \n- 2D Density Plots  \n- Heatmaps  \n- Regression Lines  \n---\n\n\n## {{< fa folder-open >}} Slides and Tutorials\n\n|                                                                                           |                                                                                                                  |     |     |\n|------------------|-------------------|------------------|------------------|\n| <a href=\"./files/correlations.qmd\"><i class=\"fa-brands fa-r-project\"></i> Tutorial </a>   | <a href=\"./files/correlations-interactive.qmd\"> <i class=\"fa-brands fa-r-project\"></i> R (Interactive Graphs</a> |     |     |\n\n## {{< iconify noto-v1 package >}} Setting up R Packages\n\n\n::: {.cell hash='intro-corr_cache/html/setup_9fe3bb09d83c2301304769265dbcb6da'}\n\n```{.r .cell-code}\nlibrary(tidyverse) # Tidy data processing and plotting\nlibrary(ggformula) # Formula based plots\nlibrary(mosaic) # Our go to package\nlibrary(GGally) # Corr plots\nlibrary(corrplot) # More corrplots\n```\n:::\n\n\n## {{< iconify tabler exchange >}} What is Correlation?\n\nOne of the basic Questions we would have of our data is: Does some\nvariable depend upon another in some way? Does $y$ vary with $x$? A **Correlation Test** is designed to exactly answer this question.\n\nThe word **correlation** is used in everyday life to denote some form of\nassociation. We might say that we have noticed a correlation between\nrainy days and reduced sales at supermarkets. However, in statistical\nterms we use correlation to denote association between two quantitative\nvariables. We also assume that the association is **linear**, that one\nvariable increases or decreases a fixed amount for a unit increase or\ndecrease in the other. The other technique that is often used in these\ncircumstances is **regression**, which involves estimating the best straight\nline to summarise the association.\n\n### {{< iconify arcticons tapemeasure >}} Correlation coefficient\n\nThe degree of association is measured by a *correlation coefficient*,\ndenoted by r. It is sometimes called Pearson's correlation coefficient\nafter its originator and is a measure of linear association. (If a\ncurved line is needed to express the relationship, other and more\ncomplicated measures of the correlation must be used.)\n\nThe correlation coefficient is measured on a scale that varies from + 1\nthrough 0 to -- 1. Complete correlation between two variables is\nexpressed by either + 1 or -1. When one variable increases as the other\nincreases the correlation is positive; when one decreases as the other\nincreases it is negative.\n\nIn formal terms, the correlation between two variables $x$ and $y$ is\ndefined as\n\n$$\n\\rho = E\\left[\\frac{(x - \\mu_{x}) * (y - \\mu_{y})}{(\\sigma_x)*(\\sigma_y)}\\right]\n$$\n\nwhere $E$ is the expectation operator ( i.e taking mean ). Think of this\nas the average of the products of two scaled variables. (We can see\n$(x-\\mu_x)/\\sigma_x$ is a centering and scaling of the variable $x$. It\nis called the `z-score` of x.)\n\n## {{< iconify material-symbols add-chart-outline >}} What graphs will we see today?\n\nSome of the very basic and commonly used plots for data are:\n\n-   Scatter Plot\n-   Contour Plot\n-   Correlogram\n-   Heatmap\n\nLet us look at the `mpg` dataset from R. Here we have `hwy` and `cty`\nmileages for cars of different types, makes, and models.\n\n## {{< iconify carbon chart-3d >}} Inspecting and Charting Data\n\n\n::: {.cell hash='intro-corr_cache/html/mpg-inspect_9c03a6b1e5b69a4ab5cc3a518272d169'}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"levels\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"missing\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"distribution\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"manufacturer\",\"2\":\"character\",\"3\":\"15\",\"4\":\"234\",\"5\":\"0\",\"6\":\"dodge (15.8%), toyota (14.5%) ...\"},{\"1\":\"model\",\"2\":\"character\",\"3\":\"38\",\"4\":\"234\",\"5\":\"0\",\"6\":\"caravan 2wd (4.7%) ...\"},{\"1\":\"trans\",\"2\":\"character\",\"3\":\"10\",\"4\":\"234\",\"5\":\"0\",\"6\":\"auto(l4) (35.5%), manual(m5) (24.8%) ...\"},{\"1\":\"drv\",\"2\":\"character\",\"3\":\"3\",\"4\":\"234\",\"5\":\"0\",\"6\":\"f (45.3%), 4 (44%), r (10.7%)\"},{\"1\":\"fl\",\"2\":\"character\",\"3\":\"5\",\"4\":\"234\",\"5\":\"0\",\"6\":\"r (71.8%), p (22.2%), e (3.4%) ...\"},{\"1\":\"class\",\"2\":\"character\",\"3\":\"7\",\"4\":\"234\",\"5\":\"0\",\"6\":\"suv (26.5%), compact (20.1%) ...\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"class\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"min\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Q1\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"median\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Q3\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"max\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mean\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"missing\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"displ\",\"2\":\"numeric\",\"3\":\"1.6\",\"4\":\"2.4\",\"5\":\"3.3\",\"6\":\"4.6\",\"7\":\"7\",\"8\":\"3.471795\",\"9\":\"1.291959\",\"10\":\"234\",\"11\":\"0\",\"_rn_\":\"1\"},{\"1\":\"year\",\"2\":\"integer\",\"3\":\"1999.0\",\"4\":\"1999.0\",\"5\":\"2003.5\",\"6\":\"2008.0\",\"7\":\"2008\",\"8\":\"2003.500000\",\"9\":\"4.509646\",\"10\":\"234\",\"11\":\"0\",\"_rn_\":\"2\"},{\"1\":\"cyl\",\"2\":\"integer\",\"3\":\"4.0\",\"4\":\"4.0\",\"5\":\"6.0\",\"6\":\"8.0\",\"7\":\"8\",\"8\":\"5.888889\",\"9\":\"1.611534\",\"10\":\"234\",\"11\":\"0\",\"_rn_\":\"3\"},{\"1\":\"cty\",\"2\":\"integer\",\"3\":\"9.0\",\"4\":\"14.0\",\"5\":\"17.0\",\"6\":\"19.0\",\"7\":\"35\",\"8\":\"16.858974\",\"9\":\"4.255946\",\"10\":\"234\",\"11\":\"0\",\"_rn_\":\"4\"},{\"1\":\"hwy\",\"2\":\"integer\",\"3\":\"12.0\",\"4\":\"18.0\",\"5\":\"24.0\",\"6\":\"27.0\",\"7\":\"44\",\"8\":\"23.440171\",\"9\":\"5.954643\",\"10\":\"234\",\"11\":\"0\",\"_rn_\":\"5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThe `mosaic::inspect` command provides the **schema** of the `mpg`\ndataset in table form, one table for each kind of variable (Qual and\nQuant).\n\nThere are 6 Qual variables, and Quant variables.\n\n::: callout-note\n## Research Questions\n\nIs there a relationship between the `cty` and `hwy` variables in the\n`mpg` dataset? Does this relationship vary based on groupings by other\nQual variables, such as `drv` and `cyl`?\n:::\n\n### {{< iconify ph chart-scatter-bold >}} Scatter Plot\n\n\n::: {.cell layout-ncol=\"3\" hash='intro-corr_cache/html/charts_d1f8ea48dff9706076efb472e7e2be92'}\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/charts-1.png){width=2100}\n:::\n\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/charts-2.png){width=2100}\n:::\n\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/charts-3.png){width=2100}\n:::\n:::\n\n\nIt does appear from the scatter plots that there is a near-linear\nrelationship between `cty` and `hwy` and that it is **positive**. This\nrelationship also holds when we group the data by `drv`.\n\n::: callout-important\n## Independent and Dependent Variables\n\nNote that we have rather *arbitrarily* taken `hwy` as the independent\nvariable, to be plotted on the `x-axis`, and `cty` on the `y-axis`. It\ncould easily have been the other way around, based on our Research\nQuestion.\n\n:::\n\nHow do we **quantize** this relationship, into a **correlation score**?\nThere are two ways: using the `GGally` and `corplot` packages, and doing\na formal **correlation test** with the `mosaic` package.\n\n### Pairwise Correlation Plot with `GGally`\n\nBy default, [`GGally::ggpairs()`](https://ggobi.github.io/ggally/reference/ggpairs.html) provides:\n\n- two different comparisons of each pair of columns \n- displays either the density or count of the respective variable along the diagonal. \n- With different parameter settings, the diagonal can be replaced with the axis values and variable labels.\n\n\n::: {.cell hash='intro-corr_cache/html/pairs chart_692962ce04577e95e7c1b0ef2e8bbf3a'}\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/pairs chart-1.png){width=2100}\n:::\n:::\n\n\n### Pairwise Correlogram with `corrplot`\n\nIn this chart, the correlation between pairs of variables is shown\n*symbolically* as coloured shapes or colours. Circles, Squares, and\nEllipse for example. - The size, colour, and \"orientation\" of the shapes\nin question symbolically represent the strength and polarity of the\ncorrelation scores. E.g. direction of the semi-major axis + the colour\nof the ellipse indicate whether the correlation score is positive or\nnegative; And the more *eccentric* the ellipse, the higher is the\ncorrelation score in value.\n\nWhereas `GGally` **computes** the correlation scores, `corplot` \"merely\"\ndisplays them in an evocative way. We need to compute the correlations a\npriori. Note however:\n\n> R package `corrplot` provides a visual exploratory tool on correlation\n> matrix that supports automatic variable reordering to help detect\n> hidden patterns among variables. `corrplot` is very easy to use and\n> provides a rich array of plotting options in visualization method,\n> graphic layout, color, legend, text labels, etc. It also provides\n> `p-values` and `confidence intervals` to help users determine the\n> **statistical significance** of the correlations.\n\n\n::: {.cell layout-ncol=\"3\" hash='intro-corr_cache/html/cor-plot_fb3ab32e0c26c10c555c56826b9de153'}\n::: {.cell-output-display}\nTable: Correlation Scores Matrix\n\n|      |        hwy|        cty|      displ|        cyl|\n|:-----|----------:|----------:|----------:|----------:|\n|hwy   |  1.0000000|  0.9559159| -0.7660200| -0.7619124|\n|cty   |  0.9559159|  1.0000000| -0.7985240| -0.8057714|\n|displ | -0.7660200| -0.7985240|  1.0000000|  0.9302271|\n|cyl   | -0.7619124| -0.8057714|  0.9302271|  1.0000000|\n:::\n\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/cor-plot-1.png){width=2100}\n:::\n\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/cor-plot-2.png){width=2100}\n:::\n\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/cor-plot-3.png){width=2100}\n:::\n\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/cor-plot-4.png){width=2100}\n:::\n\n::: {.cell-output-display}\n![](intro-corr_files/figure-html/cor-plot-5.png){width=2100}\n:::\n:::\n\n\n## {{< iconify ooui references-ltr >}} References\n\n1.  Using the GGally package \\<[ggally\\_\\*(): List of available\n    high-level plots • GGally\n    (ggobi.github.io)](https://ggobi.github.io/ggally/articles/ggally_plots.html)\\>\n3.  Minimal R using `mosaic`.\n    <https://cran.r-project.org/web/packages/mosaic/vignettes/MinimalRgg.pdf>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}