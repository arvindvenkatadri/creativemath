{
  "hash": "ee0f1d6c64ca909e526825ce3481e165",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"\\U0001F4CA Bar Plots: Plotting Counts\"\nsubtitle: \"How much data does a man need?\"\nauthor: \"Arvind V.\"\ndate: 23/Jun/2024\ndate-modified: \"2024-07-20\"\nabstract: \"Quant and Qual Variable Graphs and their Siblings\"\norder: 20\nimage: preview.jpg\nimage-alt: Image by rawpixel.com\ndf-print: paged\ncategories:\n- Qual Variables\n- Bar Charts\n- Column Charts\n\nbibliography: \n  - references.bib\n  - grateful-refs.bib\ncitation: true\n#suppress-bibliography: true\n# editor: \n#   markdown: \n#     wrap: 72\nwebr:\n  packages: ['readr', 'tidyr', 'dplyr','mosaic', 'skimr', 'ggformula','ggridges', 'palmerpenguins']\n\n---\n\n\n\n\n## {{< fa folder-open >}} Slides and Tutorials\n\n|                                                                                                 |                                                                                                    |                                                                                        |\n|------------------------|------------------------|------------------------|\n| <a href=\"./files/distributions.qmd\"><i class=\"fa-brands fa-r-project\"></i> R (Static Viz)</a>   | <a href=\"./files/distributions.rda\"> <i class=\"fa-solid fa-person-rays\"></i> Radiant Tutorial</a>  | <a href=\"./files/data/qdd-data.zip\"> <i class=\"fa-solid fa-database\"></i> Datasets</a> |\n\n## {{< iconify noto-v1 package >}} Setting up R Packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(mosaic)\nlibrary(ggformula)\nlibrary(skimr)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\n## {{< iconify fxemoji japanesesymbolforbeginner >}} What graphs will we see today?\n\n| Variable #1 | Variable #2 | Chart Names |                    Chart Shape    | \n|:-------------:|:--------------:|:------------------:|:--------------------:|:------:|\n|    Qual   |    None     |  Bar Chart  | {{< iconify ion bar-chart size=4x >}}|\n\n## {{< iconify tabler variable >}} What kind of Data Variables will we choose?\n\n::: column-page-inset-right\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> No </th>\n   <th style=\"text-align:left;\"> Pronoun </th>\n   <th style=\"text-align:left;\"> Answer </th>\n   <th style=\"text-align:left;\"> Variable/Scale </th>\n   <th style=\"text-align:left;\"> Example </th>\n   <th style=\"text-align:left;\"> What Operations? </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:left;\"> How, What Kind, What Sort </td>\n   <td style=\"text-align:left;\"> A Manner / Method, Type or Attribute from a list, with list items in some \" order\" ( e.g. good, better, improved, best..) </td>\n   <td style=\"text-align:left;\"> Qualitative/Ordinal </td>\n   <td style=\"text-align:left;\"> Socioeconomic status (Low income, Middle income, High income),Education level (HighSchool, BS, MS, PhD),Satisfaction rating(Very much Dislike, Dislike, Neutral, Like, Very Much Like) </td>\n   <td style=\"text-align:left;\"> Median,Percentile </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n:::\n\n\n## {{< iconify icons8 idea >}} Inspiration\n\n![Capital Cities](capitals-vs-rest.jpeg){#fig-column-chart-inspiration}\n\nHow much does the (financial) capital of a country contribute to its GDP? Which would be India's city? What would be the reduction in percentage? And these Germans are crazy.(Toc, toc, toc.toc!)\n\nNote how the axis variable that defines the bar `locations` is a ...Qual variable!\n\n### {{< iconify ic round-addchart >}} Graphing Packages in R\n\nThere are several Data Visualization packages, even systems, within R.\n\n-   Base R supports graph making out of the box;\n\n-   The most well known is `ggplot` <https://ggplot2-book.org/> which\n    uses Leland Wilkinson's concept of a \"Grammar of Graphics\";\n\n-   There is the `lattice` package\n    <https://lattice.r-forge.r-project.org/> which uses the \"Trellis\n    Graphics\" concept framework for data visualization developed\n    by R. A. Becker, W. S. Cleveland, et al.;\n\n-   And the `grid` package\n    <https://bookdown.org/rdpeng/RProgDA/the-grid-package.html> that\n    allows extremely fine control of `shapes` plotted on the graph.\n\nEach system has its benefits and learning complexities. We will look at\nplots created using the simpler and intuitive `ggformula` system that\nuses the popular`ggplot` framework, but provides a simplified interface\nthat is easy to recall and apply. While our first option will be to use\n`ggformula`, we will, where appropriate state `ggplot` code too for\ncomparison.\n\nA quick reminder on how `mosaic` and `ggformula` and `ggplot` work in a very similar fashion:\n\n::: callout-tip\n### `mosaic` and `ggformula` command template\n\nNote the standard method for all commands from the `mosaic` and\n`ggformula` packages: `goal( y ~ x | z, data = _____)`\n\nWith `mosaic`, one can create a statistical correlation test between two variables as:\n`cor_test(y ~ x, data = ______ )`\n\nWith `ggformula`, one can create any graph/chart using:\n`gf_***(y ~ x | z, data = _____)`\nIn practice, we often use: `dataframe %>%  gf_***(y ~ x | z)` which has\ncool benefits such as \"autocompletion\" of variable names, as we shall\nsee. The \"\\*\\*\\*\" indicates what kind of graph you desire: histogram,\nbar, scatter, density; the \"\\_\\_\\_\" is the name of your dataset that you\nwant to plot with.\n:::\n\n::: callout-tip\n### `ggplot` command template\n\nThe `ggplot`2 template is used to identify the dataframe, identify the x\nand y axis, and define visualized layers:\n\n`ggplot(data = ---, mapping = aes(x = ---, y = ---)) + geom_----()`\n\nNote: ---- is meant to imply text you supply. e.g. function names, data\nframe names, variable names.\n\nIt is helpful to see the argument mapping, above. In practice, rather\nthan typing the formal arguments, code is typically shorthanded to this:\n\n`dataframe %>%  ggplot(aes(xvar, yvar)) + geom_----()`\n:::\n\n## {{< iconify icon-park-outline chart-histogram >}} Bar Charts and Histograms\n\n**Bar Charts** show counts of observations with respect to a **Qualitative** variable. For instance, a shop inventory with shirt-sizes. Each *bar* has a height proportional to the *count* per shirt-size, in this example. \n\nAlthough **Histograms** may look similar to **Bar Charts**, the two are\ndifferent. First, histograms show *continuous Quant data*. By contrast,\nbar charts show *categorical data*, such as shirt-sizes, or apples, bananas, carrots, etc. Visually speaking, histograms do not usually show spaces between bars because these are *continuous values*, while column charts *must* show spaces to separate each *category*.\n\n## {{< iconify mdi food-processor-outline >}} How do Bar Chart(s) Work?\n\nBar are used to show \"counts\" and \"tallies\" with respect to Qual variables: they answer the question `How Many?`. For instance, in a survey, how many people vs Gender? In a Target Audience survey on *Weekly Consumption*, how many low, medium, or high expenditure people?\n\nEach Qual variable potentially has many levels as we saw in the [Nature of Data](../05-NatureData/index.qmd#what-are-data-types). For instance, in the above example on Weekly Expenditure, `low`, `medium` and `high` were levels for the Qual variable `Expenditure`. Bar charts perform internal **counts** for each *level* of the Qual variable under consideration. The Bar Plot is then a set of *disjoint* bars representing these counts; see the icon above, and then that for histograms!! The X-axis is the set of *levels* in the Qual variable, and the Y-axis represents the counts for each level.\n\n\n## {{< iconify grommet-icons test >}} Case Study-1: Chicago Taxi Rides dataset\n\nWe will first look at at a dataset that speaks about taxi rides in Chicago in the year 2022. This is available on [Vincent Arel-Bundock's superb repository of datasets](https://vincentarelbundock.github.io/Rdatasets/articles/data.html).Let us read into R *directly from the website*. \n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke; \"}\n\n### {{< iconify la r-project >}} R\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxi <- read_csv(\"https://vincentarelbundock.github.io/Rdatasets/csv/modeldata/taxi.csv\")\n```\n:::\n\n\n\n\nThe data has automatically been read into the `webr` session, so you can continue on to the next code chunk!\n\n\n```{webr-r}\n#| context: setup\n# Read the data. Always use base-R. \n# race_df <- read.csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-26/race.csv\")\n# rank_df <- read.csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-26/ultra_rankings.csv\")\ntaxi <- read.csv(\"https://vincentarelbundock.github.io/Rdatasets/csv/modeldata/taxi.csv\")\n##\n\ntheme_custom <- function(){ \n    font <- \"Roboto Condensed\"   #assign font family up front\n    \n    theme_classic(base_size = 14) %+replace%    #replace elements we want to change\n    \n    theme(\n      panel.grid.minor = element_blank(),    #strip minor gridlines\n      text = element_text(family = font),\n      #text elements\n      plot.title = element_text(             #title\n                   family = font,            #set font family\n                   #size = 20,               #set font size\n                   face = 'bold',            #bold typeface\n                   hjust = 0,                #left align\n                   #vjust = 2                #raise slightly\n                   margin=margin(0,0,10,0)\n),               \n      \n      plot.subtitle = element_text(          #subtitle\n                   family = font,            #font family\n                   #size = 14,                #font size\n                   hjust = 0,\n                   margin=margin(2,0,5,0)\n),               \n      \n      plot.caption = element_text(           #caption\n                   family = font,            #font family\n                   size = 8,                 #font size\n                   hjust = 1),               #right align\n      \n      axis.title = element_text(             #axis titles\n                   family = font,            #font family\n                   size = 10                 #font size\n),\n      \n      axis.text = element_text(              #axis text\n                   family = font,            #axis family\n                   size = 8)               #font size\n    )\n}\n\n# Set graph theme\ntheme_set(new = theme_custom())\n#\n\n```\n:::\n\n### {{< iconify file-icons influxdata >}} Examine the Data\n\nAs per our Workflow, we will look at the data using all the three\nmethods we have seen.\n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke; \"}\n\n### {{< iconify la r-project >}} R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(taxi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 10,000\nColumns: 8\n$ rownames <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18…\n$ tip      <chr> \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\"…\n$ distance <dbl> 17.19, 0.88, 18.11, 20.70, 12.23, 0.94, 17.47, 17.67, 1.85, 1…\n$ company  <chr> \"Chicago Independents\", \"City Service\", \"other\", \"Chicago Ind…\n$ local    <chr> \"no\", \"yes\", \"no\", \"no\", \"no\", \"yes\", \"no\", \"no\", \"no\", \"no\",…\n$ dow      <chr> \"Thu\", \"Thu\", \"Mon\", \"Mon\", \"Sun\", \"Sat\", \"Fri\", \"Sun\", \"Fri\"…\n$ month    <chr> \"Feb\", \"Mar\", \"Feb\", \"Apr\", \"Mar\", \"Apr\", \"Mar\", \"Jan\", \"Apr\"…\n$ hour     <dbl> 16, 8, 18, 8, 21, 23, 12, 6, 12, 14, 18, 11, 12, 19, 17, 13, …\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(taxi)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |      |\n|:------------------------|:-----|\n|Name                     |taxi  |\n|Number of rows           |10000 |\n|Number of columns        |8     |\n|_______________________  |      |\n|Column type frequency:   |      |\n|character                |5     |\n|numeric                  |3     |\n|________________________ |      |\n|Group variables          |None  |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|tip           |         0|             1|   2|   3|     0|        2|          0|\n|company       |         0|             1|   5|  28|     0|        7|          0|\n|local         |         0|             1|   2|   3|     0|        2|          0|\n|dow           |         0|             1|   3|   3|     0|        7|          0|\n|month         |         0|             1|   3|   3|     0|        4|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|    mean|      sd| p0|     p25|     p50|     p75|    p100|hist  |\n|:-------------|---------:|-------------:|-------:|-------:|--:|-------:|-------:|-------:|-------:|:-----|\n|rownames      |         0|             1| 5000.50| 2886.90|  1| 2500.75| 5000.50| 7500.25| 10000.0|▇▇▇▇▇ |\n|distance      |         0|             1|    6.22|    7.38|  0|    0.94|    1.78|   15.56|    42.3|▇▁▂▁▁ |\n|hour          |         0|             1|   14.18|    4.36|  0|   11.00|   15.00|   18.00|    23.0|▁▃▅▇▃ |\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninspect(taxi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\ncategorical variables:  \n     name     class levels     n missing\n1     tip character      2 10000       0\n2 company character      7 10000       0\n3   local character      2 10000       0\n4     dow character      7 10000       0\n5   month character      4 10000       0\n                                   distribution\n1 yes (92.1%), no (7.9%)                       \n2 other (27.1%) ...                            \n3 no (81.2%), yes (18.8%)                      \n4 Thu (19.6%), Wed (17.5%), Tue (16.3%) ...    \n5 Apr (31.8%), Mar (31.4%), Feb (20.4%) ...    \n\nquantitative variables:  \n      name   class min      Q1  median        Q3     max        mean\n1 rownames numeric   1 2500.75 5000.50 7500.2500 10000.0 5000.500000\n2 distance numeric   0    0.94    1.78   15.5625    42.3    6.224144\n3     hour numeric   0   11.00   15.00   18.0000    23.0   14.177300\n           sd     n missing\n1 2886.895680 10000       0\n2    7.381397 10000       0\n3    4.359904 10000       0\n```\n\n\n:::\n:::\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n\n```{webr-r}\n#| label: glimpse-taxi-webr\nglimpse(taxi)\n\n```\n\n```{webr-r}\n#| label: skim-taxi-webr\nskim(taxi)\n\n```\n\n```{webr-r}\n#| label: inspect-taxi-webr\ninspect(taxi)\n\n```\n:::\n\n\n::: callout-note\n### Business Insights on Examining the `taxi` dataset\n\n-   This is a large dataset (10K rows), 8 columns/variables.\n-   There are several Qualitative variables: `tip`(2), `company`(7) and\n    `local`(2), `dow`(7), and `month`(12). These have levels as shwon in the parenthesis. \n- Note that `hour` despite being a discrete/numerical variable, it can be treated as a Categorical variable too. \n-   `distance` is Quantitative.\n-   There are no missing values for any variable, all are complete with\n    10K entries.\n:::\n\n::: callout-note\n### Hypothesis and Research Questions\n- The target variable for an experiment that resulted in this data might be the `tip` variable. Which is a binary i.e. Yes/No type Qual variable. \n- Research Questions:\n  - Do more people  `tip` than not?\n  - Does a `tip` depend upon whether the trip is `local` or not?\n  - Do some cab `company`-ies get more tips than others? \n  - And upon the `distance`, `hour` of day, and `dow` and `month`?\n\nTry and think of more Questions!\n:::\n\n## {{< iconify ic baseline-bar-chart >}} Plotting Barcharts\n\nLet's plot some bar graphs: recall that for bar charts, we need to\nchoose **Qual** variables to count with! In each case, we will state a Hypothesis/Question and try to answer it with a chart. \n\n\n### {{< iconify carbon clean >}} Data Munging\n\nWe will keep the target variable `tip` in mind at all times. And convert the `dow`, `local` and `month` variables into factors beforehand.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Convert `dow`, `local`, and `month` into ordered factors\ntaxi_modified <- taxi %>%\n  mutate(dow = factor(dow,\n    levels = c(\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"),\n    labels = c(\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"),\n    ordered = TRUE),\n    ##\n    local = factor(local,\n                   levels = c(\"no\", \"yes\"),\n                   labels = c(\"no\", \"yes\"),\n                   ordered = TRUE),\n    ##\n  month = factor(month, \n                 levels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\"),\n                 labels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\"),\n                 ordered = TRUE))\ntaxi_modified %>% glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 10,000\nColumns: 8\n$ rownames <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18…\n$ tip      <chr> \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\", \"yes\"…\n$ distance <dbl> 17.19, 0.88, 18.11, 20.70, 12.23, 0.94, 17.47, 17.67, 1.85, 1…\n$ company  <chr> \"Chicago Independents\", \"City Service\", \"other\", \"Chicago Ind…\n$ local    <ord> no, yes, no, no, no, yes, no, no, no, no, no, no, no, yes, no…\n$ dow      <ord> Thu, Thu, Mon, Mon, Sun, Sat, Fri, Sun, Fri, Tue, Tue, Sun, W…\n$ month    <ord> Feb, Mar, Feb, Apr, Mar, Apr, Mar, Jan, Apr, Mar, Mar, Apr, A…\n$ hour     <dbl> 16, 8, 18, 8, 21, 23, 12, 6, 12, 14, 18, 11, 12, 19, 17, 13, …\n```\n\n\n:::\n:::\n\n\n\n\n\n```{webr-r}\n## Convert `dow`, `local`, and `month` into ordered factors\ntaxi_modified <- taxi %>%\n  mutate(dow = factor(dow,\n    levels = c(\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"),\n    labels = c(\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"),\n    ordered = TRUE),\n    ##\n    local = factor(local,\n                   levels = c(\"no\", \"yes\"),\n                   labels = c(\"no\", \"yes\"),\n                   ordered = TRUE),\n    ##\n  month = factor(month, \n                 levels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\"),\n                 labels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\"),\n                 ordered = TRUE))\ntaxi_modified %>% glimpse()\n\n```\n\n\n\n### {{< iconify el question-sign >}} Question-1: Do more people `tip` than not?\n\n::: callout-note\n### Question-1: Do more people `tip` than not?\n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke; \"}\n\n### Using ggformula\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\n\ngf_bar(~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot 1A: Counts of Tips\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-ggformula-1.png){width=2100}\n:::\n:::\n\n\n\n\n### Using ggplot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\nggplot(taxi_modified)  + \n  geom_bar(aes(x = tip)) + \n  labs(title = \"Plot 1A: Counts of Tips\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-ggplot-1.png){width=2100}\n:::\n:::\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n\n```{webr-r}\n#| label: bar-charts-ggformula-webr\n#| layout-ncol: 2\n\ngf_bar(~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot A: Counts of Tips\")\n\nggplot(taxi_modified)  + \n  geom_bar(aes(x = tip)) + \n  labs(title = \"Plot 1A: Counts of Tips\")\n\n```\n:::\n\n### Business Insights-1\n- Far more people `tip` than not. \n- (Future) The counts of `tip` are very imbalanced and if we are to setup a model for that (e.g. logistic regression) we would need to  very carefully subset the data for `training` and `testing` our model. \n\n:::\n\n\n\n\n\n### {{< iconify el question-sign >}} Question-2: Does the `tip` depend upon whether the trip is `local` or not?\n\n::: callout-note\n### Question-2: Does the `tip` depend upon whether the trip is `local` or not?\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke; \"}\n\n### Using ggformula\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\ntaxi_modified %>% \n  gf_bar(~ local, fill = ~ tip, position = \"dodge\") %>% \n  gf_labs(title = \"Plot 2A: Dodged Bar Chart\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\ntaxi_modified %>% \n  gf_bar(~ local, fill = ~ tip, position = \"stack\") %>% \n  gf_labs(title = \"Plot 2B: Stacked Bar Chart\",\n          subtitle = \"Can we spot per group differences in proportions??\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\ntaxi_modified %>% \n  gf_bar(~ local, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \"Plot 2C: Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\n## Better labelling of Y-axis\ntaxi_modified %>% \n  gf_props(~ local, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \"Plot 2D: Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-4.png){width=2100}\n:::\n:::\n\n\n\n\n\n### Using ggplot\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\ntaxi_modified %>%\n  ggplot() +\n  geom_bar(aes(x = local, fill = tip), position = \"dodge\") +\n  labs(title = \"Plot 2A:Dodged Bar Chart\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\ntaxi_modified %>%\n  ggplot() +\n  geom_bar(aes(x = local, fill = tip), position = \"stack\") +\n  labs(title = \"Plot 2B: Stacked Bar Chart\", subtitle = \"Can we spot per group differences in proportions??\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\ntaxi_modified %>% \n  ggplot() +\n  geom_bar(aes(x = local, fill = tip), position = \"fill\") +\n  labs(title = \"Plot 2C: Filled Bar Chart\", subtitle = \"Shows Per group differences in Proportions!\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\n## Better labelling of Y-axis\ntaxi_modified %>%\n  ggplot() +\n  geom_bar(aes(x = local, fill = tip), position = \"fill\") +\n  labs(title = \"Plot 2D: Filled Bar Chart\", subtitle = \"Shows Per group differences in Proportions!\",\n       y = \"Proportion\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-4.png){width=2100}\n:::\n:::\n\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n```{webr-r}\ntaxi_modified %>% \n  gf_bar(~ local, fill = ~ tip, position = \"dodge\") %>% \n  gf_labs(title = \"Dodged Bar Chart\")\n##\ntaxi_modified %>% \n  gf_bar(~ local, fill = ~ tip, position = \"stack\") %>% \n  gf_labs(title = \"Stacked Bar Chart\",\n          subtitle = \"Can we spot per group differences in proportions??\")\n\n## Showing \"per capita\" percentages\ntaxi_modified %>% \n  gf_bar(~ local, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \" Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\")\n## Showing \"per capita\" percentages\n## Better labelling of Y-axis\ntaxi_modified %>% \n  gf_props(~ local, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \" Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\")\n```\n\n\n\n:::\n### Business Insights-2\n- Counting the frequency of `tip` by `local` gives us grouped counts, but we cannot tell the percentage per group (local or not) of those who tip and those who do not. \n- We need per-group percentages because the number of `local` trips are not balanced\n- Hence we tried bar charts with `position = stack`, but finally it is the `position = fill` that works best.\n- We see that the percentage of tippers is somewhat higher with people who make non-local trips. Not surprising. \n:::\n\n\n\n### {{< iconify el question-sign >}} Question-3: Do some cab `company`-ies get more `tips` than others?\n\n::: callout-note\n### Question-3: Do some cab `company`-ies get more `tips` than others?\n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke; \"}\n\n### Using ggformula\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\ntaxi_modified %>% \n  gf_bar(~ company, fill = ~ tip, position = \"dodge\") %>% \n  gf_labs(title = \"Plot 2A: Dodged Bar Chart\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\ntaxi_modified %>% \n  gf_bar(~ company, fill = ~ tip, position = \"stack\") %>% \n  gf_labs(title = \"Plot 2B: Stacked Bar Chart\",\n          subtitle = \"Can we spot per group differences in proportions??\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\ntaxi_modified %>% \n  gf_bar(~ company, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \"Plot 2C: Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\n## Better labelling of Y-axis\ntaxi_modified %>% \n  gf_props(~ company, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \"Plot 2D: Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-4.png){width=2100}\n:::\n:::\n\n\n\n\n### Using ggplot\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\ntaxi_modified %>% \n  ggplot() + \n  geom_bar(aes(x = company, fill = tip), position = \"dodge\") + \n  labs(title = \"Plot 2A: Dodged Bar Chart\") + \n  theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\ntaxi_modified %>% \n  ggplot() + \n  geom_bar(aes(x = company, fill = tip), position = \"stack\") +\n  labs(title = \"Plot 2B: Stacked Bar Chart\",\n       subtitle = \"Can we spot per group differences in proportions??\") +\n  theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\ntaxi_modified %>% \n  ggplot() + \n  geom_bar(aes(x = company, fill = tip), position = \"fill\") +\n  labs(title = \"Plot 2C: Filled Bar Chart\",\n       subtitle = \"Shows Per group differences in Proportions!\") +\n  theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n## Showing \"per capita\" percentages\n## Better labelling of Y-axis\ntaxi_modified %>% \n  ggplot() + \n  geom_bar(aes(x = company, fill = tip), position = \"fill\") +\n  labs(title = \"Plot 2D: Filled Bar Chart\",\n       subtitle = \"Shows Per group differences in Proportions!\",\n       y = \"Proportions\") +\n  theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-4.png){width=2100}\n:::\n:::\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n```{webr-r}\n\ntaxi_modified %>% \n  gf_bar(~ company, fill = ~ tip, position = \"dodge\") %>% \n  gf_labs(title = \"Plot 2A: Dodged Bar Chart\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n##\ntaxi_modified %>% \n  gf_bar(~ company, fill = ~ tip, position = \"stack\") %>% \n  gf_labs(title = \"Plot 2B: Stacked Bar Chart\",\n          subtitle = \"Can we spot per group differences in proportions??\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n## Showing \"per capita\" percentages\ntaxi_modified %>% \n  gf_bar(~ company, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \"Plot 2C: Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n## Showing \"per capita\" percentages\n## Better labelling of Y-axis\ntaxi_modified %>% \n  gf_props(~ company, fill = ~ tip, position = \"fill\") %>% \n  gf_labs(title = \"Plot 2D: Filled Bar Chart\",\n          subtitle = \"Shows Per group differences in Proportions!\") %>% \n  gf_theme(theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1)))\n\n```\n\n\n\n:::\n\n### Business Insights-3\n- Using `stack`, `dodge`, and `fill` in bar plots gives us different ways of looking at the sets of counts;\n- `fill`: gives us a per-group proportion of another Qual variable for a chosen Qual variable. This chart view is useful in [Inference for Proportions](../../../Inference/Modules/190-TwoProp/index.qmd);\n- Most cab `company`-ies have similar usage, if you neglect the `other` category of `company`;\n- Does seem that of all the `company`-ies, `tips` are not so good for the `Flash Cab` company. A driver issue? Or are the cars too old? Or don't they offer service everywhere?\n\n:::\n\n\n### {{< iconify el question-sign >}} Question-4: Does a `tip` depend upon the `distance`, `hour` of day, and `dow` and `month`? \n::: callout-note\n### Question-4: Does a `tip` depend upon the `distance`, `hour` of day, and `dow` and `month`?\n\n::: {.panel-tabset .nav-pills style=\"background: whitesmoke; \"}\n\n### Using ggformula\n\n\n\n\n::: {.cell layout-nrow=\"3\" layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n## \ngf_bar(~ hour, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot B: Counts of Tips by Hour\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggformula-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\ngf_bar(~ dow, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot C: Counts of Tips by Day of Week\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggformula-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\ngf_bar(~ month, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot D: Counts of Tips by Month\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggformula-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\ngf_bar(~ month | dow, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot E: Counts of Tips by Day of Week and Month\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggformula-4.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\n## This may be too busy a graph...\ngf_bar(~ dow | hour, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot F: Counts of Tips by Hour and Day of Week\",\n          subtitle = \"Is this plot arrangement easy to grasp?\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggformula-5.png){width=2100}\n:::\n\n```{.r .cell-code}\n## This is better!\ngf_bar(~ hour | dow, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot G: Counts of Tips by Hour and Day of Week\",\n          subtitle = \"Swapped the Facets\")  \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggformula-6.png){width=2100}\n:::\n:::\n\n\n\n\n### Using ggplot\n\n\n\n::: {.cell layout-nrow=\"2\" layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n## \nggplot(data = taxi_modified) + \n  geom_bar(aes(x = tip)) + \n  facet_wrap(vars(hour)) + \n  labs(title = \"Plot B: Counts of Tips by Hour\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggplot-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\nggplot(data = taxi_modified) + \n  geom_bar(aes(x = tip)) + \n  facet_wrap(vars(dow)) + \n  labs(title = \"Plot C: Counts of Tips by Day of Week\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggplot-2.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\nggplot(data = taxi_modified) + \n  geom_bar(aes(x = tip)) + \n  facet_wrap(vars(month)) + \n  labs(title = \"Plot D: Counts of Tips by Month\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggplot-3.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\nggplot(data = taxi_modified) + \n  geom_bar(aes(x = tip)) + \n  facet_grid(rows = vars(dow), cols = vars(month)) + \n  labs(title = \"Plot E: Counts of Tips by Day of Week and Month\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggplot-4.png){width=2100}\n:::\n\n```{.r .cell-code}\n##\n## This may be too busy a graph...\nggplot(data = taxi_modified) +\n  geom_bar(aes(x = dow, fill = tip)) +\n  facet_wrap(vars(hour)) + \n  labs(title = \"Plot F: Counts of Tips by Hour and Day of Week\",\n          subtitle = \"Is this plot arrangement easy to grasp?\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggplot-5.png){width=2100}\n:::\n\n```{.r .cell-code}\n## This is better!\nggplot(data = taxi_modified) +\n  geom_bar(aes(x = hour, fill = tip)) +\n  facet_wrap(vars(dow)) +           \n  labs(title = \"Plot G: Counts of Tips by Hour and Day of Week\",\n          subtitle = \"Swapped the Facets\")   \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bar-tip-others-ggplot-6.png){width=2100}\n:::\n:::\n\n\n\n\n\n### {{< iconify noto-v1 spider-web >}} web-r\n\n```{webr-r}\ngf_bar(~ hour, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot B: Counts of Tips by Hour\")\n##\ngf_bar(~ dow, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot C: Counts of Tips by Day of Week\")\n##\ngf_bar(~ month, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot D: Counts of Tips by Month\")\n\n##\ngf_bar(~ month | dow, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot E: Counts of Tips by Day of Week and Month\")\n##\n## This may be too busy a graph...\ngf_bar(~ dow | hour, fill = ~ tip, data = taxi_modified) %>%\n  gf_labs(title = \"Plot F: Counts of Tips by Hour and Day of Week\",\n          subtitle = \"Is this plot arrangement easy to grasp?\")\n## This is better!\ngf_bar(~ hour | dow, fill = ~ tip, data = taxi) %>%\n  gf_labs(title = \"Plot G: Counts of Tips by Hour and Day of Week\",\n          subtitle = \"Swapped the Facets\")  \n\n```\n\n:::\n### Business Insights-4\n- Note: We were using `fill = ~ tip` here! Why is that a good idea?\n- `tips` vs `hour`: There are always more people who `tip` than those who do not. Of course there are fewer **trips** during the early morning hours and the late night hours, based on the very small bar-pairs we see at those times\n- `tips` vs `dow`: Except for Sunday, the `tip` count patterns (Yes/No) look similar across all days.\n- `tips` vs `month`: We have data for 4 months only. Again, the `tip` count patterns (Yes/No) look similar across all months. Perhaps slightly fewer **trips** in Jan, when it is cold in Chicago and people may not go out much.\n- `tips` vs `dow` vs `month`: Very similar counts for `tips`(Yes/No) across day-of-week and month. \n:::\n\n\n## Bar Plot Extras\n\n::: callout-note\n### gf-bar and gf-col\nNote also that `gf_bar/geom_bar` takes only ONE variable (for the x-axis), whereas `gf_col/geom_col` needs both X and Y variables since it simply plots columns. \nBoth are useful!\n:::\n\n\n::: callout-note\n### And we can plot Proportions and Percentages too!\nAlso check out `gf_props` and `gf_percents` ! These are also very useful `ggformula` functions!\n\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Set graph theme\ntheme_set(new = theme_custom())\n##\n\ngf_props(~ substance,\n  data = mosaicData::HELPrct, fill = ~ sex,\n  position = \"dodge\") %>%\n  gf_labs(title = \"Plotting Proportions using gf_props\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=2100}\n:::\n\n```{.r .cell-code}\n###\ngf_percents(~ substance,\n  data = mosaicData::HELPrct, fill = ~ sex,\n  position = \"dodge\") %>%\n  gf_labs(title = \"Plotting Percentages using gf_percents\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-2.png){width=2100}\n:::\n:::\n\n\n\n\n:::\n\n## {{< iconify fluent-mdl2 decision-solid >}} Conclusion\n\n-   Qualitative data variables can be plotted as **counts**, using Bar\n    Charts\n-   `gf_col` and `gf_bar` provide Bar charts; `gf_bar` performs `counts` internally, whereas `gf_col` requires pre-counted data.\n-  Using `facets` allows us to view counts of one Qual variable *split over* two other Qual variables\n\n## {{< iconify openmoji person >}} Your Turn\n\n<a href=\"./files/data/qdd-data.zip\">\n<i class=\"fa-solid fa-database\"></i> Datasets</a>\n\n1.  Click on the Dataset Icon above, and unzip that archive. Try to make\n    Bar plots with each of them, using one or more Qual variables.\n2.  A dataset from calmcode.io <https://calmcode.io/datasets.html>\n\n`glimpse` / `skim` / `inspect` the dataset in each case and develop a set of Questions, that\ncan be answered by appropriate stat measures, or by using a chart to\nshow the distribution.\n\n## {{< iconify ooui references-rtl >}} References\n\n1. \n\n::: {#refs style=\"font-size: 60%;\"}\n\n###### {{< iconify lucide package-check >}} R Package Citations\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nPackage     Version   Citation   \n----------  --------  -----------\nggformula   0.12.0    @ggformula \nmosaic      1.9.1     @mosaic    \ntidyverse   2.0.0     @tidyverse \n\n\n:::\n:::\n\n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../../../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../../../../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}