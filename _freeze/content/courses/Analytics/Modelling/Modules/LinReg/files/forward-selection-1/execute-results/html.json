{
  "hash": "2d77b3822f68aea9939ca067d082543a",
  "result": {
    "markdown": "---\ntitle: \"Tutorial: Multiple Linear Regression with Forward Selection\"\nauthor: \"Arvind Venkatadri\"\ndate: 13/May/2023\ndate-modified: \"2023-05-19\"\ncategories: \n  - Linear Regression\n  - Quantitative Predictor\n  - Quantitative Response\n  - Sum of Squares\n  - Residuals\nabstract: \"Using Multiple Regression to predict Quantitative Target Variables\"\n---\n\n\n## {{< iconify noto-v1 package >}} Setting up R Packages\n\n\n::: {.cell hash='forward-selection-1_cache/html/setup_275ce8b042c8fc624ee5a5ea99efc6ff'}\n\n```{.r .cell-code}\noptions(scipen = 1, digits = 3) #set to three decimal \nknitr::opts_chunk$set(echo = TRUE,warning = FALSE,message = FALSE) \nlibrary(tidyverse)\nlibrary(ggformula)\nlibrary(mosaic)\nlibrary(GGally)\nlibrary(corrgram)\nlibrary(corrplot)\n\n# datasets\nlibrary(ISLR)\n```\n:::\n\n::: {.cell hash='forward-selection-1_cache/html/plot theme_6dd7cafdc9974b743add728ceb9aeb96'}\n\n```{.r .cell-code}\n# Let us set a plot theme for Data visualisation\n\nmy_theme <- function(){  # Creating a function\n  theme_classic() +  # Using pre-defined theme as base\n  theme(axis.text.x = element_text(size = 12, face = \"bold\"),  # Customizing axes text      \n        axis.text.y = element_text(size = 12, face = \"bold\"),\n        axis.title = element_text(size = 14, face = \"bold\"),  # Customizing axis title\n        panel.grid = element_blank(),  # Taking off the default grid\n        plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), units = , \"cm\"),\n        legend.text = element_text(size = 12, face = \"italic\"),  # Customizing legend text\n        legend.title = element_text(size = 12, face = \"bold\"),  # Customizing legend title\n        legend.position = \"right\",  # Customizing legend position\n        plot.caption = element_text(size = 12))  # Customizing plot caption\n}   \n```\n:::\n\n\nIn this tutorial, we will use the ~~Boston housing~~ `Hitters`\ndataset**(s)** from the `ISLR` package. Our research question is:\n\n::: callout-note\n## Research Question\n\nHow do we predict the `Salary` of baseball players based on other\n**Quantitative** parameters such as `Hits`, `HmRun` `AtBat`?\n\nAnd how do we choose the \"best\" model, based on a trade-off between\nModel Complexity and Model Accuracy?\n:::\n\n## {{< iconify flat-color-icons workflow >}} Workflow Plan\n\nOur target variable is `Salary`.\n\nWe will start with an examination of correlations between `Salary` and\nother Quant predictors.\n\nWe will use a null model for our Linear Regression at first, keeping\njust an `intercept` term. Based on the examination of the *r-square*\nimprovement offered by each predictor *individually*, we will add\nanother quantitative predictor. We will follow this process through up\nto a point where the gains in model accuracy are good enough to justify\nthe additional model complexity.\n\n::: callout-note\nThis approach is the exact opposite of the earlier tutorial on multiple\nlinear regression, where we started with a **maximal model** and trimmed\nit down based on an assessment of `r.squared`.\n:::\n\n## {{< iconify flat-color-icons workflow >}} Workflow: EDA\n\nThe `Hitters` dataset has the following variables:\n\n\n::: {.cell hash='forward-selection-1_cache/html/unnamed-chunk-3_3c801e9e4f1bbcda44c20ddc992ee452'}\n\n```{.r .cell-code}\ndata(\"Hitters\")\ninspect(Hitters)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\ncategorical variables:  \n       name  class levels   n missing\n1    League factor      2 322       0\n2  Division factor      2 322       0\n3 NewLeague factor      2 322       0\n                                   distribution\n1 A (54.3%), N (45.7%)                         \n2 W (51.2%), E (48.8%)                         \n3 A (54.7%), N (45.3%)                         \n\nquantitative variables:  \n      name   class  min    Q1 median     Q3   max    mean      sd   n missing\n1    AtBat integer 16.0 255.2  379.5  512.0   687  380.93  153.40 322       0\n2     Hits integer  1.0  64.0   96.0  137.0   238  101.02   46.45 322       0\n3    HmRun integer  0.0   4.0    8.0   16.0    40   10.77    8.71 322       0\n4     Runs integer  0.0  30.2   48.0   69.0   130   50.91   26.02 322       0\n5      RBI integer  0.0  28.0   44.0   64.8   121   48.03   26.17 322       0\n6    Walks integer  0.0  22.0   35.0   53.0   105   38.74   21.64 322       0\n7    Years integer  1.0   4.0    6.0   11.0    24    7.44    4.93 322       0\n8   CAtBat integer 19.0 816.8 1928.0 3924.2 14053 2648.68 2324.21 322       0\n9    CHits integer  4.0 209.0  508.0 1059.2  4256  717.57  654.47 322       0\n10  CHmRun integer  0.0  14.0   37.5   90.0   548   69.49   86.27 322       0\n11   CRuns integer  1.0 100.2  247.0  526.2  2165  358.80  334.11 322       0\n12    CRBI integer  0.0  88.8  220.5  426.2  1659  330.12  333.22 322       0\n13  CWalks integer  0.0  67.2  170.5  339.2  1566  260.24  267.06 322       0\n14 PutOuts integer  0.0 109.2  212.0  325.0  1378  288.94  280.70 322       0\n15 Assists integer  0.0   7.0   39.5  166.0   492  106.91  136.85 322       0\n16  Errors integer  0.0   3.0    6.0   11.0    32    8.04    6.37 322       0\n17  Salary numeric 67.5 190.0  425.0  750.0  2460  535.93  451.12 263      59\n```\n:::\n:::\n\n\nWe should examine scatter plots of `Salary` against these variables.\n\nLet us select a few sets of Quantitative and Qualitative features, along\nwith the target variable `Salary` and do a pairs-plots with them:\n\n\n::: {.cell .column-screen-inset-shaded layout-nrow=\"2\" hash='forward-selection-1_cache/html/pairs plots 1_7c1facc5f788aae89487f549a0c65728'}\n\n```{.r .cell-code}\nHitters %>% \n  select(Salary, AtBat, Hits, HmRun) %>% \n  GGally::ggpairs(title = \"Plot 1\")\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/pairs plots 1-1.png){width=672}\n:::\n\n```{.r .cell-code}\nHitters %>% \n  select(Salary, Runs, RBI, Walks,Years) %>% \n  GGally::ggpairs(title = \"Plot 2\")\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/pairs plots 1-2.png){width=672}\n:::\n\n```{.r .cell-code}\nHitters %>% \n  select(Salary, CRBI, CAtBat, CHits, CHmRun, CRuns, CWalks) %>% \n  GGally::ggpairs(title = \"Plot 3\")\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/pairs plots 1-3.png){width=672}\n:::\n\n```{.r .cell-code}\nHitters %>% \n  select(Salary, PutOuts,Assists,Errors) %>% \n  GGally::ggpairs(title = \"Plot 4\")\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/pairs plots 1-4.png){width=672}\n:::\n\n```{.r .cell-code}\nHitters %>% \n  select(Salary, League,Division,NewLeague) %>% \n  GGally::ggpairs(title = \"Plot 5\")\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/pairs plots 1-5.png){width=672}\n:::\n:::\n\n\n`AtBat` and `Hits` seem relevant predictors for `Salary`. So are `Runs`,\n`RBI`,`Walks`, and `Years`. From Plot 2, both `RBI` and `Walks` are also\ninter-correlated with `Runs`. All the `C*` variables are well correlated\nwith `Salary` and also among one another. (Plot3). Plot 4 has no\nsignificant correlations at all. Plot 5 shows `Salary` nearly equally\ndistributed across `League`, `Division`, and `NewLeague`.\n\nWe can also plot all correlations in one graph using `cor.test` and\n`purrr`:\n\n\n::: {.cell hash='forward-selection-1_cache/html/corr-test plots_be33c8fa1bbb0c474be55f83fb9baf64'}\n\n```{.r .cell-code}\nall_corrs <- \n  Hitters %>% \n  select(where(is.numeric)) %>% \n  \n  # leave off Salary and year to get all the remaining ones\n  select(- Salary) %>% \n  \n  \n  # perform a cor.test for all variables against Salary\n  purrr::map(.x = .,\n             .f = \\(x) cor.test(x, Hitters$Salary)) %>%\n  \n  # tidy up the cor.test outputs into a tidy data frame\n  map_dfr(broom::tidy, .id = \"predictor\") \n\nall_corrs\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"predictor\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"parameter\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"method\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"alternative\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"AtBat\",\"2\":\"0.394770945\",\"3\":\"6.94151241\",\"4\":\"3.065403e-11\",\"5\":\"261\",\"6\":\"0.28754456\",\"7\":\"0.4922239\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"Hits\",\"2\":\"0.438674738\",\"3\":\"7.88631784\",\"4\":\"8.531228e-14\",\"5\":\"261\",\"6\":\"0.33552101\",\"7\":\"0.5314332\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"HmRun\",\"2\":\"0.343028078\",\"3\":\"5.89975495\",\"4\":\"1.125195e-08\",\"5\":\"261\",\"6\":\"0.23168433\",\"7\":\"0.4455003\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"Runs\",\"2\":\"0.419858559\",\"3\":\"7.47366760\",\"4\":\"1.179924e-12\",\"5\":\"261\",\"6\":\"0.31489365\",\"7\":\"0.5146775\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"RBI\",\"2\":\"0.449457088\",\"3\":\"8.12849641\",\"4\":\"1.756983e-14\",\"5\":\"261\",\"6\":\"0.34738598\",\"7\":\"0.5410023\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"Walks\",\"2\":\"0.443867260\",\"3\":\"8.00240450\",\"4\":\"4.013833e-14\",\"5\":\"261\",\"6\":\"0.34123082\",\"7\":\"0.5360444\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"Years\",\"2\":\"0.400656994\",\"3\":\"7.06462908\",\"4\":\"1.462612e-11\",\"5\":\"261\",\"6\":\"0.29394554\",\"7\":\"0.4975036\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"CAtBat\",\"2\":\"0.526135310\",\"3\":\"9.99525798\",\"4\":\"3.978122e-20\",\"5\":\"261\",\"6\":\"0.43271652\",\"7\":\"0.6083752\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"CHits\",\"2\":\"0.548909559\",\"3\":\"10.60904290\",\"4\":\"4.263417e-22\",\"5\":\"261\",\"6\":\"0.45838716\",\"7\":\"0.6281600\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"CHmRun\",\"2\":\"0.524930560\",\"3\":\"9.96365151\",\"4\":\"5.009540e-20\",\"5\":\"261\",\"6\":\"0.43136276\",\"7\":\"0.6073258\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"CRuns\",\"2\":\"0.562677711\",\"3\":\"10.99624609\",\"4\":\"2.312166e-23\",\"5\":\"261\",\"6\":\"0.47397992\",\"7\":\"0.6400714\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"CRBI\",\"2\":\"0.566965686\",\"3\":\"11.11952229\",\"4\":\"9.070948e-24\",\"5\":\"261\",\"6\":\"0.47884754\",\"7\":\"0.6437735\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"CWalks\",\"2\":\"0.489822036\",\"3\":\"9.07675323\",\"4\":\"2.817096e-17\",\"5\":\"261\",\"6\":\"0.39209596\",\"7\":\"0.5766158\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"PutOuts\",\"2\":\"0.300480356\",\"3\":\"5.08960973\",\"4\":\"6.871142e-07\",\"5\":\"261\",\"6\":\"0.18629456\",\"7\":\"0.4066570\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"Assists\",\"2\":\"0.025436136\",\"3\":\"0.41106635\",\"4\":\"6.813612e-01\",\"5\":\"261\",\"6\":\"-0.09581534\",\"7\":\"0.1459438\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"},{\"1\":\"Errors\",\"2\":\"-0.005400702\",\"3\":\"-0.08725228\",\"4\":\"9.305379e-01\",\"5\":\"261\",\"6\":\"-0.12627490\",\"7\":\"0.1156315\",\"8\":\"Pearson's product-moment correlation\",\"9\":\"two.sided\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nall_corrs %>% \n  gf_hline(yintercept = 0, linewidth = 2, color = \"grey\") %>% \n  gf_errorbar(conf.high + conf.low ~ reorder(predictor, estimate),\n              color = ~ -log10(p.value),\n              width = 0.2) %>% \n  gf_point(estimate ~ reorder(predictor, estimate)) %>% \n  gf_labs(x = NULL, y = \"Correlation with Salary\") %>% \n  gf_theme(theme = my_theme()) %>% \n  gf_refine(scale_color_gradient(\"significance\",low = \"blue\", high = \"red\"),\n                       theme(axis.text.x = element_text(angle = 30, hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/corr-test plots-1.png){width=672}\n:::\n:::\n\n\nThere are a good many predictors which have statistically significant\ncorrelations with `Salary`, such as `CRuns` , `CHmRun`.\n\nWe now start with setting up simple Linear Regressions with **no**\npredictors, only an intercept. We then fit separate Linear Models using\neach predictor **individually**. Then based on the the improvement in\n`r.squared` offered by each predictor, we progressively add it to the\nmodel, until we are \"satisfied\" with the quality of the model ( using\n`rsquared` and other means).\n\nLet us now do this.\n\n## {{< iconify flat-color-icons workflow >}} Workflow: Minimal Multiple Regression Model\n\nNote the formula structure here: we want just and `intercept`.\n\n\n::: {.cell hash='forward-selection-1_cache/html/unnamed-chunk-6_3c5492e6b67caaa0c9eff2d624522a7f'}\n\n```{.r .cell-code}\nlm_min <- lm(data = Hitters, Salary ~ 1)\nsummary(lm_min)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Salary ~ 1, data = Hitters)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n  -468   -346   -111    214   1924 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    535.9       27.8    19.3   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 451 on 262 degrees of freedom\n  (59 observations deleted due to missingness)\n```\n:::\n\n```{.r .cell-code}\nlm_min %>% broom::tidy()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"term\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"536\",\"3\":\"27.8\",\"4\":\"19.3\",\"5\":\"4.02e-52\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nlm_min %>% broom::glance()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"r.squared\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adj.r.squared\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sigma\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"logLik\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BIC\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deviance\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df.residual\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"nobs\"],\"name\":[12],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"0\",\"3\":\"451\",\"4\":\"NA\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"-1980\",\"8\":\"3964\",\"9\":\"3971\",\"10\":\"53319113\",\"11\":\"262\",\"12\":\"263\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nOK, so the intercept is highly significant, the `t-statistic` is also\nhigh, but the intercept contributes *nothing* to the `r.squared`!!\n\n## {{< iconify flat-color-icons workflow >}} Workflow: Predictor Addition (Round#1)\n\nWe will now set up individual models for each predictor and look at the\n`p.value` and `r.squared` offered by each separate model:\n\n\n::: {.cell hash='forward-selection-1_cache/html/Round1-All individual models at once_6cdc24d1f0d3884c65d07d292cf78ef0'}\n\n```{.r .cell-code}\nnames <- names(Hitters %>%\n  select(where(is.numeric), \n         -c(Salary)))\nnames\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"AtBat\"   \"Hits\"    \"HmRun\"   \"Runs\"    \"RBI\"     \"Walks\"   \"Years\"  \n [8] \"CAtBat\"  \"CHits\"   \"CHmRun\"  \"CRuns\"   \"CRBI\"    \"CWalks\"  \"PutOuts\"\n[15] \"Assists\" \"Errors\" \n```\n:::\n\n```{.r .cell-code}\nn_vars <- length(names)\n\nHitters_model_set <- tibble(all_vars = list(names),\n                            keep_vars = seq(1, n_vars),\n                            data = list(Hitters))\nHitters_model_set # 12 rows\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"all_vars\"],\"name\":[1],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"keep_vars\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"data\"],\"name\":[3],\"type\":[\"list\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"<chr [16]>\",\"2\":\"1\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"2\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"3\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"4\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"5\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"6\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"7\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"8\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"9\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"10\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"11\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"12\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"13\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"14\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"15\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [16]>\",\"2\":\"16\",\"3\":\"<df[,20] [322 × 20]>\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Unleash purrr in a series of mutates\nHitters_model_set <- Hitters_model_set %>%\n  \n# list of predictor variables for each model\n  mutate(mod_vars =\n           pmap(\n             .l = list(all_vars, keep_vars, data),\n             .f = \\(all_vars, keep_vars, data) all_vars[keep_vars]\n           )) %>%\n  \n# build formulae with these for linear regression\n  mutate(formula = map(.x = mod_vars,\n                       .f = \\(mod_vars) as.formula(paste(\n                         \"Salary ~\", paste(mod_vars, collapse = \"+\")\n                       )))) %>%\n  \n# use the formulae to build multiple linear models\n  mutate(models =\n           pmap(\n             .l = list(data, formula),\n             .f = \\(data, formula) lm(formula, data = data)\n           ))\n# Check everything after the operation\nHitters_model_set\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"all_vars\"],\"name\":[1],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"keep_vars\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"data\"],\"name\":[3],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"mod_vars\"],\"name\":[4],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"formula\"],\"name\":[5],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"models\"],\"name\":[6],\"type\":[\"list\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"<chr [16]>\",\"2\":\"1\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"2\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"3\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"4\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"5\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"6\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"7\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"8\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"9\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"10\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"11\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"12\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"13\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"14\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"15\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [16]>\",\"2\":\"16\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Tidy up the models using broom to expose their metrics\nHitters_model_set <- \n  Hitters_model_set %>% \n  mutate(tidy_models =\n           map(\n             .x = models,\n             .f = \\(x) broom::glance(x,\n                                     conf.int = TRUE,\n                                     conf.lvel = 0.95)\n           ),\n         predictor_name = names[keep_vars]) %>% \n\n  # Remove unwanted columns, keep model and predictor count\n  select(keep_vars,predictor_name, tidy_models) %>%\n  unnest(tidy_models)\n\n\n# Plot r.squared vs predictor count\nHitters_model_set %>% \n  gf_point(r.squared ~ reorder(predictor_name, r.squared), \n           size = 3.5, \n           color = \"black\",\n           ylab = \"R.Squared\",\n           xlab = \"Params in the Linear Model\") %>%\n  gf_theme(my_theme()) %>% \n  gf_refine(theme(axis.text.x = element_text(angle = 30,\n                                             hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/Round1-All individual models at once-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='forward-selection-1_cache/html/unnamed-chunk-8_b7d95ad6b899ee863089515cca4d65ce'}\n\n```{.r .cell-code}\n# Which is the winning Predictor?\nwinner <- Hitters_model_set %>% \n  arrange(desc(r.squared)) %>% \n  select(predictor_name) %>% \n  head(1) %>% as.character()\nwinner\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"CRBI\"\n```\n:::\n:::\n\n\nSo we can add CRBI as a predictor to our model.\n\n\n::: {.cell hash='forward-selection-1_cache/html/unnamed-chunk-9_1dab240f0abba1b6773c2bd3f7fc16c0'}\n\n```{.r .cell-code}\n# Here is the Round 1 Model\nlm_round1 <- update(lm_min, ~. + CRBI)\nlm_round1 %>% broom::tidy()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"term\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"274.580\",\"3\":\"32.8554\",\"4\":\"8.36\",\"5\":\"3.85e-15\"},{\"1\":\"CRBI\",\"2\":\"0.791\",\"3\":\"0.0711\",\"4\":\"11.12\",\"5\":\"9.07e-24\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nlm_round1 %>% broom::glance()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"r.squared\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adj.r.squared\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sigma\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"logLik\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BIC\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deviance\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df.residual\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"nobs\"],\"name\":[12],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0.321\",\"2\":\"0.319\",\"3\":\"372\",\"4\":\"124\",\"5\":\"9.07e-24\",\"6\":\"1\",\"7\":\"-1929\",\"8\":\"3864\",\"9\":\"3875\",\"10\":\"36179679\",\"11\":\"261\",\"12\":\"263\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nSo adding `CRBI` to the model as a predictor gives us an improved\n`r.squared` of $0.321$, which is the square of the correlation between\n`Salary` and `CRBI`, $.567$.\n\nAnd the model itself is: $$\nSalary \\sim 274.580 + 0.791 \\times CRBI\n$$ {#eq-round1}\n\nLet's press on to Round 2.\n\n## {{< iconify flat-color-icons workflow >}} Workflow: Predictor Addition (Round #2)\n\nWe will set up a **round-2** model using `CRBI` as the predictor, and\nthen proceed to add each of the other predictors as an `update` to the\nmodel.\n\n\n::: {.cell hash='forward-selection-1_cache/html/Round 2_0a7a028cc0cd754b697fa09926966ecb'}\n\n```{.r .cell-code}\n# Preliminaries\nnames <- names(Hitters %>%\n  select(where(is.numeric), -c(Salary, winner)))\nnames\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"AtBat\"   \"Hits\"    \"HmRun\"   \"Runs\"    \"RBI\"     \"Walks\"   \"Years\"  \n [8] \"CAtBat\"  \"CHits\"   \"CHmRun\"  \"CRuns\"   \"CWalks\"  \"PutOuts\" \"Assists\"\n[15] \"Errors\" \n```\n:::\n\n```{.r .cell-code}\nn_vars <- length(names)\nn_vars\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 15\n```\n:::\n\n```{.r .cell-code}\n# names <- names %>% str_remove(winner)\n# names\n# n_vars <- n_vars-1\n\n\n# Round 2 Iteration\nHitters_model_set <- tibble(all_vars = list(names),\n                            keep_vars = seq(1, n_vars),\n                            data = list(Hitters))\nHitters_model_set \n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"all_vars\"],\"name\":[1],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"keep_vars\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"data\"],\"name\":[3],\"type\":[\"list\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"<chr [15]>\",\"2\":\"1\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"2\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"3\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"4\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"5\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"6\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"7\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"8\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"9\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"10\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"11\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"12\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"13\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"14\",\"3\":\"<df[,20] [322 × 20]>\"},{\"1\":\"<chr [15]>\",\"2\":\"15\",\"3\":\"<df[,20] [322 × 20]>\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Unleash purrr in a series of mutates\nHitters_model_set <- Hitters_model_set %>%\n  \n# list of predictor variables for each model\n  mutate(mod_vars =\n           pmap(\n             .l = list(all_vars, keep_vars, data),\n             .f = \\(all_vars, keep_vars, data) all_vars[keep_vars]\n           )) %>%\n  \n# build formulae with these for linear regression\n  mutate(formula = map(.x = mod_vars,\n                       .f = \\(mod_vars) as.formula(paste(\n                         \"Salary ~ CRBI +\", paste(mod_vars, collapse = \"+\")\n                       )))) %>%\n  \n# use the formulae to build multiple linear models\n  mutate(models =\n           pmap(\n             .l = list(data, formula),\n             .f = \\(data, formula) lm(formula, data = data)\n           ))\n# Check everything after the operation\nHitters_model_set\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"all_vars\"],\"name\":[1],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"keep_vars\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"data\"],\"name\":[3],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"mod_vars\"],\"name\":[4],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"formula\"],\"name\":[5],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"models\"],\"name\":[6],\"type\":[\"list\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"<chr [15]>\",\"2\":\"1\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"2\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"3\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"4\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"5\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"6\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"7\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"8\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"9\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"10\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"11\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"12\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"13\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"14\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"},{\"1\":\"<chr [15]>\",\"2\":\"15\",\"3\":\"<df[,20] [322 × 20]>\",\"4\":\"<chr [1]>\",\"5\":\"<S3: formula>\",\"6\":\"<S3: lm>\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Tidy up the models using broom to expose their metrics\nHitters_model_set <- \n  Hitters_model_set %>% \n  mutate(tidy_models =\n           map(\n             .x = models,\n             .f = \\(x) broom::glance(x,\n                                     conf.int = TRUE,\n                                     conf.lvel = 0.95)\n           ),\n         predictor_name = names[keep_vars]) %>% \n\n  # Remove unwanted columns, keep model and predictor count\n  select(keep_vars,predictor_name, tidy_models) %>%\n  unnest(tidy_models)\nHitters_model_set\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"keep_vars\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"predictor_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"r.squared\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adj.r.squared\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sigma\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"logLik\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BIC\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deviance\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df.residual\"],\"name\":[13],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"nobs\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"AtBat\",\"3\":\"0.3976814\",\"4\":\"0.3930482\",\"5\":\"351.4535\",\"6\":\"85.83261\",\"7\":\"2.384614e-29\",\"8\":\"2\",\"9\":\"-1913.399\",\"10\":\"3834.797\",\"11\":\"3849.086\",\"12\":\"32115095\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"2\",\"2\":\"Hits\",\"3\":\"0.4252237\",\"4\":\"0.4208024\",\"5\":\"343.3240\",\"6\":\"96.17497\",\"7\":\"5.430580e-32\",\"8\":\"2\",\"9\":\"-1907.244\",\"10\":\"3822.487\",\"11\":\"3836.776\",\"12\":\"30646560\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"3\",\"2\":\"HmRun\",\"3\":\"0.3452987\",\"4\":\"0.3402625\",\"5\":\"366.4176\",\"6\":\"68.56383\",\"7\":\"1.217914e-24\",\"8\":\"2\",\"9\":\"-1924.365\",\"10\":\"3856.729\",\"11\":\"3871.018\",\"12\":\"34908092\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"4\",\"2\":\"Runs\",\"3\":\"0.4185360\",\"4\":\"0.4140632\",\"5\":\"345.3156\",\"6\":\"93.57358\",\"7\":\"2.443276e-31\",\"8\":\"2\",\"9\":\"-1908.765\",\"10\":\"3825.530\",\"11\":\"3839.818\",\"12\":\"31003147\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"5\",\"2\":\"RBI\",\"3\":\"0.3834967\",\"4\":\"0.3787544\",\"5\":\"355.5678\",\"6\":\"80.86669\",\"7\":\"4.915855e-28\",\"8\":\"2\",\"9\":\"-1916.460\",\"10\":\"3840.919\",\"11\":\"3855.208\",\"12\":\"32871407\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"6\",\"2\":\"Walks\",\"3\":\"0.4002161\",\"4\":\"0.3956024\",\"5\":\"350.7133\",\"6\":\"86.74473\",\"7\":\"1.378243e-29\",\"8\":\"2\",\"9\":\"-1912.844\",\"10\":\"3833.688\",\"11\":\"3847.977\",\"12\":\"31979946\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"7\",\"2\":\"Years\",\"3\":\"0.3527210\",\"4\":\"0.3477420\",\"5\":\"364.3347\",\"6\":\"70.84076\",\"7\":\"2.766267e-25\",\"8\":\"2\",\"9\":\"-1922.865\",\"10\":\"3853.731\",\"11\":\"3868.019\",\"12\":\"34512340\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"8\",\"2\":\"CAtBat\",\"3\":\"0.3231804\",\"4\":\"0.3179741\",\"5\":\"372.5557\",\"6\":\"62.07483\",\"7\":\"9.151174e-23\",\"8\":\"2\",\"9\":\"-1928.734\",\"10\":\"3865.468\",\"11\":\"3879.756\",\"12\":\"36087418\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"9\",\"2\":\"CHits\",\"3\":\"0.3228655\",\"4\":\"0.3176568\",\"5\":\"372.6424\",\"6\":\"61.98549\",\"7\":\"9.721684e-23\",\"8\":\"2\",\"9\":\"-1928.795\",\"10\":\"3865.590\",\"11\":\"3879.879\",\"12\":\"36104210\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"10\",\"2\":\"CHmRun\",\"3\":\"0.3214597\",\"4\":\"0.3162402\",\"5\":\"373.0290\",\"6\":\"61.58775\",\"7\":\"1.273006e-22\",\"8\":\"2\",\"9\":\"-1929.068\",\"10\":\"3866.136\",\"11\":\"3880.424\",\"12\":\"36179165\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"11\",\"2\":\"CRuns\",\"3\":\"0.3280999\",\"4\":\"0.3229314\",\"5\":\"371.1993\",\"6\":\"63.48114\",\"7\":\"3.544982e-23\",\"8\":\"2\",\"9\":\"-1927.775\",\"10\":\"3863.549\",\"11\":\"3877.838\",\"12\":\"35825119\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"12\",\"2\":\"CWalks\",\"3\":\"0.3224249\",\"4\":\"0.3172127\",\"5\":\"372.7636\",\"6\":\"61.86064\",\"7\":\"1.057963e-22\",\"8\":\"2\",\"9\":\"-1928.881\",\"10\":\"3865.761\",\"11\":\"3880.050\",\"12\":\"36127705\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"13\",\"2\":\"PutOuts\",\"3\":\"0.3827233\",\"4\":\"0.3779750\",\"5\":\"355.7908\",\"6\":\"80.60248\",\"7\":\"5.786049e-28\",\"8\":\"2\",\"9\":\"-1916.624\",\"10\":\"3841.249\",\"11\":\"3855.537\",\"12\":\"32912644\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"14\",\"2\":\"Assists\",\"3\":\"0.3279397\",\"4\":\"0.3227700\",\"5\":\"371.2435\",\"6\":\"63.43502\",\"7\":\"3.656548e-23\",\"8\":\"2\",\"9\":\"-1927.806\",\"10\":\"3863.612\",\"11\":\"3877.901\",\"12\":\"35833659\",\"13\":\"260\",\"14\":\"263\"},{\"1\":\"15\",\"2\":\"Errors\",\"3\":\"0.3250961\",\"4\":\"0.3199046\",\"5\":\"372.0281\",\"6\":\"62.62002\",\"7\":\"6.330673e-23\",\"8\":\"2\",\"9\":\"-1928.361\",\"10\":\"3864.722\",\"11\":\"3879.011\",\"12\":\"35985276\",\"13\":\"260\",\"14\":\"263\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Plot r.squared vs predictor count\nHitters_model_set %>% \n  gf_point(r.squared ~ reorder(predictor_name, r.squared), \n                               size = 3.5,\n                               ylab = \"R.Squared\",\n                               xlab = \"Param in the Linear Model\") %>%\n  gf_theme(my_theme()) %>% \n  gf_refine(theme(axis.text.x = element_text(angle = 30, \n                                             hjust = 1)))\n```\n\n::: {.cell-output-display}\n![](forward-selection-1_files/figure-html/Round 2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Which is the winning Predictor?\nwinner <- Hitters_model_set %>% \n  arrange(desc(r.squared)) %>% \n  select(predictor_name) %>% \n  head(1) %>% as.character()\nwinner\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Hits\"\n```\n:::\n\n```{.r .cell-code}\n# Here is the Round 1 Model\nlm_round2 <- update(lm_round1, ~. + Hits)\nlm_round2 %>% broom::tidy()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"term\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"-47.9559022\",\"3\":\"55.98245029\",\"4\":\"-0.8566239\",\"5\":\"3.924416e-01\"},{\"1\":\"CRBI\",\"2\":\"0.6898994\",\"3\":\"0.06723076\",\"4\":\"10.2616634\",\"5\":\"5.780322e-21\"},{\"1\":\"Hits\",\"2\":\"3.3008446\",\"3\":\"0.48177499\",\"4\":\"6.8514237\",\"5\":\"5.275361e-11\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nlm_round2 %>% broom::glance()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"r.squared\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adj.r.squared\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sigma\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"logLik\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BIC\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deviance\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df.residual\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"nobs\"],\"name\":[12],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0.4252237\",\"2\":\"0.4208024\",\"3\":\"343.324\",\"4\":\"96.17497\",\"5\":\"5.43058e-32\",\"6\":\"2\",\"7\":\"-1907.244\",\"8\":\"3822.487\",\"9\":\"3836.776\",\"10\":\"30646560\",\"11\":\"260\",\"12\":\"263\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nAnd now the model itself is: $$\nSalary \\sim -47.96 + 0.691 \\times CRBI + 3.30 \\times Hits\n$$ {#eq-round2}\n\nNote the change in both `intercept` and the `slope` for `CRBI` when the\nnew predictor `Hits` is added!!\n\n## {{< iconify octicon feed-discussion-16 >}} Discussion\n\nIt is interesting that the second variable to be added was `Hits` which\nhas a lower correlation of $0.439$ with `Salary` compared to some other\nQuant predictors such as `Chits`( $0.525$ ). This is because `CRBI` is\nhugely correlated with all of these predictors, so `CRDI` effectively\nacts as a proxy for all of these. See Plot 3.\n\nWe see that adding `Hits` to the model gives us an improved `r.squared`\nof $0.425$.\n\n## {{< iconify fluent-mdl2 decision-solid >}} Conclusion\n\nWe can proceed in this way to subsequent rounds and decide to stop when\nthe model complexity (no. of predictors ) and the resulting gain in\n`r.squared` does not seem worth it.\n\n::: callout-note\n### Iteration Method\n\nWe ought to convert the above code into an R `function` and run it that\nway for a specific number of rounds to see how things pan out. That is\nin the next version of this Tutorial! 😇\n:::\n\n## {{< iconify ooui references-rtl >}} References\n\n1.  <https://ethanwicker.com/2021-01-11-multiple-linear-regression-002/>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}