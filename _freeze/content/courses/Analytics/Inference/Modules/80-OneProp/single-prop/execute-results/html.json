{
  "hash": "1db536888c54f20c34f860494e55f611",
  "result": {
    "markdown": "---\ntitle: \"\\U0001F0CF Testing a Single Proportion\"\nauthor: \"Arvind Venkatadri\"\ndate: 10/Nov/2022\ndate-modified: \"2023-04-17\"\nabstract: \"Using Permutation Tests to check the significance of a proportion\"\norder: 80\ncategories:\n- Permutation\n- Monte Carlo Simulation\n- Random Number Generation\n- Distributions\n- Generating Parallel Worlds\n---\n\n\n## {{< fa folder-open >}} Slides and Tutorials\n\n| <a href=\"./files/one-prop-tutorial.qmd\"><i class=\"fa-brands                                 \n                                 fa-r-project\"></i> R Tutorial</a>                            |     |     |     |\n|---------------------------------------------------------------------------------------------|-----|-----|-----|\n\n## {{< iconify noto-v1 package >}} Setting up R packages\n\n\n::: {.cell hash='single-prop_cache/html/setup_4c8ada96c71e88b0dcde245599290a6b'}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = TRUE,message = TRUE,warning = TRUE, fig.align = \"center\")\noptions(digits=2)\nlibrary(tidyverse)\nlibrary(mosaic)\nlibrary(ggmosaic) # plotting mosaic plots for Categorical Data\nlibrary(vcd) # Creating Tables and plotting mosaic charts\n\n### Dataset from Chihara and Hesterberg's book (Second Edition)\nlibrary(resampledata)\n```\n:::\n\n\n## Introduction\n\nWe saw from the diagram created by Allen Downey that *there is only one\ntest*! We will now use this philosophy to develop a technique that\nallows us to mechanize several *Statistical Models* in that way, with\nnearly identical code.\n\nWe will use two packages in R, `mosaic` to develop our intuition for\nwhat are called **permutation** based statistical tests. (There is also\na more recent package called `infer` in R which can do pretty much all\nof this, including visualization. In my opinion, the code is a little\ntoo high-level and does not offer quite the detailed insight that the\n`mosaic` package does).\n\n## Permutation Visually Demonstrated\n\nWe will look visually at a permutation exercise. We will create dummy\ndata that contains the following case study:\n\n> A set of identical resumes was sent to male and female evaluators. The\n> candidates in the resumes were of both genders. We wish to see if\n> there was difference in the way resumes were evaluated, by male and\n> female evaluators. (We use just *one* male and *one* female evaluator\n> here, to keep things simple!)\n\n\n::: {.cell hash='single-prop_cache/html/Artificial Data_c80041b0dcf7ef978dcbd1989e6aeabd'}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"evaluator\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"candidate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"0\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"0\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"0\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"F\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"1\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"0\"},{\"1\":\"M\",\"2\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"evaluator\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"selection_ratio\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"count\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"F\",\"2\":\"0.1250000\",\"3\":\"3\",\"4\":\"24\"},{\"1\":\"M\",\"2\":\"0.4583333\",\"3\":\"11\",\"4\":\"24\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n         M \n-0.3333333 \n```\n:::\n:::\n\n\nSo, we have a solid disparity in percentage of selection between the two\nevaluators! Let us first plot this:\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-3_a19652aacb400764c003bcefa39f555a'}\n::: {.cell-output-display}\n![](single-prop_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nNow we pretend that *there is no difference between the selections made\nby either set of evaluators*. So we can just:\n\n-   Pool up all the evaluations\n\n-   Arbitrarily re-assign a given candidate(selected or rejected) to\n    either of the two sets of evaluators, by permutation.\n\n    How would that pooled shuffled set of evaluations look like?\n\n\n    ::: {.cell hash='single-prop_cache/html/Shuffle the data once_674f094d9eab8ab70f5a4fc7752fc1ce'}\n    ::: {.cell-output-display}\n    `````{=html}\n    <div data-pagedtable=\"false\">\n      <script data-pagedtable-source type=\"application/json\">\n    {\"columns\":[{\"label\":[\"evaluator\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"selection_ratio\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"count\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"F\",\"2\":\"0.2500000\",\"3\":\"6\",\"4\":\"24\"},{\"1\":\"M\",\"2\":\"0.3333333\",\"3\":\"8\",\"4\":\"24\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n      </script>\n    </div>\n    `````\n    :::\n    :::\n\n    ::: {.cell hash='single-prop_cache/html/unnamed-chunk-5_74854b51fe1760c90119b1fd33ca6a5d'}\n    \n    :::\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-6_67015cada7e485bfa0d908c6e8b89163'}\n\n:::\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-7_e273d93220dc0f9e6462cc2fb8d4de3f'}\n::: {.cell-output-display}\n![](single-prop_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nAs can be seen, the ratio is different! We can now do this many many\ntimes, to check out our Hypothesis that there is *no* bias. We can plot\nthe distribution of the differences in selection ratio and see how that\nartificially created distribution compares with mother-nature, the\noriginally observed figure.\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-8_9362882b9e1448dca7f3c462e6410cb5'}\n\n```{.r .cell-code}\nnull_dist <- do(10000) * diff(mean(candidate ~ shuffle(evaluator), data = data))\nnull_dist %>% names()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"M\"\n```\n:::\n\n```{.r .cell-code}\nnull_dist %>% gf_histogram( ~ M, \n                            fill = ~ (M <= obs_difference)) %>% \n  gf_vline(xintercept = ~ obs_difference, color = \"red\" )\n```\n\n::: {.cell-output-display}\n![](single-prop_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmean(~ M<= obs_difference, data = null_dist)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0129\n```\n:::\n:::\n\n\nWe see that the artificial data can hardly ever (\\$ p = 0.012\\$) mimic\nwhat the real world experiment is showing. Hence we had good reason to\nreject our Hypothesis that there is no bias.\n\n## Testing for Two or More Proportions\n\nLet us try a dataset with Qualitative / Categorical data. This is the\n`General Social Survey GSS dataset`, and we have people with different\nlevels of `Education` stating their opinion on the `Death Penalty`. We\nwant to know if these two Categorical variables have a correlation, i.e.\ncan the opinions in favour of the `Death Penalty` be explained by the\n`Education` level?\n\nSince data is Categorical ( both variables ), we need to take `counts`\nin a table, and then implement a `chi-square test`. In the test, we will\npermute the `Education` variable to see if we can see how significant\nits *effect size* is.\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-9_c07fde04ca23fef9be594ed8466cb20b'}\n\n```{.r .cell-code}\ndata(GSS2002)\ninspect(GSS2002)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\ncategorical variables:  \n            name  class levels    n missing\n1         Region factor      7 2765       0\n2         Gender factor      2 2765       0\n3           Race factor      3 2765       0\n4      Education factor      5 2760       5\n5        Marital factor      5 2765       0\n6       Religion factor     13 2746      19\n7          Happy factor      3 1369    1396\n8         Income factor     24 1875     890\n9       PolParty factor      8 2729      36\n10      Politics factor      7 1331    1434\n11     Marijuana factor      2  851    1914\n12  DeathPenalty factor      2 1308    1457\n13        OwnGun factor      3  924    1841\n14        GunLaw factor      2  916    1849\n15 SpendMilitary factor      3 1324    1441\n16     SpendEduc factor      3 1343    1422\n17      SpendEnv factor      3 1322    1443\n18      SpendSci factor      3 1266    1499\n19        Pres00 factor      5 1749    1016\n20      Postlife factor      2 1211    1554\n                                    distribution\n1  North Central (24.7%) ...                    \n2  Female (55.6%), Male (44.4%)                 \n3  White (79.1%), Black (14.8%) ...             \n4  HS (53.8%), Bachelors (16.1%) ...            \n5  Married (45.9%), Never Married (25.6%) ...   \n6  Protestant (53.2%), Catholic (24.5%) ...     \n7  Pretty happy (57.3%) ...                     \n8  40000-49999 (9.1%) ...                       \n9  Ind (19.3%), Not Str Dem (18.9%) ...         \n10 Moderate (39.2%), Conservative (15.8%) ...   \n11 Not legal (64%), Legal (36%)                 \n12 Favor (68.7%), Oppose (31.3%)                \n13 No (65.5%), Yes (33.5%) ...                  \n14 Favor (80.5%), Oppose (19.5%)                \n15 About right (46.5%) ...                      \n16 Too little (73.9%) ...                       \n17 Too little (60%) ...                         \n18 About right (49.7%) ...                      \n19 Bush (50.6%), Gore (44.7%) ...               \n20 Yes (80.5%), No (19.5%)                      \n\nquantitative variables:  \n  name   class min  Q1 median   Q3  max mean       sd    n missing\n1   ID integer   1 692   1383 2074 2765 1383 798.3311 2765       0\n```\n:::\n:::\n\n\nNote how *all* variables are Categorical !! `Education` has five\n`levels`, and of course `DeathPenalty` has three:\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-10_63bc22c5d15af21ccbbc19262e9c0b03'}\n\n```{.r .cell-code}\nGSS2002 %>% count(Education)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Education\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Left HS\",\"2\":\"400\"},{\"1\":\"HS\",\"2\":\"1485\"},{\"1\":\"Jr Col\",\"2\":\"202\"},{\"1\":\"Bachelors\",\"2\":\"443\"},{\"1\":\"Graduate\",\"2\":\"230\"},{\"1\":\"NA\",\"2\":\"5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nGSS2002 %>% count(DeathPenalty)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"DeathPenalty\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Favor\",\"2\":\"899\"},{\"1\":\"Oppose\",\"2\":\"409\"},{\"1\":\"NA\",\"2\":\"1457\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nLet us drop NA entries in `Education` and `Death Penalty` and set up a\n**Contingency Table**.\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-11_7a2cd2c5bab472146f5e4ec1cde3c039'}\n\n```{.r .cell-code}\ngss2002 <- GSS2002 %>% \n  dplyr::select(Education, DeathPenalty) %>% \n  tidyr::drop_na(., c(Education, DeathPenalty))\n\n\n\ngss_table <- tally(DeathPenalty ~ Education, data = gss2002)\ngss_table %>% \n  addmargins()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Education\nDeathPenalty Left HS   HS Jr Col Bachelors Graduate  Sum\n      Favor      117  511     71       135       64  898\n      Oppose      72  200     16        71       50  409\n      Sum        189  711     87       206      114 1307\n```\n:::\n:::\n\n\n## Contingency Table Plots\n\nThe Contingency Table can be plotted, as we have seen, using a `mosaic`\nplot using several packages:\n\n::: panel-tabset\n### Using `ggformula`\n\nNeed a little more work, to convert the Contigency Table into a tibble:\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-12_69eddc752efd1d87944082247939e524'}\n\n```{.r .cell-code}\n# https://stackoverflow.com/questions/19233365/how-to-create-a-marimekko-mosaic-plot-in-ggplot2\n\ngss_summary <- gss2002 %>%\n  mutate(\n    Education = factor(\n      Education,\n      levels = c(\"Bachelors\", \"Graduate\", \"Jr Col\", \"HS\", \"Left HS\"),\n      labels = c(\"Bachelors\", \"Graduate\", \"Jr Col\", \"HS\", \"Left HS\")\n    ),\n    DeathPenalty = as.factor(DeathPenalty)\n  ) %>%\n  group_by(Education, DeathPenalty) %>%\n  summarise(count = n()) %>% # This is good for a chisq test\n  \n  # Add two more columns to facilitate mosaic/Marrimekko Plot\n  # \n  mutate(edu_count = sum(count), \n         edu_prop = count / sum(count)) %>%\n  ungroup() \n\ngf_col(edu_prop ~ Education, data = gss_summary,\n       width = ~ edu_count, \n       fill = ~ DeathPenalty,\n       stat = \"identity\", \n       position = \"fill\", \n       color = \"black\") %>% \n  \n  gf_text(edu_prop ~ Education, \n          label = ~ scales::percent(edu_prop),\n          position = position_stack(vjust = 0.5)) %>% \n  \n  gf_facet_grid(~ Education, \n                scales = \"free_x\", \n                space = \"free_x\") %>% \n  \n  gf_theme(scale_fill_manual(values = c(\"orangered\", \"palegreen3\"))) %>% \n  gf_theme(theme_void())\n```\n\n::: {.cell-output-display}\n![](single-prop_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n### Using `vcd`\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-13_0001838364e442875906e75c3de927cc'}\n\n```{.r .cell-code}\nvcd::mosaic(gss_table, gp = shading_hsv)\n```\n\n::: {.cell-output-display}\n![](single-prop_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### Using `ggmosaic`\n\n\n::: {.cell hash='single-prop_cache/html/mosaic-plot_f05ff368e8fddd3305a7ea5f44ed7af2'}\n\n```{.r .cell-code}\n#library(ggmosaic)\n\nggplot(data = gss2002) +\n  geom_mosaic(aes(x = product(DeathPenalty, Education), \n                  fill = DeathPenalty))\n```\n\n::: {.cell-output-display}\n![](single-prop_files/figure-html/mosaic-plot-1.png){width=672}\n:::\n:::\n\n:::\n\n## Observed Statistic: the $X^2$ metric\n\nWhen there are multiple proportions involved, the $X^2$ test is what is\nused.\n\n::: panel-tabset\n### Intuitive Explanation\n\nLet us look at the Contingency Table that we have:\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-14_cc10bd8ebf523e0cba3aba05b2475d60'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Contigency Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Left HS </th>\n   <th style=\"text-align:right;\"> HS </th>\n   <th style=\"text-align:right;\"> Jr Col </th>\n   <th style=\"text-align:right;\"> Bachelors </th>\n   <th style=\"text-align:right;\"> Graduate </th>\n   <th style=\"text-align:right;\"> Sum </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Favor </td>\n   <td style=\"text-align:right;\"> 117 </td>\n   <td style=\"text-align:right;\"> 511 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 135 </td>\n   <td style=\"text-align:right;\"> 64 </td>\n   <td style=\"text-align:right;\"> 898 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Oppose </td>\n   <td style=\"text-align:right;\"> 72 </td>\n   <td style=\"text-align:right;\"> 200 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:right;\"> 409 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sum </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 711 </td>\n   <td style=\"text-align:right;\"> 87 </td>\n   <td style=\"text-align:right;\"> 206 </td>\n   <td style=\"text-align:right;\"> 114 </td>\n   <td style=\"text-align:right;\"> 1307 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nIn the chi-square test, we check whether the two ( or more ) categorical\nvariables are independent. To do this we perform a simple check on the\nContingency Table. We first *re-compute* the totals in each row and\ncolumn, based on what we could **expect** if there was independence\n(NULL Hypothesis). If the two variables were independent, then there\nshould be **no difference** between real and expected scores.\n\nHow do we know what scores to expect?\n\nConsider the entry in location (1,1): 117. The number of **expected**\nentries there is probability of an entry landing in that square times\nthe total number of entries:\n\n::: column-body-outset\n\n```{=tex}\n\\begin{align}\n\n\\text{Expected Value at location[1,1]}\n&= p_{row_1} * p_{col_1} * \\text{Total Scores}\\\\\\\n&= \\frac{\\text{Row-1-Total}}{\\text{Total Scores}} * \\frac{\\text{Col-1-Total}}{\\text{Total Scores}} * \\text{Total Scores}\\\\\\\n&= \\frac{898}{1307} * \\frac{189}{1307} * 1307\\\\\\\n&= 130\n\n\n\\end{align}\n```\n\n:::\n\nProceeding in this way for all the 15 entries in the Contingency Table,\nwe get the \"Expected\" Contingency Table. Here are both tables for\ncomparison:\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-15_c4d8338dee8cd189f8ed05f0ed72f895'}\n\n:::\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-16_46ed489e021e7dc62d19c2c1cc4db5bf'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Expected Contigency Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Left HS </th>\n   <th style=\"text-align:right;\"> HS </th>\n   <th style=\"text-align:right;\"> Jr Col </th>\n   <th style=\"text-align:right;\"> Bachelors </th>\n   <th style=\"text-align:right;\"> Graduate </th>\n   <th style=\"text-align:right;\"> Sum </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Favor </td>\n   <td style=\"text-align:right;\"> 130 </td>\n   <td style=\"text-align:right;\"> 489 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> 142 </td>\n   <td style=\"text-align:right;\"> 78 </td>\n   <td style=\"text-align:right;\"> 898 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Oppose </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 222 </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 64 </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:right;\"> 409 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sum </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 711 </td>\n   <td style=\"text-align:right;\"> 87 </td>\n   <td style=\"text-align:right;\"> 206 </td>\n   <td style=\"text-align:right;\"> 114 </td>\n   <td style=\"text-align:right;\"> 1307 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-17_1331923eb484bcbd5843d0338e561125'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Actual Contigency Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Left HS </th>\n   <th style=\"text-align:right;\"> HS </th>\n   <th style=\"text-align:right;\"> Jr Col </th>\n   <th style=\"text-align:right;\"> Bachelors </th>\n   <th style=\"text-align:right;\"> Graduate </th>\n   <th style=\"text-align:right;\"> Sum </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Favor </td>\n   <td style=\"text-align:right;\"> 117 </td>\n   <td style=\"text-align:right;\"> 511 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 135 </td>\n   <td style=\"text-align:right;\"> 64 </td>\n   <td style=\"text-align:right;\"> 898 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Oppose </td>\n   <td style=\"text-align:right;\"> 72 </td>\n   <td style=\"text-align:right;\"> 200 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:right;\"> 409 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sum </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 711 </td>\n   <td style=\"text-align:right;\"> 87 </td>\n   <td style=\"text-align:right;\"> 206 </td>\n   <td style=\"text-align:right;\"> 114 </td>\n   <td style=\"text-align:right;\"> 1307 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThe $X^2$ statistic is sum of squared differences between `Observed` and\n`Expected` scores, scaled by the `Expected Scores`. For location \\[1,1\\]\nthis would be: $(117-130)^2/189$. Do try to compute all of these and the\n$X^2$ statistic by hand !!\n\n### Code\n\nLet us now perform the base `chisq test`: We need a `table` and then the\n`chisq` test:\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-18_4a60ede8fa5f5db725e0d25f258aee20'}\n\n```{.r .cell-code}\n# gss_table <- tally(DeathPenalty ~ Education, data = gss2002)\n# gss_table\n\n# Get the observed chi-square statistic\nobservedChi2 <- mosaic::chisq(tally(DeathPenalty ~ Education, data = gss2002))\nobservedChi2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nX.squared \n 23.45093 \n```\n:::\n\n```{.r .cell-code}\n# Actual chi-square test\nstats::chisq.test(tally(DeathPenalty ~ Education, data = gss2002))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  tally(DeathPenalty ~ Education, data = gss2002)\nX-squared = 23.451, df = 4, p-value = 0.0001029\n```\n:::\n:::\n\n\nWe see that our observed $X^2 = 23.45$.\n:::\n\n### Hypotheses Definition\n\nWhat would our Hypotheses be?\n\n$H_0: \\text{Education does not affect votes for Death Penalty}$\n$H_a: \\text{Education affects votes for Death Penalty}$\n\n### Permutation Test for `Education`\n\nWe should now repeat the test with permutations on `Education`:\n\n\n::: {.cell hash='single-prop_cache/html/unnamed-chunk-19_61251fd800849d5cd37ef63ff744e279'}\n\n```{.r .cell-code}\nnull_chisq <- do(10000) * \n  chisq.test(tally(DeathPenalty ~ shuffle(Education), \n                   data = gss2002))\n\nhead(null_chisq)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"X.squared\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"method\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"alternative\"],\"name\":[5],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"data\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".row\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\".index\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"14.549702\",\"2\":\"4\",\"3\":\"0.005732347\",\"4\":\"Pearson's Chi-squared test\",\"5\":\"NA\",\"6\":\"tally(DeathPenalty ~ shuffle(Education), data = gss2002)\",\"7\":\"1\",\"8\":\"1\",\"_rn_\":\"X-squared...1\"},{\"1\":\"5.309958\",\"2\":\"4\",\"3\":\"0.256946218\",\"4\":\"Pearson's Chi-squared test\",\"5\":\"NA\",\"6\":\"tally(DeathPenalty ~ shuffle(Education), data = gss2002)\",\"7\":\"1\",\"8\":\"2\",\"_rn_\":\"X-squared...2\"},{\"1\":\"7.160400\",\"2\":\"4\",\"3\":\"0.127650736\",\"4\":\"Pearson's Chi-squared test\",\"5\":\"NA\",\"6\":\"tally(DeathPenalty ~ shuffle(Education), data = gss2002)\",\"7\":\"1\",\"8\":\"3\",\"_rn_\":\"X-squared...3\"},{\"1\":\"10.944128\",\"2\":\"4\",\"3\":\"0.027199167\",\"4\":\"Pearson's Chi-squared test\",\"5\":\"NA\",\"6\":\"tally(DeathPenalty ~ shuffle(Education), data = gss2002)\",\"7\":\"1\",\"8\":\"4\",\"_rn_\":\"X-squared...4\"},{\"1\":\"3.826154\",\"2\":\"4\",\"3\":\"0.430044300\",\"4\":\"Pearson's Chi-squared test\",\"5\":\"NA\",\"6\":\"tally(DeathPenalty ~ shuffle(Education), data = gss2002)\",\"7\":\"1\",\"8\":\"5\",\"_rn_\":\"X-squared...5\"},{\"1\":\"4.728618\",\"2\":\"4\",\"3\":\"0.316293014\",\"4\":\"Pearson's Chi-squared test\",\"5\":\"NA\",\"6\":\"tally(DeathPenalty ~ shuffle(Education), data = gss2002)\",\"7\":\"1\",\"8\":\"6\",\"_rn_\":\"X-squared...6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ngf_histogram( ~ X.squared, data = null_chisq) %>% \n  \n  gf_vline(xintercept = observedChi2, \n           color = \"red\") %>% \n  gf_theme(theme = theme_classic())\n```\n\n::: {.cell-output-display}\n![](single-prop_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n```{.r .cell-code}\nprop1(~ X.squared >= observedChi2, data = null_chisq)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n prop_TRUE \n0.00029997 \n```\n:::\n:::\n\n\nThe `p-value` is well below our threshold of $0.05$, so we would\nconclude that `Education` has a significant effect on `DeathPenalty`\nopinion!\n\n## Conclusion\n\nWhy would a permutation test be a good idea here?\n\nIn our basic $X^2$ test, we calculate the test statistic of $X^2$ and\nlook up a *theoretical* null distribution for that statistic, and see\nhow unlikely our observed value is.\n\nWith a permutation test, there are *no assumptions* of the null\ndistribution: this is computed based on real data. We note in passing\nthat, in this case, since the number of `cases` in each cell of the\nContingency Table are fairly high ( \\>= 5) the resulting NULL\ndistribution is of the $X^2$ variety.\n\n## References\n\n1.  [OpenIntro Modern Statistics: Chapter\n    17](https://openintro-ims.netlify.app/inference-one-prop.html)\n2.  \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../../../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../../../../../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}