---
title: "\U0001F4CA Distributions, Densities, Bar Plots, and Boxplots"
subtitle: "How many of this and that?"
author: "Arvind Venkatadri"
date: 15/Nov/2022
date-modified: "`r Sys.Date()`"
abstract: "Quant and Qual Variable Graphs and their Siblings"
order: 20
image: preview.jpg
image-alt: Image by rawpixel.com
categories:
- Qual Variables
- Quant Variables
- Bar Charts
- Column Charts
- Histograms
- Density Plots
- Box Plots
bibliography: references.bib
---

## {{< fa folder-open >}} Slides and Tutorials

|                                                                                                 |                                                                                                    |                                                                                        |
|------------------------|------------------------|------------------------|
| <a href="./files/distributions.qmd"><i class="fa-brands fa-r-project"></i> R (Static Viz)</a>   | <a href="./files/distributions.rda"> <i class="fa-solid fa-person-rays"></i> Radiant Tutorial</a>  | <a href="./files/data/qdd-data.zip"> <i class="fa-solid fa-database"></i> Datasets</a> |

## {{< iconify noto-v1 package >}} Setting up R Packages

```{r}
#| label: setup
#| include: true
#| message: false
#| warning: false

library(tidyverse)
library(mosaic)
library(palmerpenguins)
library(ggformula)
library(ggridges)
library(skimr)

# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

```


```{r}
#| label: Extra Pedagogical Packages
#| echo: false
#| message: false

library(checkdown)
library(epoxy)
library(TeachHist)
library(TeachingDemos)

```

## {{< iconify fxemoji japanesesymbolforbeginner >}} What graphs will we see today?

Some of the very basic and commonly used plots for data are:

-   Bar and Column Charts
-   Histograms and Frequency Distributions
-   Box Plots
-   Ridge Plots ( Quant + Qual variables)

Let us listen to the late great Hans Rosling from the [Gapminder
Project](https://www.gapminder.org), which aims at telling stories of
the world with data, to remove systemic biases about poverty, income and
gender related issues.

{{< video https://vimeo.com/127511255 >}}

### {{< iconify ic round-addchart >}} Graphing Packages in R

There are several Data Visualization packages, even systems, within R.

-   Base R supports graph making out of the box;

-   The most well known is `ggplot` <https://ggplot2-book.org/> which
    uses Leland Wilkinson's concept of a "Grammar of Graphics";

-   There is the `lattice` package
    <https://lattice.r-forge.r-project.org/> which uses the "Trellis
    Graphics" concept framework for data visualization developed
    by R. A. Becker, W. S. Cleveland, et al.;

-   And the `grid` package
    <https://bookdown.org/rdpeng/RProgDA/the-grid-package.html> that
    allows extremely fine control of `shapes` plotted on the graph.

Each system has its benefits and learning complexities. We will look at
plots created using the simpler and intuitive `ggformula` system that
uses the popular`ggplot` framework, but provides a simplified interface
that is easy to recall and apply. While our first option will be to use
`ggformula`, we will, where appropriate state `ggplot` code too for
comparison.

A quick reminder on how `mosaic` and `ggformula` work in a very similar
fashion:

::: callout-tip
### `mosaic` and `ggformula` command template

Note the standard method for all commands from the `mosaic` and
`ggformula` packages: `goal( y ~ x | z, data = _____)`

With `ggformula`, one can create any graph/chart using:
`gf_***(y ~ x | z, data = _____)`

In practice, we often use: `dataframe %>%  gf_***(y ~ x | z)` which has
cool benefits such as "autocompletion" of variable names, as we shall
see. The "\*\*\*" indicates what kind of graph you desire: histogram,
bar, scatter, density; the "\_\_\_" is the name of your dataset that you
want to plot with.
:::

::: callout-tip
### `ggplot` command template

The `ggplot`2 template is used to identify the dataframe, identify the x
and y axis, and define visualized layers:

`ggplot(data = ---, mapping = aes(x = ---, y = ---)) + geom_----()`

Note: ---- is meant to imply text you supply. e.g. function names, data
frame names, variable names.

It is helpful to see the argument mapping, above. In practice, rather
than typing the formal arguments, code is typically shorthanded to this:

`dataframe %>%  ggplot(aes(xvar, yvar)) + geom_----()`
:::

## {{< iconify icon-park-outline chart-histogram >}} Histograms and Bar Charts

**Histograms** are best to show the distribution of raw *quantitative
data*,by displaying the number of values that fall within defined
ranges, often called *buckets* or *bins*. We use a **Quant** variable on
the `x-axis` and the histogram shows us how frequently different values
occur for that variable by showing *counts/frequencies* on the y-axis.
The x-axis is typically broken up into "buckets" or ranges for the
x-variable, And usually you can adjust the bucket ranges to explore
frequency patterns. For example, you can shift histogram buckets from
0-1, 1-2, 2-3, etc. to 0-2, 2-4, etc.

Although histograms may look similar to **Bar Charts**, the two are
different. First, histograms show *continuous Quant data*. By contrast,
bar charts show *categorical data*, such as apples, bananas, carrots,
etc.

Second, histograms do not usually show spaces between buckets because
these are *continuous values*, while column charts show spaces to
separate each *category*.

## {{< iconify grommet-icons test >}} Case Study-1: `diamonds` dataset

We will first look at at a dataset that is directly available in R, the
`diamonds` dataset.

### {{< iconify file-icons influxdata >}} Examine the Data

As per our Workflow, we will look at the data using all the three
methods we have seen.

```{r}
#| label: using-glimpse
glimpse(diamonds)

```

```{r}
#| label: skim-diamonds
skim(diamonds)

```

```{r}
#| label: inspect-diamonds
inspect(diamonds)

```

::: callout-note
### Business Insights on Examining the `diamonds` dataset

-   This is a large dataset (54K rows).
-   There are several Qualitative variables: `cut`, `color` and
    `clarity`. These have 5, 7, and 8 levels. The fact that the `class`
    for these is `ordered` suggests that these are factors and that the
    levels have a sequence/order.
-   `carat`, `price`, `x`, `y`, `z`, `depth` and `table` are
    Quantitative variables.
-   There are no missing values for any variable, all are complete with
    54K entries.
:::

### {{< iconify ph chart-bar >}} Plotting Histograms

Let's plot some histograms.

::: {.panel-tabset .nav-pills style="background: whitesmoke;"}
### Using ggformula

```{r}
#| label: histograms-ggformula
#| layout-ncol: 2
# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

gf_histogram(~ price, data = diamonds) %>%
  gf_labs(title = "Plot A: Diamond Prices",caption = "ggformula")

###
diamonds %>% gf_histogram(~ price, 
                          fill = ~ cut, 
                          alpha = 0.3) %>%
  gf_labs(title = "Plot B: Prices by Cut",caption = "ggformula")

###
diamonds %>% gf_histogram(~ price,
                          fill = ~ cut) %>%
  gf_facet_wrap(~ cut) %>%
  gf_labs(title = "Plot C: Prices by Filled and Facetted by Cut",
          caption = "ggformula") %>%
  gf_theme(theme(axis.text.x = element_text(angle = 45, hjust = 1)))

###
diamonds %>% gf_histogram(~ price,
                          fill = ~ cut, color = "black") %>% 
  gf_facet_wrap(~ cut, scales = "free_y", nrow = 2) %>%
  gf_labs(title = "Plot D: Prices Filled and Facetted by Cut", 
          subtitle = "Free y-scale",
          caption = "ggformula") %>%
  gf_theme(theme(axis.text.x = element_text(angle = 45, hjust = 1)))

```

### Using ggplot

```{r}
#| label: histograms-ggplot
#| layout-ncol: 2
#| message: false

# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

ggplot(data = diamonds) + 
  geom_histogram(aes(x = price)) +
  labs(title = "Plot A: Diamond Prices",caption = "ggplot")

###
diamonds %>% ggplot() + 
  geom_histogram(aes(x = price, 
                     fill = cut), 
                     alpha = 0.3) + 
  labs(title = "Plot B: Prices by Cut",caption = "ggplot")

###
diamonds  %>% ggplot() + 
  geom_histogram(aes(price, fill = cut)) +
  facet_wrap(facets = vars(cut)) + 
  labs(title = "Plot C: Prices by Filled and Facetted by Cut",
       caption = "ggplot") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



###
diamonds  %>% ggplot() + 
  geom_histogram(aes(price, fill = cut), color = "black") +
  facet_wrap(facets = vars(cut), scales = "free_y") +
  labs(title = "Plot D: Prices by Filled and Facetted by Cut",
       subtitle = "Free y-scale",
       caption = "ggplot") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
:::

::: callout-note
### Business Insights from `diamond` Histograms

-   The price distribution is heavily skewed to the right. There are
    many diamonds that have low prices and relatively few diamonds that
    are very expensive. This `long-tailed` nature of the histogram holds
    true **regardless** of the `cut` of the diamond.
-   See the x-axis range for each plot in Plot D! Price ranges are the
    same regardless of cut !! Very surprising! So `cut` is perhaps not
    the only thing that determines price...
-   Facetting the plot into *small multiples* helps look at patterns
    better: overlapping histograms are hard to decipher. Adding `color`
    defines the bars in the histogram very well.
:::

::: callout-important
### A Hypothesis

The surprise insight above should lead you to make a Hypothesis! You
should decide whether you want to investigate this question further,
making more graphs, as we will see. Here, we are making a **Hypothesis**
that more than just `cut` determines the `price` of a diamond.
:::

### {{< iconify ic baseline-bar-chart >}} Plotting Barcharts

Let's plot some bar graphs: recall that for bar charts, we need to
choose **Qual** variables to count with!

::: {.panel-tabset .nav-pills style="background: whitesmoke;"}
### Using ggformula

```{r}
#| label: bar-charts-ggformula
#| layout-ncol: 2

# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

gf_bar(~ cut, data = diamonds) %>%
  gf_labs(title = "Plot A: Diamonds Counts of different Cuts")


###
diamonds %>% gf_bar( ~ cut, fill = ~ cut) %>%
  gf_labs(title = "Plot B: Diamonds Counts filled by Cut")


###
diamonds %>% gf_bar( ~ cut, fill = ~ clarity, 
                     position = "stack",
                     alpha = 0.3) %>%
  gf_labs(title = "Plot C: Diamonds Counts by Cut filled by Clarity",
          subtitle = "Stacked Bar Chart")

###
diamonds %>% gf_bar( ~ cut, fill = ~ clarity, 
                     position = "dodge",
                     color = "black") %>%
  gf_refine(scale_fill_viridis_d(option = "turbo")) %>% # inferno, magma, cividis...etc
  gf_labs(title = "Plot D: Diamonds Counts by Cut filled by Clarity",
          subtitle = "Dodged Bar Chart",
          caption = "Turbo Palette from Viridis set")
```


```{r}
diamonds %>% gf_bar( ~ cut, 
                     fill = ~ clarity, 
                     position = "dodge", 
                     colour = "black") %>%
  gf_facet_wrap(vars(color),scales = "free_y") %>%
  gf_refine(scale_fill_viridis_d(option = "turbo")) %>%
  gf_theme(theme(axis.text.x = element_text(angle = 45,hjust = 1))) %>%
  gf_labs(title = "Plot E: Diamonds Counts by Cut filled by Clarity",
          subtitle = "Dodged Bar Chart Facetted by Color",
          caption = "Turbo Palette from Viridis set")
```

### Using ggplot

```{r}
#| label: bar-charts-ggplot
#| layout-ncol: 2

# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

ggplot(diamonds)  + 
  geom_bar(aes(cut)) + 
  labs(title = "Plot A: Diamonds Counts of different Cuts")


###
diamonds %>% ggplot() + 
  geom_bar(aes(cut, fill = cut) ) + 
  labs(title = "Plot B: Diamonds Counts filled by Cut")


###
diamonds %>% ggplot() + 
  geom_bar(aes(cut, fill = clarity), 
               position = "stack",
              alpha = 0.3) + 
  labs(title = "Plot C: Diamonds Counts by Cut filled by Clarity",
       subtitle = "Stacked Bar Chart")

###
diamonds %>% ggplot() + 
  geom_bar(aes(cut, fill = clarity), 
               position = "dodge",
               color = "black") + 
  scale_fill_viridis_d(option = "turbo") +  # inferno, magma, cividis...etc
  labs(title = "Plot D: Diamonds Counts by Cut filled by Clarity",
       subtitle = "Dodged Bar Chart",
       caption = "Turbo Palette from Viridis set")
```


```{r}
diamonds %>% ggplot() + 
  geom_bar(aes(cut, fill = clarity), 
               position = "dodge", 
               colour = "black") +
  facet_wrap(vars(color), scales = "free_y") + 
  scale_fill_viridis_d(option = "turbo") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1)) + 
  labs(title = "Plot E: Diamonds Counts by Cut filled by Clarity",
       subtitle = "Dodged Bar Chart Facetted by Color",
       caption = "Turbo Palette from Viridis set")
```
:::

::: callout-note
### Business Insights from `diamond` Bar Charts

As seen before the counts for different values of `cut` are not the
same:

-   the dataset is not balanced.
-   From Plot D, the counts per level of `cut` increase steadily, with
    `Ideal` cut dominating.
-   And the counts at different values of `clarity` within each `cut`
    are also not equal; the levels `VS1, VS2, VVS1, VVS2` tend to be
    higher.
-   From Plot E, we have `cut`, `clarity` facetted by `color`. The
    overall counts are higher for the `Ideal` `cut` across all `color`s.
-   Among the `color`s, the color `J` seems to have the lowest counts,
    judging from the y-axis limits.
:::

### {{< iconify mdi chart-bell-curve >}} Plotting Densities

You might imagine a density chart as a histogram where the buckets are
infinitesimally small, i.e. zero width. This may seem counter-intuitive,
but densities have their uses in spotting the ranges in the data where
there are more frequent values. In this, they serve a similar purpose as
do histograms, but may offer insights not readily apparent with
histograms, especially with default bucket widths.

::: {.panel-tabset .nav-pills style="background: whitesmoke;"}
### Using ggformula

```{r}
#| label: density-charts-ggformula
#| layout-ncol: 2

# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

gf_density(~ price, data = diamonds) %>%
  gf_labs(title = "Plot A: Diamond Prices",caption = "ggformula")

###
diamonds %>% gf_density(~ price, 
                          fill = ~ cut, 
                          color = ~ cut,
                          alpha = 0.3) %>%
  gf_refine(scale_color_viridis_d(option = "magma",
                                  aesthetics = c("colour", "fill"))) %>%
  gf_labs(title = "Plot B: Prices by Cut",caption = "ggformula")

###
diamonds %>% gf_density(~ price,
                          fill = ~ cut) %>%
  gf_facet_wrap(vars(cut)) %>%
  gf_labs(title = "Plot C: Prices by Filled and Facetted by Cut",caption = "ggformula") 

###
diamonds %>% gf_density(~ price,
                          fill = ~ cut, 
                        color = "black") %>% 
  gf_facet_wrap(vars(cut), scales = "free_y", nrow = 2) %>%
  gf_labs(title = "Plot D: Prices Filled and Facetted by Cut", 
          subtitle = "Free y-scale", caption = "ggformula") %>%
  gf_theme(theme(axis.text.x = element_text(angle = 45,hjust = 1)))


```

### Using ggplot

```{r}
#| label: density-charts-ggplot
#| layout-ncol: 2

# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

diamonds %>% ggplot() + 
  geom_density(aes(price)) +
  labs(title = "Plot A: Diamond Prices",caption = "ggplot")

###
diamonds %>% ggplot() + 
  geom_density(aes(price, 
                   fill = cut, 
                   color = cut),
                   alpha = 0.3) +
  scale_color_viridis_d(option = "magma",
                        aesthetics = c("colour", "fill")) + 
  labs(title = "Plot B: Prices by Cut",caption = "ggplot")

###
diamonds %>% ggplot() + 
  geom_density(aes(price,
                   fill = cut)) + 
  facet_wrap(vars(cut)) + 
  labs(title = "Plot C: Prices by Filled and Facetted by Cut",
      caption = "ggplot") 

###
diamonds %>% ggplot() + 
  geom_density(aes(price,
                   fill = cut), 
                   color = "black") + 
  facet_wrap(vars(cut), scales = "free_y", nrow = 2) + 
  labs(title = "Plot D: Prices Filled and Facetted by Cut", 
          subtitle = "Free y-scale", caption = "ggplot") + 
  theme(axis.text.x = element_text(angle = 45,hjust = 1))


```
:::

::: callout-note
### Business Insights from `diamond` Densities

Pretty much similar conclusions as with histograms. Although densities
may not be used much in business contexts, they are *better* than
histograms when *comparing multiple distributions*! So you should use
thems!
:::

### {{< iconify carbon box-plot >}} Box Plots

Most plots do some internal calculations before creating the plots, such
as "counts" in bar charts, and also "buckets + counts" in histograms.

With boxplots, the *values* of a Quant variable are ranked in increasing
order of magnitude. The `median` and the `interquartile range` are also
calculated, and so are the `outliers`.

::: {.panel-tabset .nav-pills style="background: whitesmoke;"}
### Using ggformula

```{r}
#| label: Boxplots-ggformula
#| layout-ncol: 2
gf_boxplot(price ~ ., data = diamonds) %>% 
  gf_labs(title = "Plot A: Boxplot for Diamond Prices")

###
diamonds %>% 
  gf_boxplot(price ~ cut) %>% 
  gf_labs(title = "Plot B: Price by Cut")

###
diamonds %>% 
  gf_boxplot(price ~ cut, 
             fill = ~ cut, 
             color = ~ cut,
             alpha = 0.3) %>% 
  gf_labs(title = "Plot C: Price by Cut")

###
diamonds %>% 
  gf_boxplot(price ~ cut, 
             fill = ~ cut, 
             colour = ~ cut,             
             alpha = 0.3) %>% 
  gf_facet_wrap(vars(clarity)) %>%
  gf_labs(title = "Plot D: Price by Cut facetted by Clarity") %>%
  gf_theme(theme(axis.text.x = element_text(angle = 45,hjust = 1)))

```

### Using ggplot

```{r}
#| label: Boxplots-ggplots
#| layout-ncol: 2
diamonds %>% ggplot() + 
  geom_boxplot(aes(y = price)) + # note: y, not x
  labs(title = "Plot A: Boxplot for Diamond Prices")

###
diamonds %>% ggplot() + 
  geom_boxplot(aes(cut, price)) + 
  labs(title = "Plot B: Price by Cut")

###
diamonds %>% ggplot() + 
  geom_boxplot(aes(cut, 
                   price, 
                   color = cut, fill = cut), alpha = 0.4) +
  labs(title = "Plot C: Price by Cut")

###
diamonds %>% ggplot() + 
  geom_boxplot(aes(cut, 
                   price, 
                   color = cut, fill = cut), alpha = 0.4)  +  
  facet_wrap(vars(clarity)) +
  labs(title = "Plot D: Price by Cut facetted by Clarity") +
  theme(axis.text.x = element_text(angle = 45,hjust = 1))

```
:::

::: callout-note
### Business Insights from Boxplots

-   Plot A shows the presence of quite some high-end outliers; the
    median `price` is USD2500.
-   When broken up by Qual variable `cut` we see that the median mileage
    for different drive trains are slightly different...but not steadily
    increasing, on the contrary the median price drops for `Good`,
    `VeryGood` cuts, increases for `Premium` but stragely again drops
    for `Ideal` cuts.
-   This could again mean that `cut` alone does not determine diamond
    prices...
-   Similar trends with Plot D showing facetted plots
:::


### {{< iconify streamline nature-ecology-rainbow-arch-rain-colorful-rainbow-curve-half-circle >}} Ridge Plots

Sometimes we may wish to show the distribution/density of a Quant
variable, against several *levels* of a Qual variable. For instance, the
prices of different items of furniture, based on the furniture "style"
variable. Or the `sales` of a particular line of products, across
different shops or cities. We did this with both histograms and
densities, by colouring based on a Qual variable, and by facetting using
a Qual variable. There is a third way, using what is called a *ridge plot*. Ridge Plots currently have their own package; neither `ggformula`
nor `ggplot` supports it directly.


```{r}
#| label: more-charts
#| layout-nrow: 2
# library(ggridges)
gf_density_ridges(drv ~ hwy, fill = ~ drv, 
                  alpha = 0.3, 
                  rel_min_height = 0.005, data = mpg) %>% 
  gf_refine(scale_y_discrete(expand = c(0.01, 0)),
            scale_x_continuous(expand = c(0.01, 0))) %>% 
  gf_labs(title = "Ridge Plot")


```

::: callout-note
### Business Insights from `mpg` Ridge Plots

This is another way of visualizing multiple distributions, of a Quant
variable at different levels of a Qual variable. We see that the
distribution of `hwy` mileage varies substantially with `drv` type.
:::


## {{< iconify grommet-icons test >}} Case Study-2: race dataset

### {{< iconify mdi database-import-outline >}} Import data

The data come from the
[TidyTuesday](https://github.com/rfordatascience/tidytuesday), project,
a weekly social learning project dedicated to gaining practical
experience with R and data science. In this case the TidyTuesday data
are based on [International Trail Running Association
(ITRA)](https://itra.run/Races/FindRaceResults) data but inspired by
Benjamin Nowak. We will use the [TidyTuesday data that are on
GitHub](https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-10-26).
Nowak's data are [also available on
GitHub](https://github.com/BjnNowak/UltraTrailRunning).

```{r}
#| message: false
#| warning: false
race_df <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-26/race.csv")
rank_df <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-26/ultra_rankings.csv")

```

### {{< iconify file-icons influxdata >}} Examine the race Data

Let us look at the dataset using all our three methods:

```{r}
#| label: glimpse-race-data
glimpse(race_df)
glimpse(rank_df)

```

```{r}
#| label: glimpse-race-data-1
skim(race_df)
```

```{r}
#| label: glimpse-race-data-2
skim(rank_df)
```


```{r}
#| label: inspect-race
# inspect(race_df) # does not work with hms and difftime variables
inspect(rank_df)

```

:::callout-note
### Business Insights from `race` data
- We have two datasets, one for races (`race_df`) and one for the ranking of athletes (`rank_df`).
- There is atleast one common column between the two, the `race_year_id` variable. 
- Overall, there are *Qualitative* variables such as `country`, `city`,`gender`, and `participation`. This last variables seems badly coded, with entries showing `solo` and `Solo`. 
- *Quantitative variables* are `rank`, `time`,`time_in_seconds`, `age` from `rank_df`; and  `distance`, `elevation_gain`, `elevation_loss`,`particants`, and `aid_stations` from `race_df`.
- We have 1207 races and over 130K participants! But some races do show *zero* participants!! Is that an error in data entry?

:::

### {{< iconify fluent-mdl2 explore-data >}} EDA with `race` datasets

::: callout-note
Questions: Which countries host the maximum number of races? Which countries send the maximum number of participants??
```{r}
race_df %>% count(country) %>% arrange(desc(n))
rank_df %>% count(nationality) %>% arrange(desc(n))
```

The top three locations for races were the USA, UK, and France. These are also the countries that send the maximum number of participants, naturally!
:::


::: callout-note
Questions: Which countries have the maximum number of winners (top 3 ranks)? 
```{r}
rank_df %>% 
  filter(rank %in% c(1,2,3)) %>%
  count(nationality) %>% arrange(desc(n))

```

1240 Participants from the USA have been top 3 finishers. Across *all* races...

:::


:::callout-note
Question: Which countries have had the most top-3 finishes in the  **longest** distance race?

Here we see we have ranks in one dataset, and race details in another! How do we do this now? We have to **join** the two data frames into one data frame, using a *common variable* that uniquely identifies observations in **both** datasets. 


```{r}
#| layout-nrow: 2

longest_races <- race_df %>%
  slice_max(n = 5, order_by = distance) # Longest distance races
longest_races

longest_races %>%
  left_join(., rank_df, by  = "race_year_id") %>% # total participants in longest 4 races
  filter(rank %in% c(1:10)) %>% # Top 10 ranks
  count(nationality) %>% arrange(desc(n))

```

Wow....France has one the top 10 positions 26 times in the longest races... which take place in France, Thailand, Chad, Australia, and Portugal. So although the USA has the greatest number of top 10 finishes, when it comes to the *longest* races, it is *vive la France*!
:::

::: callout-note
Question: What is the distribution of the finishing times, across all races and all ranks?

```{r}
# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))
rank_df %>%
  gf_histogram(~ time_in_seconds, bins = 75)

```

So the distribution is (very) roughly bell-shaped, spread over a 2X range. And some people may have dropped out of the race very early and hence we have a small bump close to *zero* time!
The histogram shows three bumps...at least one reason is that the distances to be covered are not the same...but could there be other reasons? Like `altitude_gained` for example?
:::

:::callout_note
Question: What is the distribution of race distances?
```{r}
# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))
race_df %>%
  gf_histogram(~ distance, bins =  50)

```

Hmm...a closely clumped set of race distances, with some entries in between [0-150], but some are zero? Which are these?

```{r}
race_df %>%
  filter(distance == 0)
```

Curious...some of these zero-distance races have had participants too! Perhaps these were cancelled events...all of them are stated to be `100 mile` events...

:::

::: callout-note
Question: For all races that have a distance around 150, what is the distribution of finishing times? Can these be split/facetted using `start_time` of the race (i.e. morning / evening) ?

Let's make a count of start times:

```{r}
race_times <- race_df %>%
  count(start_time) %>% arrange(desc(n))
race_times

```

Let's convert `start_time` into a `factor` with levels: early_morning(0200:0600), late_morning(0600:1000), midday(1000:1400),
afternoon(1400: 1800), evening(1800:2200), and night(2200:0200)

```{r}
#| label: Slicing_time_to_Qual
# Demo purposes only!
# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))

race_start_factor <- race_df %>%
  mutate(
    start_day_time =
      case_when(
        start_time > hms("02:00:00") &
          start_time <= hms("06:00:00") ~ "early_morning",
        
        start_time > hms("06:00:00") &
          start_time <= hms("10:00:00") ~ "late_morning",
        
        start_time > hms("10:00:00") &
          start_time <= hms("14:00:00") ~ "mid_day",
        
        start_time > hms("14:00:00") &
          start_time <= hms("18:00:00") ~ "afternoon",
        
        start_time > hms("18:00:00") &
          start_time <= hms("22:00:00") ~ "evening",
        
        start_time > hms("22:00:00") &
          start_time <= hms("23:59:59") ~ "night",
        
        start_time >= hms("00:00:0") &
          start_time <= hms("02:00:00") ~ "postmidnight",
        
        TRUE ~ "other"
      )
  ) %>%
  mutate(start_day_time = 
           as_factor(start_day_time) %>%
           fct_collapse(.f = ., 
               night = c("night", "postmidnight")))
##
# Join with rank_df
race_start_factor %>%
  left_join(rank_df, by = "race_year_id") %>%
  drop_na(time_in_seconds) %>%
  gf_histogram(
    ~ time_in_seconds,
    bins = 75,
    fill = ~ start_day_time,
    color = ~ start_day_time,
    alpha = 0.5
  ) %>%
  gf_facet_wrap(vars(start_day_time), ncol = 2, scales = "free_y")

```

We see that finish times tend to be longer for afternoon and evening start races; these are lower for early morning and night time starts. 
Mid-day starts show a curious double hump in finish times that should be studied. 

:::


## {{< iconify entypo new >}} Distributions and Densities in the Wild

Before we conclude, let us look at a real world dataset: populations of
countries. This dataset was taken from Kaggle
<https://www.kaggle.com/datasets/ulrikthygepedersen/populations>. Click
on the icon below to save the file into a *subfolder* called `data` in
your project folder:

{{< downloadthis data/populations.csv dname=Salaries label="Download the Populations data" icon=database-fill-down type=info class=data-button id=populations >}}

```{r}
#| layout-nrow: 2
#| column: body-outset-right
pop <- read_csv("data/populations.csv")
pop
inspect(pop)

```

Let us plot densities/histograms for `value`:

```{r}
#| label: skewed-histogram
#| layout-ncol: 2
# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))
##
gf_histogram(~ value, data = pop, title = "Long Tailed Histogram") 
##
gf_density(~ value, data = pop, title = "Long Tailed Density")

```

These graphs convey very little to us: the data is very heavily skewed
to the right and much of the chart is empty. There are many countries
with small populations and a few countries with very large populations.
Such distributions are also called **"long tailed"** distributions. To
develop better insights with this data, we should transform the variable
concerned, using say a "log" transformation:

```{r}
#| label: skewed-density
#| layout-ncol: 2
# Set graph theme
ggplot2::theme_set(new = theme_classic(base_size = 14, 
                                       base_family = "sans"))
##
gf_histogram(~ log10(value), data = pop, title = "Histogram with Log transformed x-variable") 
##
gf_density(~ log10(value), data = pop, title = "Density with Log transformed x-variable")

```

Be prepared to transform your data with `log` or `sqrt` transformations
when you see skewed distributions! Salaries, Instagram connections,
number of customers vs Companies, net worth /valuation of Companies,
extreme events on stock markets....all of these could have highly skewed distributions. In such a case, the standard statistics of mean/median/sd may not convey too much information.


## {{< iconify ph bell-simple-z-duotone >}} Z-scores

Often when we compute wish to compare distributions with different values for means and standard deviations, we resort to a *scaling* of the variables that are plotted in the respective distributions. 

TBW.

```{r}
#| label: z-scores
#| echo: false
#| layout-ncol: 2
library(TeachHist)
TeachHistDens(Mean = 60, Sd = 5)

TeachHistDens(Mean = 60, Sd = 10)

```


## {{< iconify fluent-mdl2 decision-solid >}} Conclusion

-   Histograms, Frequency Distributions, and Box Plots are used for
    Quantitative data variables
-   Histograms "dwell upon" **counts**, **ranges**, **means** and
    **standard deviations**
-   Frequency Density plots "dwell upon" **probabilities** and
    **densities**
-   Box Plots "dwell upon" **medians** and **Quartiles**
-   Qualitative data variables can be plotted as **counts**, using Bar
    Charts, or using Heat Maps
-   2D density plots are used for describing *two quant* variables
-   Ridge Plots are **density plots** used for describing one Quant and
    one Qual variable (by inherent splitting)
-   We can split all these plots on the basis of another Qualitative
    variable.(Ridge Plots are already split)
-   Long tailed distributions need care in visualization and in
    inference making!

## {{< iconify openmoji person >}} Your Turn

<a href="./files/data/qdd-data.zip">
<i class="fa-solid fa-database"></i> Datasets</a>

1.  Click on the Dataset Icon above, and unzip that archive. Try to make
    distribution plots with each of the three tools.
2.  A dataset from calmcode.io <https://calmcode.io/datasets.html>
3.  Old Faithful Data in R (Find it!)

`inspect` the dataset in each case and develop a set of Questions, that
can be answered by appropriate stat measures, or by using a chart to
show the distribution.

## {{< iconify ooui references-rtl >}} References

1.  See the scrolly animation for a histogram at this website:
    **Exploring Histograms, an essay by Aran Lunzer and Amelia
    McNamara** <https://tinlizzie.org/histograms/?s=09>
2.  Minimal R using `mosaic`.
    <https://cran.r-project.org/web/packages/mosaic/vignettes/MinimalRgg.pdf>
3.  [*Plotting multiple plots using purrr::map and ggplot*. Sebastian
    Sauer](https://data-se.netlify.app/2021/02/06/plotting-multiple-plots-using-purrr-map-and-ggplot/)
