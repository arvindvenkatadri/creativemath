<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Arvind Venkatadri">
<meta name="dcterms.date" content="2023-05-15">
<title>The Foundation Series - Correlations in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../../../">
<script src="../../../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="../../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<meta property="og:title" content="The Foundation Series - Correlations in R">
<meta property="og:description" content="Tests, Tables, and Graphs for Correlations in R">
<meta property="og:site-name" content="The Foundation Series">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../../../index.html">
    <span class="navbar-title">The Foundation Series</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arvindvenkatadri/my-quarto-website"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/arvind_v"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../../../../../www.linkedin.com/in/arvindvenkatadri"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Correlations in R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Teaching</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../../../../../content/courses/Analytics/listing.html" class="sidebar-item-text sidebar-link">Data Analytics</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">
<li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/Analytics/Tools/listing.html" class="sidebar-item-text sidebar-link">Tools and Software</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/Analytics/Descriptive/listing.html" class="sidebar-item-text sidebar-link">Descriptive Analytics</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/Analytics/Inference/listing.html" class="sidebar-item-text sidebar-link">Statistical Inference</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/Analytics/Modelling/listing.html" class="sidebar-item-text sidebar-link">Inferential Modelling</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/Analytics/Predictive/listing.html" class="sidebar-item-text sidebar-link">Predictive Analytics</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/Analytics/Prescriptive/listing.html" class="sidebar-item-text sidebar-link">Prescriptive Analytics</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/Analytics/Workflow/listing.html" class="sidebar-item-text sidebar-link">Workflow</a>
  </div>
</li>
      </ul>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/R4Artists/listing.html" class="sidebar-item-text sidebar-link">R for Artists and Managers</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/TRIZ4ProbSolving/listing.html" class="sidebar-item-text sidebar-link">TRIZ for Innovation</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/MathModelsDesign/listing.html" class="sidebar-item-text sidebar-link">Math Models in Design</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/NoCode/listing.html" class="sidebar-item-text sidebar-link">Data Vis with No Code</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/courses/ISTW/listing.html" class="sidebar-item-text sidebar-link">In Short, the World</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/posts/listing.html" class="sidebar-item-text sidebar-link">Posts</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../../../content/projects/listing.html" class="sidebar-item-text sidebar-link">Blogs</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
<li><a href="#case-study--1-dataset-from-mosaicdata" id="toc-case-study--1-dataset-from-mosaicdata" class="nav-link" data-scroll-target="#case-study--1-dataset-from-mosaicdata">Case Study -1: Dataset from <code>mosaicData</code></a></li>
  <li><a href="#correlations-and-plots" id="toc-correlations-and-plots" class="nav-link" data-scroll-target="#correlations-and-plots">Correlations and Plots</a></li>
  <li><a href="#case-study--2-dataset-from-nhanes" id="toc-case-study--2-dataset-from-nhanes" class="nav-link" data-scroll-target="#case-study--2-dataset-from-nhanes">Case Study -2: Dataset from <code>NHANES</code></a></li>
  </ul>
</li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Correlations in R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arvind Venkatadri </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    Tests, Tables, and Graphs for Correlations in R
  </div>
</div>

</header><section id="introduction" class="level1"><h1>Introduction</h1>
<p>We will create Tables for Correlations, and graphs for Correlations in R. As always, we will consistently use the <a href="https://mosaic-web.org"><strong>Project Mosaic</strong></a> ecosystem of packages in R (<code>mosaic</code>, <code>mosaicData</code> and <code>ggformula</code>).</p>
<div class="cell" data-hash="correlations_cache/html/setup_b6e93a8ad02db57b07bd39b8ae7865b3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(mosaic) <span class="co"># package for stats, simulations, and basic plots</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(mosaicData) <span class="co"># package containing datasets</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(ggformula) <span class="co"># package for professional looking plots, that use the formula interface from mosaic</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(NHANES) <span class="co"># survey data collected by the US National Center for Health Statistics (NCHS)</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(corrplot) <span class="co"># For Correlogram plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body" style="background: beige">
<p>Note the standard method for all commands from the <code>mosaic</code> package:</p>
<p><code>goal( y ~ x | z, data = mydata, …)</code></p>
<p>With <code>ggformula</code>, one can create any graph/chart using:</p>
<p><code>gf_geometry(y ~ x | z, data = mydata)</code></p>
<p>OR</p>
<p><code>mydata %&gt;% gf_geometry( y ~ x | z)</code></p>
<p>The second method may be preferable, especially if you have done some data manipulation first! More later!</p>
</div>
</div>
<section id="case-study--1-dataset-from-mosaicdata" class="level2"><h2 class="anchored" data-anchor-id="case-study--1-dataset-from-mosaicdata">Case Study -1: Dataset from <code>mosaicData</code>
</h2>
<p>Let us inspect what datasets are available in the package <code>mosaicData</code>. Run this command in your Console:</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-2_b298f83ad85523fcb2e7de7072f05b5c">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Run in Console</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">data</span>(<span class="at">package =</span> <span class="st">"mosaicData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The popup tab shows a lot of datasets we could use. Let us continue to use the famous <code>Galton</code> dataset and <code>inspect</code> it:</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-3_9859fe2e41946e231419c10ed68145e9">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">data</span>(<span class="st">"Galton"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">inspect</span>(Galton)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
categorical variables:  
    name  class levels   n missing
1 family factor    197 898       0
2    sex factor      2 898       0
                                   distribution
1 185 (1.7%), 166 (1.2%), 66 (1.2%) ...        
2 M (51.8%), F (48.2%)                         

quantitative variables:  
    name   class min Q1 median   Q3  max      mean       sd   n missing
1 father numeric  62 68   69.0 71.0 78.5 69.232851 2.470256 898       0
2 mother numeric  58 63   64.0 65.5 70.5 64.084410 2.307025 898       0
3 height numeric  56 64   66.5 69.7 79.0 66.760690 3.582918 898       0
4  nkids integer   1  4    6.0  8.0 15.0  6.135857 2.685156 898       0</code></pre>
</div>
</div>
<p>The <code>inspect</code> command already gives us a series of statistical measures of different variables of interest. As discussed previously, we can retain the output of <code>inspect</code> and use it in our reports: (there are ways of dressing up these tables too)</p>
<div class="cell" data-hash="correlations_cache/html/Galton-inspect_2e29ef3219487bd823d9e4c4282213f6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>galton_describe <span class="ot">&lt;-</span> <span class="fu">inspect</span>(Galton)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>galton_describe<span class="sc">$</span>categorical</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["class"],"name":[2],"type":["chr"],"align":["left"]},{"label":["levels"],"name":[3],"type":["int"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["missing"],"name":[5],"type":["int"],"align":["right"]},{"label":["distribution"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"family","2":"factor","3":"197","4":"898","5":"0","6":"185 (1.7%), 166 (1.2%), 66 (1.2%) ..."},{"1":"sex","2":"factor","3":"2","4":"898","5":"0","6":"M (51.8%), F (48.2%)"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>galton_describe<span class="sc">$</span>quantitative</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["class"],"name":[2],"type":["chr"],"align":["left"]},{"label":["min"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Q1"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["median"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Q3"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["max"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["mean"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[10],"type":["int"],"align":["right"]},{"label":["missing"],"name":[11],"type":["int"],"align":["right"]}],"data":[{"1":"father","2":"numeric","3":"62","4":"68","5":"69.0","6":"71.0","7":"78.5","8":"69.232851","9":"2.470256","10":"898","11":"0","_rn_":"1"},{"1":"mother","2":"numeric","3":"58","4":"63","5":"64.0","6":"65.5","7":"70.5","8":"64.084410","9":"2.307025","10":"898","11":"0","_rn_":"2"},{"1":"height","2":"numeric","3":"56","4":"64","5":"66.5","6":"69.7","7":"79.0","8":"66.760690","9":"3.582918","10":"898","11":"0","_rn_":"3"},{"1":"nkids","2":"integer","3":"1","4":"4","5":"6.0","6":"8.0","7":"15.0","8":"6.135857","9":"2.685156","10":"898","11":"0","_rn_":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Try <code>help("Galton")</code> in your Console. The dataset is described as:</p>
<blockquote class="blockquote">
<p>A data frame with 898 observations on the following variables.<br>
- <code>family</code> a factor with levels for each family<br>
- <code>father</code> the father’s height (in inches)<br>
- <code>mother</code> the mother’s height (in inches)<br>
- <code>sex</code> the child’s sex: F or M<br>
- <code>height</code> the child’s height as an adult (in inches)<br>
- <code>nkids</code> the number of adult children in the family, or, at least, the number whose heights Galton recorded.</p>
</blockquote>
<p>There is a lot of Description generated by the <code><a href="https://rdrr.io/pkg/mosaicCore/man/inspect.html">mosaic::inspect()</a></code> command ! What can we say about the dataset and its variables? How big is the dataset? How many variables? What types are they, Quant or Qual? If they are Qual, what are the <em>levels</em>? Are they <em>ordered</em> levels? Discuss!</p>
</section><section id="correlations-and-plots" class="level2"><h2 class="anchored" data-anchor-id="correlations-and-plots">Correlations and Plots</h2>
<p>What Questions might we have, that we could answer with a Statistical Measure, or Correlation chart?</p>
<p>Q.1 Which are the variables that have significant pair-wise correlations? What polarity are these correlations?</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-4_b6eebb35311d48caf96acb8999f8dfa5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Pulling out the list of Quant variables from NHANES</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>galton_quant <span class="ot">&lt;-</span> galton_describe<span class="sc">$</span>quantitative</span>
<span id="cb7-3"><a href="#cb7-3"></a>galton_quant<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "father" "mother" "height" "nkids" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>  Galton,</span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"father"</span>, <span class="st">"mother"</span>, <span class="st">"height"</span>, <span class="st">"nkids"</span>),</span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="st">"densityDiag"</span>),</span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="at">title =</span> <span class="st">"Galton Data Correlations Plot"</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Can we plot a Correlogram for this dataset?</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-5_f2d46e27baec78d8060b5a242c2ac52a">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">#library(corrplot)</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>galton_num_var <span class="ot">&lt;-</span> Galton <span class="sc">%&gt;%</span> <span class="fu">select</span>(father, mother, height, nkids)</span>
<span id="cb10-4"><a href="#cb10-4"></a>galton_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(galton_num_var)</span>
<span id="cb10-5"><a href="#cb10-5"></a>galton_cor <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">corrplot</span>(<span class="at">method =</span> <span class="st">"ellipse"</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>           <span class="at">type =</span> <span class="st">"lower"</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>           <span class="at">main =</span> <span class="st">"Correlogram for Galton dataset"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Clearly <code>height</code> is positively correlated to <code>father</code> and <code>mother</code>; interestingly, <code>height</code> is negatively correlated ( slightly) with <code>nkids</code>.</p>
<p>Q.2: Let us confirm with a test:</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-6_b3ec87f54fc388917c8df77f0a72511e">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>mosaic<span class="sc">::</span><span class="fu">cor_test</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  height and father
t = 8.5737, df = 896, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.2137851 0.3347455
sample estimates:
      cor 
0.2753548 </code></pre>
</div>
</div>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-7_7dbe297f6d92244be2f3f5698325d1c4">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>mosaic<span class="sc">::</span><span class="fu">cor_test</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  height and mother
t = 6.1628, df = 896, p-value = 1.079e-09
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.1380554 0.2635982
sample estimates:
      cor 
0.2016549 </code></pre>
</div>
</div>
<p>Q.3 What does this correlation look when split by <code>sex</code> of Child?</p>
<p>We will use the <code>mosaic</code> function <code>cor_test</code> to get these results:</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-8_40dd28badefe634ce571a837af0636f8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># For the sons</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>mosaic<span class="sc">::</span><span class="fu">cor_test</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  height and father
t = 9.1498, df = 463, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.3114667 0.4656805
sample estimates:
      cor 
0.3913174 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">cor_test</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  height and mother
t = 7.628, df = 463, p-value = 1.367e-13
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.2508178 0.4125305
sample estimates:
      cor 
0.3341309 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># For the daughters</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">cor_test</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  height and father
t = 10.719, df = 431, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.3809944 0.5300812
sample estimates:
      cor 
0.4587605 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">cor_test</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  height and mother
t = 6.8588, df = 431, p-value = 2.421e-11
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.2261463 0.3962226
sample estimates:
      cor 
0.3136984 </code></pre>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Correlation Scores and Uncertainty
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note how the <code>cor.test</code> reports a correlation score and the <code>p-value</code> for the same. There is also a <code>confidence interval</code> reported for the correlation score, an interval within which we are 95% sure that the true correlation value is to be found. Note that GGally too reports the significance of the correlation scores using <code>***</code> or <code>**</code>. This indicates the p-value in the scores obtained by GGally; Presumably, there is an internal <code>cor.test</code> that is run for each pair of variables and the p-value and confidence levels are also computed internally.</p>
</div>
</div>
<p>We can also visualise this uncertainty and the confidence levels in a plot too, using <code>gf_errorbar</code> and a handy set of functions within <code>purrr</code> which is part of the tidyverse: Assuming <code>heights</code> is the variable we want to correlate every other (quantitative) variable against, we can proceed very quickly as follows:</p>
<div class="cell" data-hash="correlations_cache/html/corrtest plots_f4e7e934950701185c438c8971c922e1">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>all_corrs <span class="ot">&lt;-</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>  </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="co"># leave off height to get all the remaining ones</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="fu">select</span>(<span class="sc">-</span> height) <span class="sc">%&gt;%</span>  </span>
<span id="cb23-6"><a href="#cb23-6"></a>  </span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="co"># perform a cor.test for all variables against height</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> .,</span>
<span id="cb23-9"><a href="#cb23-9"></a>             <span class="at">.f =</span> \(x) <span class="fu">cor.test</span>(x, Galton<span class="sc">$</span>height)) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>  </span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="co"># tidy up the cor.test outputs into a tidy data frame</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>  <span class="fu">map_dfr</span>(broom<span class="sc">::</span>tidy, <span class="at">.id =</span> <span class="st">"predictor"</span>) </span>
<span id="cb23-13"><a href="#cb23-13"></a></span>
<span id="cb23-14"><a href="#cb23-14"></a>all_corrs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["predictor"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["parameter"],"name":[5],"type":["int"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["method"],"name":[8],"type":["chr"],"align":["left"]},{"label":["alternative"],"name":[9],"type":["chr"],"align":["left"]}],"data":[{"1":"father","2":"0.2753548","3":"8.573704","4":"4.354588e-17","5":"896","6":"0.2137851","7":"0.33474554","8":"Pearson's product-moment correlation","9":"two.sided"},{"1":"mother","2":"0.2016549","3":"6.162793","4":"1.079105e-09","5":"896","6":"0.1380554","7":"0.26359819","8":"Pearson's product-moment correlation","9":"two.sided"},{"1":"nkids","2":"-0.1269101","3":"-3.829800","4":"1.371780e-04","5":"896","6":"-0.1907472","7":"-0.06200411","8":"Pearson's product-moment correlation","9":"two.sided"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>all_corrs <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">gf_point</span>(estimate <span class="sc">~</span> <span class="fu">reorder</span>(predictor, estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">gf_errorbar</span>(conf.high <span class="sc">+</span> conf.low <span class="sc">~</span> <span class="fu">reorder</span>(predictor, estimate),</span>
<span id="cb24-4"><a href="#cb24-4"></a>              <span class="at">color =</span> <span class="sc">~</span> <span class="sc">-</span><span class="fu">log10</span>(p.value),</span>
<span id="cb24-5"><a href="#cb24-5"></a>              <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">gf_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="fu">gf_labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Correlation with height in Galton"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8"></a>  <span class="fu">gf_theme</span>(<span class="fu">theme_minimal</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_gradient</span>(<span class="st">"significance"</span>,<span class="at">low =</span> <span class="st">"grey"</span>, <span class="at">high =</span> <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/corrtest plots-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can clearly see the size of the correlations and the confidence intervals marked in this plot. <code>father</code> has somewhat greater correlation with children’s <code>height</code>, as compared to <code>mother</code>. <code>nkids</code> seems to matter very little. This kind of plot will be very useful when we pursue linear regression models.</p>
<p>Q.4. How can we show this correlation in a set of Scatter Plots + Regression Lines? Can we recreate Galton’s famous diagram?</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-10_2e8117771ccd129098874bcb6b1569b3">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># For the sons</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># For the daughters</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>An approximation to Galton’s famous plot (see Wikipedia):</p>
<div class="cell" data-hash="correlations_cache/html/unnamed-chunk-11_c18101e89b1fbadb37c5be570c69fe7c">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> (father <span class="sc">+</span> mother)<span class="sc">/</span><span class="dv">2</span>, <span class="at">data =</span> Galton) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">gf_density_2d</span>(<span class="at">n =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">gf_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="correlations_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How would you interpret this plot?</p>
</section><section id="case-study--2-dataset-from-nhanes" class="level2"><h2 class="anchored" data-anchor-id="case-study--2-dataset-from-nhanes">Case Study -2: Dataset from <code>NHANES</code>
</h2>
<p>We will “live code” this in class!</p>
</section></section><section id="conclusion" class="level1"><h1>Conclusion</h1>
<p>We have a decent Correlations related <em>workflow</em> in R:<br>
- load the dataset<br>
- <code>inspect</code> the dataset, identify Quant and Qual variables<br>
- Develop Pair-Wise plots + Correlations using <code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">GGally::ggpairs()</a></code><br>
- Develop Correlogram <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot::corrplot</a></code><br>
- Check everything with a <code>cor_test</code><br>
- Plot scatter plots using <code>gf_point</code> if needed.<br>
- Add extra lines using <code>gf_abline()</code> to compare hypotheses that you may have.</p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/av-quarto\.netlify\.app/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="an">title:</span><span class="co"> "Correlations in R"</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="an">author:</span><span class="co"> "Arvind Venkatadri"</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="an">abstract:</span><span class="co"> Tests, Tables, and Graphs for Correlations in R</span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="co">---</span></span>
<span id="cb30-8"><a href="#cb30-8"></a></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="fu"># Introduction</span></span>
<span id="cb30-10"><a href="#cb30-10"></a></span>
<span id="cb30-11"><a href="#cb30-11"></a>We will create Tables for Correlations, and graphs for Correlations in</span>
<span id="cb30-12"><a href="#cb30-12"></a>R. As always, we will consistently use the [**Project</span>
<span id="cb30-13"><a href="#cb30-13"></a>Mosaic**](https://mosaic-web.org) ecosystem of packages in R (<span class="in">`mosaic`</span>,</span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="in">`mosaicData`</span> and <span class="in">`ggformula`</span>).</span>
<span id="cb30-15"><a href="#cb30-15"></a></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="in">```{r}</span></span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="co">#| label: setup</span></span>
<span id="cb30-20"><a href="#cb30-20"></a><span class="co">#| echo: true</span></span>
<span id="cb30-21"><a href="#cb30-21"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-22"><a href="#cb30-22"></a><span class="fu">library</span>(mosaic) <span class="co"># package for stats, simulations, and basic plots</span></span>
<span id="cb30-23"><a href="#cb30-23"></a><span class="fu">library</span>(mosaicData) <span class="co"># package containing datasets</span></span>
<span id="cb30-24"><a href="#cb30-24"></a><span class="fu">library</span>(ggformula) <span class="co"># package for professional looking plots, that use the formula interface from mosaic</span></span>
<span id="cb30-25"><a href="#cb30-25"></a><span class="fu">library</span>(NHANES) <span class="co"># survey data collected by the US National Center for Health Statistics (NCHS)</span></span>
<span id="cb30-26"><a href="#cb30-26"></a><span class="fu">library</span>(corrplot) <span class="co"># For Correlogram plots</span></span>
<span id="cb30-27"><a href="#cb30-27"></a></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="in">```</span></span>
<span id="cb30-29"><a href="#cb30-29"></a></span>
<span id="cb30-30"><a href="#cb30-30"></a>::: {.callout-tip style="background: beige"}</span>
<span id="cb30-31"><a href="#cb30-31"></a>Note the standard method for all commands from the <span class="in">`mosaic`</span> package:</span>
<span id="cb30-32"><a href="#cb30-32"></a></span>
<span id="cb30-33"><a href="#cb30-33"></a><span class="in">`goal( y ~ x | z, data = mydata, …)`</span></span>
<span id="cb30-34"><a href="#cb30-34"></a></span>
<span id="cb30-35"><a href="#cb30-35"></a>With <span class="in">`ggformula`</span>, one can create any graph/chart using:</span>
<span id="cb30-36"><a href="#cb30-36"></a></span>
<span id="cb30-37"><a href="#cb30-37"></a><span class="in">`gf_geometry(y ~ x | z, data = mydata)`</span></span>
<span id="cb30-38"><a href="#cb30-38"></a></span>
<span id="cb30-39"><a href="#cb30-39"></a>OR</span>
<span id="cb30-40"><a href="#cb30-40"></a></span>
<span id="cb30-41"><a href="#cb30-41"></a><span class="in">`mydata %&gt;% gf_geometry( y ~ x | z)`</span></span>
<span id="cb30-42"><a href="#cb30-42"></a></span>
<span id="cb30-43"><a href="#cb30-43"></a>The second method may be preferable, especially if you have done some</span>
<span id="cb30-44"><a href="#cb30-44"></a>data manipulation first! More later!</span>
<span id="cb30-45"><a href="#cb30-45"></a>:::</span>
<span id="cb30-46"><a href="#cb30-46"></a></span>
<span id="cb30-47"><a href="#cb30-47"></a><span class="fu">## Case Study -1: Dataset from `mosaicData`</span></span>
<span id="cb30-48"><a href="#cb30-48"></a></span>
<span id="cb30-49"><a href="#cb30-49"></a>Let us inspect what datasets are available in the package <span class="in">`mosaicData`</span>.</span>
<span id="cb30-50"><a href="#cb30-50"></a>Run this command in your Console:</span>
<span id="cb30-51"><a href="#cb30-51"></a></span>
<span id="cb30-52"><a href="#cb30-52"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb30-53"><a href="#cb30-53"></a><span class="co"># Run in Console</span></span>
<span id="cb30-54"><a href="#cb30-54"></a><span class="fu">data</span>(<span class="at">package =</span> <span class="st">"mosaicData"</span>)</span>
<span id="cb30-55"><a href="#cb30-55"></a></span>
<span id="cb30-56"><a href="#cb30-56"></a><span class="in">```</span></span>
<span id="cb30-57"><a href="#cb30-57"></a></span>
<span id="cb30-58"><a href="#cb30-58"></a>The popup tab shows a lot of datasets we could use. Let us continue to</span>
<span id="cb30-59"><a href="#cb30-59"></a>use the famous <span class="in">`Galton`</span> dataset and <span class="in">`inspect`</span> it:</span>
<span id="cb30-60"><a href="#cb30-60"></a></span>
<span id="cb30-63"><a href="#cb30-63"></a><span class="in">```{r}</span></span>
<span id="cb30-64"><a href="#cb30-64"></a><span class="fu">data</span>(<span class="st">"Galton"</span>)</span>
<span id="cb30-65"><a href="#cb30-65"></a><span class="fu">inspect</span>(Galton)</span>
<span id="cb30-66"><a href="#cb30-66"></a></span>
<span id="cb30-67"><a href="#cb30-67"></a><span class="in">```</span></span>
<span id="cb30-68"><a href="#cb30-68"></a></span>
<span id="cb30-69"><a href="#cb30-69"></a>The <span class="in">`inspect`</span> command already gives us a series of statistical measures</span>
<span id="cb30-70"><a href="#cb30-70"></a>of different variables of interest. As discussed previously, we can</span>
<span id="cb30-71"><a href="#cb30-71"></a>retain the output of <span class="in">`inspect`</span> and use it in our reports: (there are</span>
<span id="cb30-72"><a href="#cb30-72"></a>ways of dressing up these tables too)</span>
<span id="cb30-73"><a href="#cb30-73"></a></span>
<span id="cb30-74"><a href="#cb30-74"></a><span class="in">```{r Galton-inspect}</span></span>
<span id="cb30-75"><a href="#cb30-75"></a></span>
<span id="cb30-76"><a href="#cb30-76"></a>galton_describe <span class="ot">&lt;-</span> <span class="fu">inspect</span>(Galton)</span>
<span id="cb30-77"><a href="#cb30-77"></a></span>
<span id="cb30-78"><a href="#cb30-78"></a>galton_describe<span class="sc">$</span>categorical</span>
<span id="cb30-79"><a href="#cb30-79"></a>galton_describe<span class="sc">$</span>quantitative</span>
<span id="cb30-80"><a href="#cb30-80"></a></span>
<span id="cb30-81"><a href="#cb30-81"></a><span class="in">```</span></span>
<span id="cb30-82"><a href="#cb30-82"></a></span>
<span id="cb30-83"><a href="#cb30-83"></a>Try <span class="in">`help("Galton")`</span> in your Console. The dataset is described as:</span>
<span id="cb30-84"><a href="#cb30-84"></a></span>
<span id="cb30-85"><a href="#cb30-85"></a><span class="at">&gt; A data frame with 898 observations on the following variables.\</span></span>
<span id="cb30-86"><a href="#cb30-86"></a><span class="at">&gt; - </span><span class="in">`family`</span><span class="at"> a factor with levels for each family\</span></span>
<span id="cb30-87"><a href="#cb30-87"></a><span class="at">&gt; - </span><span class="in">`father`</span><span class="at"> the father's height (in inches)\</span></span>
<span id="cb30-88"><a href="#cb30-88"></a><span class="at">&gt; - </span><span class="in">`mother`</span><span class="at"> the mother's height (in inches)\</span></span>
<span id="cb30-89"><a href="#cb30-89"></a><span class="at">&gt; - </span><span class="in">`sex`</span><span class="at"> the child's sex: F or M\</span></span>
<span id="cb30-90"><a href="#cb30-90"></a><span class="at">&gt; - </span><span class="in">`height`</span><span class="at"> the child's height as an adult (in inches)\</span></span>
<span id="cb30-91"><a href="#cb30-91"></a><span class="at">&gt; - </span><span class="in">`nkids`</span><span class="at"> the number of adult children in the family, or, at least,</span></span>
<span id="cb30-92"><a href="#cb30-92"></a><span class="at">&gt; the number whose heights Galton recorded.</span></span>
<span id="cb30-93"><a href="#cb30-93"></a></span>
<span id="cb30-94"><a href="#cb30-94"></a>There is a lot of Description generated by the <span class="in">`mosaic::inspect()`</span></span>
<span id="cb30-95"><a href="#cb30-95"></a>command ! What can we say about the dataset and its variables? How big</span>
<span id="cb30-96"><a href="#cb30-96"></a>is the dataset? How many variables? What types are they, Quant or Qual?</span>
<span id="cb30-97"><a href="#cb30-97"></a>If they are Qual, what are the *levels*? Are they *ordered* levels?</span>
<span id="cb30-98"><a href="#cb30-98"></a>Discuss!</span>
<span id="cb30-99"><a href="#cb30-99"></a></span>
<span id="cb30-100"><a href="#cb30-100"></a><span class="fu">## Correlations and Plots</span></span>
<span id="cb30-101"><a href="#cb30-101"></a></span>
<span id="cb30-102"><a href="#cb30-102"></a>What Questions might we have, that we could answer with a Statistical</span>
<span id="cb30-103"><a href="#cb30-103"></a>Measure, or Correlation chart?</span>
<span id="cb30-104"><a href="#cb30-104"></a></span>
<span id="cb30-105"><a href="#cb30-105"></a>Q.1 Which are the variables that have significant pair-wise</span>
<span id="cb30-106"><a href="#cb30-106"></a>correlations? What polarity are these correlations?</span>
<span id="cb30-107"><a href="#cb30-107"></a></span>
<span id="cb30-108"><a href="#cb30-108"></a><span class="in">```{r,message=FALSE}</span></span>
<span id="cb30-109"><a href="#cb30-109"></a></span>
<span id="cb30-110"><a href="#cb30-110"></a></span>
<span id="cb30-111"><a href="#cb30-111"></a><span class="co"># Pulling out the list of Quant variables from NHANES</span></span>
<span id="cb30-112"><a href="#cb30-112"></a>galton_quant <span class="ot">&lt;-</span> galton_describe<span class="sc">$</span>quantitative</span>
<span id="cb30-113"><a href="#cb30-113"></a>galton_quant<span class="sc">$</span>name</span>
<span id="cb30-114"><a href="#cb30-114"></a></span>
<span id="cb30-115"><a href="#cb30-115"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb30-116"><a href="#cb30-116"></a>  Galton,</span>
<span id="cb30-117"><a href="#cb30-117"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"father"</span>, <span class="st">"mother"</span>, <span class="st">"height"</span>, <span class="st">"nkids"</span>),</span>
<span id="cb30-118"><a href="#cb30-118"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="st">"densityDiag"</span>),</span>
<span id="cb30-119"><a href="#cb30-119"></a>  <span class="at">title =</span> <span class="st">"Galton Data Correlations Plot"</span></span>
<span id="cb30-120"><a href="#cb30-120"></a>)</span>
<span id="cb30-121"><a href="#cb30-121"></a></span>
<span id="cb30-122"><a href="#cb30-122"></a><span class="in">```</span></span>
<span id="cb30-123"><a href="#cb30-123"></a></span>
<span id="cb30-124"><a href="#cb30-124"></a>Can we plot a Correlogram for this dataset?</span>
<span id="cb30-125"><a href="#cb30-125"></a></span>
<span id="cb30-128"><a href="#cb30-128"></a><span class="in">```{r}</span></span>
<span id="cb30-129"><a href="#cb30-129"></a><span class="co">#library(corrplot)</span></span>
<span id="cb30-130"><a href="#cb30-130"></a></span>
<span id="cb30-131"><a href="#cb30-131"></a>galton_num_var <span class="ot">&lt;-</span> Galton <span class="sc">%&gt;%</span> <span class="fu">select</span>(father, mother, height, nkids)</span>
<span id="cb30-132"><a href="#cb30-132"></a>galton_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(galton_num_var)</span>
<span id="cb30-133"><a href="#cb30-133"></a>galton_cor <span class="sc">%&gt;%</span></span>
<span id="cb30-134"><a href="#cb30-134"></a>  <span class="fu">corrplot</span>(<span class="at">method =</span> <span class="st">"ellipse"</span>,</span>
<span id="cb30-135"><a href="#cb30-135"></a>           <span class="at">type =</span> <span class="st">"lower"</span>,</span>
<span id="cb30-136"><a href="#cb30-136"></a>           <span class="at">main =</span> <span class="st">"Correlogram for Galton dataset"</span>)</span>
<span id="cb30-137"><a href="#cb30-137"></a></span>
<span id="cb30-138"><a href="#cb30-138"></a><span class="in">```</span></span>
<span id="cb30-139"><a href="#cb30-139"></a></span>
<span id="cb30-140"><a href="#cb30-140"></a>Clearly <span class="in">`height`</span> is positively correlated to <span class="in">`father`</span> and <span class="in">`mother`</span>;</span>
<span id="cb30-141"><a href="#cb30-141"></a>interestingly, <span class="in">`height`</span> is negatively correlated ( slightly) with</span>
<span id="cb30-142"><a href="#cb30-142"></a><span class="in">`nkids`</span>.</span>
<span id="cb30-143"><a href="#cb30-143"></a></span>
<span id="cb30-144"><a href="#cb30-144"></a>Q.2: Let us confirm with a test:</span>
<span id="cb30-145"><a href="#cb30-145"></a></span>
<span id="cb30-148"><a href="#cb30-148"></a><span class="in">```{r}</span></span>
<span id="cb30-149"><a href="#cb30-149"></a>mosaic<span class="sc">::</span><span class="fu">cor_test</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton)</span>
<span id="cb30-150"><a href="#cb30-150"></a></span>
<span id="cb30-151"><a href="#cb30-151"></a><span class="in">```</span></span>
<span id="cb30-152"><a href="#cb30-152"></a></span>
<span id="cb30-155"><a href="#cb30-155"></a><span class="in">```{r}</span></span>
<span id="cb30-156"><a href="#cb30-156"></a>mosaic<span class="sc">::</span><span class="fu">cor_test</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton)</span>
<span id="cb30-157"><a href="#cb30-157"></a></span>
<span id="cb30-158"><a href="#cb30-158"></a><span class="in">```</span></span>
<span id="cb30-159"><a href="#cb30-159"></a></span>
<span id="cb30-160"><a href="#cb30-160"></a>Q.3 What does this correlation look when split by <span class="in">`sex`</span> of Child?</span>
<span id="cb30-161"><a href="#cb30-161"></a></span>
<span id="cb30-162"><a href="#cb30-162"></a>We will use the <span class="in">`mosaic`</span> function <span class="in">`cor_test`</span> to get these results:</span>
<span id="cb30-163"><a href="#cb30-163"></a></span>
<span id="cb30-166"><a href="#cb30-166"></a><span class="in">```{r}</span></span>
<span id="cb30-167"><a href="#cb30-167"></a><span class="co"># For the sons</span></span>
<span id="cb30-168"><a href="#cb30-168"></a>mosaic<span class="sc">::</span><span class="fu">cor_test</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>))</span>
<span id="cb30-169"><a href="#cb30-169"></a><span class="fu">cor_test</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>))</span>
<span id="cb30-170"><a href="#cb30-170"></a></span>
<span id="cb30-171"><a href="#cb30-171"></a><span class="co"># For the daughters</span></span>
<span id="cb30-172"><a href="#cb30-172"></a><span class="fu">cor_test</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>))</span>
<span id="cb30-173"><a href="#cb30-173"></a><span class="fu">cor_test</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>))</span>
<span id="cb30-174"><a href="#cb30-174"></a>         </span>
<span id="cb30-175"><a href="#cb30-175"></a><span class="in">```</span></span>
<span id="cb30-176"><a href="#cb30-176"></a></span>
<span id="cb30-177"><a href="#cb30-177"></a>::: callout-important</span>
<span id="cb30-178"><a href="#cb30-178"></a><span class="fu">## Correlation Scores and Uncertainty</span></span>
<span id="cb30-179"><a href="#cb30-179"></a></span>
<span id="cb30-180"><a href="#cb30-180"></a>Note how the <span class="in">`cor.test`</span> reports a correlation score and the <span class="in">`p-value`</span></span>
<span id="cb30-181"><a href="#cb30-181"></a>for the same. There is also a <span class="in">`confidence interval`</span> reported for the</span>
<span id="cb30-182"><a href="#cb30-182"></a>correlation score, an interval within which we are 95% sure that the</span>
<span id="cb30-183"><a href="#cb30-183"></a>true correlation value is to be found. Note that GGally too reports the</span>
<span id="cb30-184"><a href="#cb30-184"></a>significance of the correlation scores using <span class="in">`***`</span> or <span class="in">`**`</span>. This</span>
<span id="cb30-185"><a href="#cb30-185"></a>indicates the p-value in the scores obtained by GGally; Presumably,</span>
<span id="cb30-186"><a href="#cb30-186"></a>there is an internal <span class="in">`cor.test`</span> that is run for each pair of variables</span>
<span id="cb30-187"><a href="#cb30-187"></a>and the p-value and confidence levels are also computed internally.</span>
<span id="cb30-188"><a href="#cb30-188"></a>:::</span>
<span id="cb30-189"><a href="#cb30-189"></a></span>
<span id="cb30-190"><a href="#cb30-190"></a>We can also visualise this uncertainty and the confidence levels in a</span>
<span id="cb30-191"><a href="#cb30-191"></a>plot too, using <span class="in">`gf_errorbar`</span> and a handy set of functions within</span>
<span id="cb30-192"><a href="#cb30-192"></a><span class="in">`purrr`</span> which is part of the tidyverse: Assuming <span class="in">`heights`</span> is the</span>
<span id="cb30-193"><a href="#cb30-193"></a>variable we want to correlate every other (quantitative) variable</span>
<span id="cb30-194"><a href="#cb30-194"></a>against, we can proceed very quickly as follows:</span>
<span id="cb30-195"><a href="#cb30-195"></a></span>
<span id="cb30-198"><a href="#cb30-198"></a><span class="in">```{r}</span></span>
<span id="cb30-199"><a href="#cb30-199"></a><span class="co">#| label: corrtest plots</span></span>
<span id="cb30-200"><a href="#cb30-200"></a></span>
<span id="cb30-201"><a href="#cb30-201"></a>all_corrs <span class="ot">&lt;-</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb30-202"><a href="#cb30-202"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-203"><a href="#cb30-203"></a>  </span>
<span id="cb30-204"><a href="#cb30-204"></a>  <span class="co"># leave off height to get all the remaining ones</span></span>
<span id="cb30-205"><a href="#cb30-205"></a>  <span class="fu">select</span>(<span class="sc">-</span> height) <span class="sc">%&gt;%</span>  </span>
<span id="cb30-206"><a href="#cb30-206"></a>  </span>
<span id="cb30-207"><a href="#cb30-207"></a>  <span class="co"># perform a cor.test for all variables against height</span></span>
<span id="cb30-208"><a href="#cb30-208"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> .,</span>
<span id="cb30-209"><a href="#cb30-209"></a>             <span class="at">.f =</span> \(x) <span class="fu">cor.test</span>(x, Galton<span class="sc">$</span>height)) <span class="sc">%&gt;%</span></span>
<span id="cb30-210"><a href="#cb30-210"></a>  </span>
<span id="cb30-211"><a href="#cb30-211"></a>  <span class="co"># tidy up the cor.test outputs into a tidy data frame</span></span>
<span id="cb30-212"><a href="#cb30-212"></a>  <span class="fu">map_dfr</span>(broom<span class="sc">::</span>tidy, <span class="at">.id =</span> <span class="st">"predictor"</span>) </span>
<span id="cb30-213"><a href="#cb30-213"></a></span>
<span id="cb30-214"><a href="#cb30-214"></a>all_corrs</span>
<span id="cb30-215"><a href="#cb30-215"></a></span>
<span id="cb30-216"><a href="#cb30-216"></a>all_corrs <span class="sc">%&gt;%</span> </span>
<span id="cb30-217"><a href="#cb30-217"></a>  <span class="fu">gf_point</span>(estimate <span class="sc">~</span> <span class="fu">reorder</span>(predictor, estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-218"><a href="#cb30-218"></a>  <span class="fu">gf_errorbar</span>(conf.high <span class="sc">+</span> conf.low <span class="sc">~</span> <span class="fu">reorder</span>(predictor, estimate),</span>
<span id="cb30-219"><a href="#cb30-219"></a>              <span class="at">color =</span> <span class="sc">~</span> <span class="sc">-</span><span class="fu">log10</span>(p.value),</span>
<span id="cb30-220"><a href="#cb30-220"></a>              <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-221"><a href="#cb30-221"></a>  <span class="fu">gf_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-222"><a href="#cb30-222"></a>  <span class="fu">gf_labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Correlation with height in Galton"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-223"><a href="#cb30-223"></a>  <span class="fu">gf_theme</span>(<span class="fu">theme_minimal</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb30-224"><a href="#cb30-224"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_gradient</span>(<span class="st">"significance"</span>,<span class="at">low =</span> <span class="st">"grey"</span>, <span class="at">high =</span> <span class="st">"red"</span>))</span>
<span id="cb30-225"><a href="#cb30-225"></a></span>
<span id="cb30-226"><a href="#cb30-226"></a></span>
<span id="cb30-227"><a href="#cb30-227"></a><span class="in">```</span></span>
<span id="cb30-228"><a href="#cb30-228"></a></span>
<span id="cb30-229"><a href="#cb30-229"></a>We can clearly see the size of the correlations and the confidence</span>
<span id="cb30-230"><a href="#cb30-230"></a>intervals marked in this plot. <span class="in">`father`</span> has somewhat greater correlation</span>
<span id="cb30-231"><a href="#cb30-231"></a>with children's <span class="in">`height`</span>, as compared to <span class="in">`mother`</span>. <span class="in">`nkids`</span> seems to</span>
<span id="cb30-232"><a href="#cb30-232"></a>matter very little. This kind of plot will be very useful when we pursue</span>
<span id="cb30-233"><a href="#cb30-233"></a>linear regression models.</span>
<span id="cb30-234"><a href="#cb30-234"></a></span>
<span id="cb30-235"><a href="#cb30-235"></a>Q.4. How can we show this correlation in a set of Scatter Plots +</span>
<span id="cb30-236"><a href="#cb30-236"></a>Regression Lines? Can we recreate Galton's famous diagram?</span>
<span id="cb30-237"><a href="#cb30-237"></a></span>
<span id="cb30-240"><a href="#cb30-240"></a><span class="in">```{r}</span></span>
<span id="cb30-241"><a href="#cb30-241"></a><span class="co"># For the sons</span></span>
<span id="cb30-242"><a href="#cb30-242"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb30-243"><a href="#cb30-243"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb30-244"><a href="#cb30-244"></a></span>
<span id="cb30-245"><a href="#cb30-245"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb30-246"><a href="#cb30-246"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb30-247"><a href="#cb30-247"></a></span>
<span id="cb30-248"><a href="#cb30-248"></a><span class="co"># For the daughters</span></span>
<span id="cb30-249"><a href="#cb30-249"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> father, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb30-250"><a href="#cb30-250"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-251"><a href="#cb30-251"></a>  <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb30-252"><a href="#cb30-252"></a></span>
<span id="cb30-253"><a href="#cb30-253"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> mother, <span class="at">data =</span> Galton <span class="sc">%&gt;%</span> </span>
<span id="cb30-254"><a href="#cb30-254"></a>           <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">"F"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-255"><a href="#cb30-255"></a>  <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb30-256"><a href="#cb30-256"></a></span>
<span id="cb30-257"><a href="#cb30-257"></a><span class="in">```</span></span>
<span id="cb30-258"><a href="#cb30-258"></a></span>
<span id="cb30-259"><a href="#cb30-259"></a>An approximation to Galton's famous plot (see Wikipedia):</span>
<span id="cb30-260"><a href="#cb30-260"></a></span>
<span id="cb30-263"><a href="#cb30-263"></a><span class="in">```{r}</span></span>
<span id="cb30-264"><a href="#cb30-264"></a><span class="fu">gf_point</span>(height <span class="sc">~</span> (father <span class="sc">+</span> mother)<span class="sc">/</span><span class="dv">2</span>, <span class="at">data =</span> Galton) <span class="sc">%&gt;%</span> </span>
<span id="cb30-265"><a href="#cb30-265"></a>  <span class="fu">gf_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-266"><a href="#cb30-266"></a>  <span class="fu">gf_density_2d</span>(<span class="at">n =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-267"><a href="#cb30-267"></a>  <span class="fu">gf_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>)</span>
<span id="cb30-268"><a href="#cb30-268"></a></span>
<span id="cb30-269"><a href="#cb30-269"></a><span class="in">```</span></span>
<span id="cb30-270"><a href="#cb30-270"></a></span>
<span id="cb30-271"><a href="#cb30-271"></a>How would you interpret this plot?</span>
<span id="cb30-272"><a href="#cb30-272"></a></span>
<span id="cb30-273"><a href="#cb30-273"></a><span class="fu">## Case Study -2: Dataset from `NHANES`</span></span>
<span id="cb30-274"><a href="#cb30-274"></a></span>
<span id="cb30-275"><a href="#cb30-275"></a>We will "live code" this in class!</span>
<span id="cb30-276"><a href="#cb30-276"></a></span>
<span id="cb30-277"><a href="#cb30-277"></a><span class="fu"># Conclusion</span></span>
<span id="cb30-278"><a href="#cb30-278"></a></span>
<span id="cb30-279"><a href="#cb30-279"></a>We have a decent Correlations related *workflow* in R:\</span>
<span id="cb30-280"><a href="#cb30-280"></a><span class="ss">- </span>load the dataset\</span>
<span id="cb30-281"><a href="#cb30-281"></a><span class="ss">- </span><span class="in">`inspect`</span> the dataset, identify Quant and Qual variables\</span>
<span id="cb30-282"><a href="#cb30-282"></a><span class="ss">- </span>Develop Pair-Wise plots + Correlations using <span class="in">`GGally::ggpairs()`</span>\</span>
<span id="cb30-283"><a href="#cb30-283"></a><span class="ss">- </span>Develop Correlogram <span class="in">`corrplot::corrplot`</span>\</span>
<span id="cb30-284"><a href="#cb30-284"></a><span class="ss">- </span>Check everything with a <span class="in">`cor_test`</span>\</span>
<span id="cb30-285"><a href="#cb30-285"></a><span class="ss">- </span>Plot scatter plots using <span class="in">`gf_point`</span> if needed.\</span>
<span id="cb30-286"><a href="#cb30-286"></a><span class="ss">- </span>Add extra lines using <span class="in">`gf_abline()`</span> to compare hypotheses that you may</span>
<span id="cb30-287"><a href="#cb30-287"></a>have.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Website made with 💜 and <a href="https://quarto.org/">Quarto</a>, by Arvind Venkatadri. License: <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA 2.0</a>.</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arvindvenkatadri/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/arvind_v">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:arvind.venkatadri@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


<script src="../../../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>