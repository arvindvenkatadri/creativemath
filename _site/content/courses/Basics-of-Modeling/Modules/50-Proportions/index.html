<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Arvind Venkatadri">
<meta name="dcterms.date" content="2022-11-10">
<title>The Foundation Series - üÉè Permutation Test for Two Proportions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="../../../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
<meta property="og:title" content="The Foundation Series - üÉè Permutation Test for Two Proportions">
<meta property="og:description" content="Using Permutation Tests to check the equivalence of two proportions">
<meta property="og:site-name" content="The Foundation Series">
<meta name="twitter:title" content="The Foundation Series - üÉè Permutation Test for Two Proportions">
<meta name="twitter:description" content="Using Permutation Tests to check the equivalence of two proportions">
<meta name="twitter:creator" content="@arvind_v">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">The Foundation Series</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arvindvenkatadri/my-quarto-website"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/arvind_v"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../../../blog.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">üÉè Permutation Test for Two Proportions</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">üÉè Permutation Test for Two Proportions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Arvind Venkatadri </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 10, 2022</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">January 25, 2023</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="abstract-title">Abstract</div>
      Using Permutation Tests to check the equivalence of two proportions
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../blog.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Teaching</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/courses/Descriptive-Analytics/listing.html" class="sidebar-item-text sidebar-link">Descriptive Analytics</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/courses/Basics-of-Modeling/listing.html" class="sidebar-item-text sidebar-link">Basics of Modelling</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/courses/Predictive-Analytics/listing.html" class="sidebar-item-text sidebar-link">Predictive Analytics</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/courses/Prescriptive-Analytics/listing.html" class="sidebar-item-text sidebar-link">Prescriptive Analytics</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/courses/R-for-Artists/listing.html" class="sidebar-item-text sidebar-link">R for Artists</a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/posts/listing.html" class="sidebar-item-text sidebar-link">Posts</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../../content/projects/listing.html" class="sidebar-item-text sidebar-link">Projects</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#testing-for-two-or-more-proportions" id="toc-testing-for-two-or-more-proportions" class="nav-link" data-scroll-target="#testing-for-two-or-more-proportions">Testing for Two or More Proportions</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><section id="fa-folder-open-slides-and-tutorials" class="level2"><h2 class="anchored" data-anchor-id="fa-folder-open-slides-and-tutorials">
<i class="fa-solid fa-folder-open" aria-label="folder-open"></i> Slides and Tutorials</h2>
<table>
<colgroup>
<col style="width: 24%">
<col style="width: 26%">
<col style="width: 24%">
<col style="width: 24%">
</colgroup>
<thead><tr class="header">
<th>
<a href="./files/two-props.qmd"><i class="fa-brands           
           fa-r-project"></i> R Tutorial</a>&nbsp;&nbsp;</th>
<th><a href="./files/two-props.ows"> <iconify-icon icon="fluent-emoji:orange-circle"></iconify-icon> Orange Tutorial</a></th>
<th>
<a href="./files/two-props.rda"> <i class="fa-solid fa-person-rays"></i> Radiant Tutorial</a>&nbsp;</th>
<th><a href="./files/data/sim-data.zip"> <i class="fa-solid fa-database"></i> Datasets</a></th>
</tr></thead>
<tbody></tbody>
</table></section><section id="introduction" class="level1"><h1>Introduction</h1>
<p>We saw from the diagram created by Allen Downey that <em>there is only one test</em>! We will now use this philosophy to develop a technique that allows us to mechanize several <em>Statistical Models</em> in that way, with nearly identical code.</p>
<p>We will use two packages in R, <code>mosaic</code> to develop our intuition for what are called <strong>permutation</strong> based statistical tests. (There is also a more recent package called <code>infer</code> in R which can do pretty much all of this, including visualization. In my opinion, the code is a little too high-level and does not offer quite the detailed insight that the <code>mosaic</code> package does).</p>
</section><section id="testing-for-two-or-more-proportions" class="level1 page-columns page-full"><h1>Testing for Two or More Proportions</h1>
<p>Let us try a dataset with Qualitative / Categorical data. This is the General Social Survey GSS dataset, and we have people with different levels of <code>Education</code> stating their opinion on the <code>Death Penalty</code>. We want to know if these two Categorical variables have a correlation, i.e. can the opinions in favour of the <code>Death Penalty</code> be explained by the <code>Education</code> level?</p>
<p>Since data is Categorical ( both variables ), we need to take <code>counts</code> in a table, and then implement a <code>chi-square test</code>. In the test, we will permute the <code>Education</code> variable to see if we can see how significant its <em>effect size</em> is.</p>
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">data</span>(GSS2002)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">inspect</span>(GSS2002)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
categorical variables:  
            name  class levels    n missing
1         Region factor      7 2765       0
2         Gender factor      2 2765       0
3           Race factor      3 2765       0
4      Education factor      5 2760       5
5        Marital factor      5 2765       0
6       Religion factor     13 2746      19
7          Happy factor      3 1369    1396
8         Income factor     24 1875     890
9       PolParty factor      8 2729      36
10      Politics factor      7 1331    1434
11     Marijuana factor      2  851    1914
12  DeathPenalty factor      2 1308    1457
13        OwnGun factor      3  924    1841
14        GunLaw factor      2  916    1849
15 SpendMilitary factor      3 1324    1441
16     SpendEduc factor      3 1343    1422
17      SpendEnv factor      3 1322    1443
18      SpendSci factor      3 1266    1499
19        Pres00 factor      5 1749    1016
20      Postlife factor      2 1211    1554
                                    distribution
1  North Central (24.7%) ...                    
2  Female (55.6%), Male (44.4%)                 
3  White (79.1%), Black (14.8%) ...             
4  HS (53.8%), Bachelors (16.1%) ...            
5  Married (45.9%), Never Married (25.6%) ...   
6  Protestant (53.2%), Catholic (24.5%) ...     
7  Pretty happy (57.3%) ...                     
8  40000-49999 (9.1%) ...                       
9  Ind (19.3%), Not Str Dem (18.9%) ...         
10 Moderate (39.2%), Conservative (15.8%) ...   
11 Not legal (64%), Legal (36%)                 
12 Favor (68.7%), Oppose (31.3%)                
13 No (65.5%), Yes (33.5%) ...                  
14 Favor (80.5%), Oppose (19.5%)                
15 About right (46.5%) ...                      
16 Too little (73.9%) ...                       
17 Too little (60%) ...                         
18 About right (49.7%) ...                      
19 Bush (50.6%), Gore (44.7%) ...               
20 Yes (80.5%), No (19.5%)                      

quantitative variables:  
  name   class min  Q1 median   Q3  max mean  sd    n missing
1   ID integer   1 692   1383 2074 2765 1383 798 2765       0</code></pre>
</div>
</div>
<p>Note how <em>all</em> variables are Categorical !! <code>Education</code> has five <code>levels</code>, and of course <code>DeathPenalty</code> has three:</p>
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>GSS2002 <span class="sc">%&gt;%</span> <span class="fu">count</span>(Education)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Education"],"name":[1],"type":["fct"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Left HS","2":"400"},{"1":"HS","2":"1485"},{"1":"Jr Col","2":"202"},{"1":"Bachelors","2":"443"},{"1":"Graduate","2":"230"},{"1":"NA","2":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>GSS2002 <span class="sc">%&gt;%</span> <span class="fu">count</span>(DeathPenalty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["DeathPenalty"],"name":[1],"type":["fct"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Favor","2":"899"},{"1":"Oppose","2":"409"},{"1":"NA","2":"1457"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Let us drop NA entries in <code>Education</code> and <code>Death Penalty</code> and set up a <strong>Contingency Table</strong>.</p>
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>gss2002 <span class="ot">&lt;-</span> GSS2002 <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Education, DeathPenalty) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>(., <span class="fu">c</span>(Education, DeathPenalty))</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a>gss_table <span class="ot">&lt;-</span> <span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> Education, <span class="at">data =</span> gss2002)</span>
<span id="cb5-8"><a href="#cb5-8"></a>gss_table <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="fu">addmargins</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>            Education
DeathPenalty Left HS   HS Jr Col Bachelors Graduate  Sum
      Favor      117  511     71       135       64  898
      Oppose      72  200     16        71       50  409
      Sum        189  711     87       206      114 1307</code></pre>
</div>
</div>
<section id="contingency-table-plots" class="level2"><h2 class="anchored" data-anchor-id="contingency-table-plots">Contingency Table Plots</h2>
<p>The Contingency Table can be plotted, as we have seen, using a <code>mosaic</code> plot using several packages:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Using <code>vcd</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Using <code>ggplot</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Using <code>ggmosaic</code></a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>vcd<span class="sc">::</span><span class="fu">mosaic</span>(gss_table, <span class="at">gp =</span> shading_hsv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Need a little more work, to convert the Contigency Table into a tibble:</p>
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># https://stackoverflow.com/questions/19233365/how-to-create-a-marimekko-mosaic-plot-in-ggplot2</span></span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>gss_summary <span class="ot">&lt;-</span> gss2002 <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="at">Education =</span> <span class="fu">factor</span>(</span>
<span id="cb8-6"><a href="#cb8-6"></a>      Education,</span>
<span id="cb8-7"><a href="#cb8-7"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Bachelors"</span>, <span class="st">"Graduate"</span>, <span class="st">"Jr Col"</span>, <span class="st">"HS"</span>, <span class="st">"Left HS"</span>),</span>
<span id="cb8-8"><a href="#cb8-8"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bachelors"</span>, <span class="st">"Graduate"</span>, <span class="st">"Jr Col"</span>, <span class="st">"HS"</span>, <span class="st">"Left HS"</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a>    ),</span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="at">DeathPenalty =</span> <span class="fu">as.factor</span>(DeathPenalty)</span>
<span id="cb8-11"><a href="#cb8-11"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="fu">group_by</span>(Education, DeathPenalty) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># This is good for a chisq test</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>  </span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="co"># Add two more columns to facilitate mosaic/Marrimekko Plot</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="co"># </span></span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="fu">mutate</span>(<span class="at">edu_count =</span> <span class="fu">sum</span>(count), </span>
<span id="cb8-18"><a href="#cb8-18"></a>         <span class="at">edu_prop =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="do">###################################</span></span>
<span id="cb8-22"><a href="#cb8-22"></a></span>
<span id="cb8-23"><a href="#cb8-23"></a></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gss_summary, <span class="fu">aes</span>( <span class="at">x =</span> Education, <span class="at">y =</span> edu_prop)) <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>  </span>
<span id="cb8-26"><a href="#cb8-26"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">width =</span> edu_count, <span class="at">fill =</span> DeathPenalty), </span>
<span id="cb8-27"><a href="#cb8-27"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>, </span>
<span id="cb8-28"><a href="#cb8-28"></a>           <span class="at">position =</span> <span class="st">"fill"</span>, </span>
<span id="cb8-29"><a href="#cb8-29"></a>           <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30"></a>  </span>
<span id="cb8-31"><a href="#cb8-31"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(edu_prop)), </span>
<span id="cb8-32"><a href="#cb8-32"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb8-33"><a href="#cb8-33"></a></span>
<span id="cb8-34"><a href="#cb8-34"></a></span>
<span id="cb8-35"><a href="#cb8-35"></a><span class="co"># if labels are desired</span></span>
<span id="cb8-36"><a href="#cb8-36"></a> <span class="fu">facet_grid</span>(<span class="sc">~</span> Education, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free_x"</span>) <span class="sc">+</span> </span>
<span id="cb8-37"><a href="#cb8-37"></a>  <span class="fu">theme</span>(<span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"RdYlGn"</span>)) <span class="sc">+</span> </span>
<span id="cb8-38"><a href="#cb8-38"></a>  <span class="co"># theme(panel.spacing.x = unit(0, "npc")) + # if no spacing preferred between bars</span></span>
<span id="cb8-39"><a href="#cb8-39"></a>  <span class="fu">theme_void</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">#library(ggmosaic)</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gss2002) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">geom_mosaic</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">product</span>(DeathPenalty, Education), <span class="at">fill =</span> DeathPenalty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/mosaic-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="observed-statistic-the-x2-metric" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="observed-statistic-the-x2-metric">Observed Statistic: the <span class="math inline">\(X^2\)</span> metric</h2>
<p>When there are multiple proportions involved, the <span class="math inline">\(X^2\)</span> test is what is used.</p>
<div class="panel-tabset page-columns page-full">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Intuitive Explanation</a></li>
</ul>
<div class="tab-content page-columns page-full">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Let us now perform the base <code>chisq test</code>: We need a <code>table</code> and then the <code>chisq</code> test: We see that our observed <span class="math inline">\(X^2 = 23.45\)</span>:</p>
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># gss_table &lt;- tally(DeathPenalty ~ Education, data = gss2002)</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># gss_table</span></span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># Get the observed chi-square statistic</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>observedChi2 <span class="ot">&lt;-</span> mosaic<span class="sc">::</span><span class="fu">chisq</span>(<span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> Education, <span class="at">data =</span> gss2002))</span>
<span id="cb10-6"><a href="#cb10-6"></a>observedChi2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>X.squared 
       23 </code></pre>
</div>
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Actual chi-square test</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>stats<span class="sc">::</span><span class="fu">chisq.test</span>(<span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> Education, <span class="at">data =</span> gss2002))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  tally(DeathPenalty ~ Education, data = gss2002)
X-squared = 23, df = 4, p-value = 1e-04</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane page-columns page-full" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Let us look at the Contingency Table that we have:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>            Education
DeathPenalty Left HS   HS Jr Col Bachelors Graduate  Sum
      Favor      117  511     71       135       64  898
      Oppose      72  200     16        71       50  409
      Sum        189  711     87       206      114 1307</code></pre>
</div>
</div>
<p>In the chi-square test, we check whether the two ( or more ) categorical variables are independent. To do this we perform a simple check on the Contingency Table. We first <em>re-compute</em> the totals in each row and column, based on what we could <strong>expect</strong> if there was independence (NULL Hypothesis). If the two variables were independent, then there should be <strong>no difference</strong> between real and expected scores.</p>
<p>How do we know what scores to expect?</p>
<p>Consider the entry in location (1,1): 117. The number of <strong>expected</strong> entries there is probability of an entry landing in that square times the total number of entries:</p>
<div class="column-body-outset">
<span class="math display">\[\begin{align}

\text{Expected Value at location[1,1]}
&amp;= p_{row_1} * p_{col_1} * \text{Total Scores}\\\
&amp;= \frac{\text{Row-1-Total}}{\text{Total Scores}} * \frac{\text{Col-1-Total}}{\text{Total Scores}} * \text{Total Scores}\\\
&amp;= \frac{898}{1307} * \frac{189}{1307} * 1307\\\
&amp;= 130.45


\end{align}\]</span>
</div>
<p>Proceeding in this way for all the 15 entries in the Contingency Table, we get the ‚ÄúExpected‚Äù Contingency Table. Here are both tables for comparison:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>            Education
DeathPenalty Left HS   HS Jr Col Bachelors Graduate  Sum
      Favor      130  489     60       142       78  898
      Oppose      59  222     27        64       36  409
      Sum        189  711     87       206      114 1307</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            Education
DeathPenalty Left HS   HS Jr Col Bachelors Graduate  Sum
      Favor      117  511     71       135       64  898
      Oppose      72  200     16        71       50  409
      Sum        189  711     87       206      114 1307</code></pre>
</div>
</div>
<p>The <span class="math inline">\(X^2\)</span> statistic is sum of squared differences between <code>Observed</code> and <code>Expected</code> scores, scaled by the <code>Expected Scores</code>. For location [1,1] this would be: <span class="math inline">\((117-130)^2/189\)</span>. Do try to compute all of these and the <span class="math inline">\(X^2\)</span> statistic by hand !!</p>
</div>
</div>
</div>
<section id="hypotheses-definition" class="level3"><h3 class="anchored" data-anchor-id="hypotheses-definition">Hypotheses Definition</h3>
<p>What would our Hypotheses be?</p>
<p><span class="math display">\[
    H_0: \text{Education does not affect votes for Death Penalty} \\
    H_a: \text{Education affects votes for Death Penalty}
\]</span></p>
</section><section id="permutation-test-for-education" class="level3"><h3 class="anchored" data-anchor-id="permutation-test-for-education">Permutation Test for <code>Education</code>
</h3>
<p>We should now repeat the test with permutations on <code>Education</code>:</p>
<div class="cell" data-layout-align="center">
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>null_chisq <span class="ot">&lt;-</span> <span class="fu">do</span>(<span class="dv">10000</span>) <span class="sc">*</span> <span class="fu">chisq.test</span>(<span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> <span class="fu">shuffle</span>(Education), <span class="at">data =</span> gss2002))</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">head</span>(null_chisq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["X.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[2],"type":["int"],"align":["right"]},{"label":["p.value"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["method"],"name":[4],"type":["chr"],"align":["left"]},{"label":["alternative"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["data"],"name":[6],"type":["chr"],"align":["left"]},{"label":[".row"],"name":[7],"type":["int"],"align":["right"]},{"label":[".index"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"3.56","2":"4","3":"0.47","4":"Pearson's Chi-squared test","5":"NA","6":"tally(DeathPenalty ~ shuffle(Education), data = gss2002)","7":"1","8":"1","_rn_":"X-squared...1"},{"1":"1.25","2":"4","3":"0.87","4":"Pearson's Chi-squared test","5":"NA","6":"tally(DeathPenalty ~ shuffle(Education), data = gss2002)","7":"1","8":"2","_rn_":"X-squared...2"},{"1":"0.46","2":"4","3":"0.98","4":"Pearson's Chi-squared test","5":"NA","6":"tally(DeathPenalty ~ shuffle(Education), data = gss2002)","7":"1","8":"3","_rn_":"X-squared...3"},{"1":"0.23","2":"4","3":"0.99","4":"Pearson's Chi-squared test","5":"NA","6":"tally(DeathPenalty ~ shuffle(Education), data = gss2002)","7":"1","8":"4","_rn_":"X-squared...4"},{"1":"4.34","2":"4","3":"0.36","4":"Pearson's Chi-squared test","5":"NA","6":"tally(DeathPenalty ~ shuffle(Education), data = gss2002)","7":"1","8":"5","_rn_":"X-squared...5"},{"1":"0.40","2":"4","3":"0.98","4":"Pearson's Chi-squared test","5":"NA","6":"tally(DeathPenalty ~ shuffle(Education), data = gss2002)","7":"1","8":"6","_rn_":"X-squared...6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">gf_histogram</span>( <span class="sc">~</span> X.squared, <span class="at">data =</span> null_chisq) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">gf_vline</span>(<span class="at">xintercept =</span> observedChi2, <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details><summary>Show the Code</summary><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">prop1</span>(<span class="sc">~</span> X.squared <span class="sc">&gt;=</span> observedChi2, <span class="at">data =</span> null_chisq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>prop_TRUE 
    2e-04 </code></pre>
</div>
</div>
<p>The <code>p-value</code> is well below our threshold of <span class="math inline">\(0.05\%\)</span>, so we would conclude that <code>Education</code> has a significant effect on <code>DeathPenalty</code> opinion!</p>
</section></section><section id="conclusion" class="level2"><h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Why would a permutation test be a good idea here?</p>
<p>In our basic X^2 test, we calculate the test statistic of X^2 and look up a <em>theoretical</em> null distribution for that statistic, and see how unlikely our observed value is.</p>
<p>With a permutation test, there are <em>no assumptions</em> of the null distribution: this is computed based on real data. We note in passing that, in this case, since the number of <code>cases</code> in each cell of the Contingency Table are fairly high ( &gt;= 5) the resulting NULL distribution is of the <span class="math inline">\(X^2\)</span> variety.</p>
</section><section id="references" class="level2"><h2 class="anchored" data-anchor-id="references">References</h2>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/av-quarto\.netlify\.app/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><script src="https://utteranc.es/client.js" repo="arvindvenkatadri/Issues" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb21" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="an">title:</span><span class="co"> "\U0001F0CF Permutation Test for Two Proportions"</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="an">author:</span><span class="co"> "Arvind Venkatadri"</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="an">date:</span><span class="co"> 10/Nov/2022</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="an">date-modified:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="an">abstract:</span><span class="co"> "Using Permutation Tests to check the equivalence of two proportions"</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="an">order:</span><span class="co"> 50</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">#fig-format: retina</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="an">code-summary:</span><span class="co"> Show the Code</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="an">code-block-border-left:</span><span class="co"> true</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="an">code-overflow:</span><span class="co"> scroll</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="an">code-block-bg:</span><span class="co"> "beige"</span></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="an">code-line-numbers:</span><span class="co"> true</span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="an">code-copy:</span><span class="co"> true</span></span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="an">fig-align:</span><span class="co"> center</span></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="an">reference-location:</span><span class="co"> margin</span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="an">cap-location:</span><span class="co"> margin</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="an">highlight-style:</span><span class="co"> tango</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="an">df-print:</span><span class="co"> paged</span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="an">section-divs:</span><span class="co"> true</span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="an">number-sections:</span><span class="co"> false</span></span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co">  freeze: auto</span></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="an">tags:</span></span>
<span id="cb21-28"><a href="#cb21-28"></a><span class="co">- Permutation</span></span>
<span id="cb21-29"><a href="#cb21-29"></a><span class="co">- Monte Carlo Simulation</span></span>
<span id="cb21-30"><a href="#cb21-30"></a><span class="co">- Random Number Generation</span></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="co">- Distributions</span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="co">- Generating Parallel Worlds</span></span>
<span id="cb21-33"><a href="#cb21-33"></a><span class="co">---</span></span>
<span id="cb21-34"><a href="#cb21-34"></a></span>
<span id="cb21-35"><a href="#cb21-35"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb21-36"><a href="#cb21-36"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,<span class="at">message =</span> <span class="cn">TRUE</span>,<span class="at">warning =</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-37"><a href="#cb21-37"></a>                    <span class="at">fig.align =</span> <span class="st">"center"</span>)</span>
<span id="cb21-38"><a href="#cb21-38"></a><span class="fu">options</span>(<span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb21-39"><a href="#cb21-39"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-40"><a href="#cb21-40"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb21-41"><a href="#cb21-41"></a><span class="fu">library</span>(ggmosaic) <span class="co"># plotting mosaic plots for Categorical Data</span></span>
<span id="cb21-42"><a href="#cb21-42"></a><span class="fu">library</span>(vcd) <span class="co"># Creating Tables and plotting mosaic charts</span></span>
<span id="cb21-43"><a href="#cb21-43"></a></span>
<span id="cb21-44"><a href="#cb21-44"></a><span class="do">### Dataset from Chihara and Hesterberg's book (Second Edition)</span></span>
<span id="cb21-45"><a href="#cb21-45"></a><span class="fu">library</span>(resampledata)</span>
<span id="cb21-46"><a href="#cb21-46"></a></span>
<span id="cb21-47"><a href="#cb21-47"></a><span class="in">```</span></span>
<span id="cb21-48"><a href="#cb21-48"></a></span>
<span id="cb21-49"><a href="#cb21-49"></a><span class="fu">## {{&lt; fa folder-open &gt;}} Slides and Tutorials</span></span>
<span id="cb21-50"><a href="#cb21-50"></a></span>
<span id="cb21-51"><a href="#cb21-51"></a>| <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">"./files/two-props.qmd"</span><span class="kw">&gt;&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"fa-brands           </span></span>
<span id="cb21-52"><a href="#cb21-52"></a><span class="st">           fa-r-project"</span><span class="kw">&gt;&lt;/i&gt;</span> R Tutorial<span class="kw">&lt;/a&gt;</span>&nbsp;&nbsp;                  | <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">"./files/two-props.ows"</span><span class="kw">&gt;</span> <span class="kw">&lt;iconify-icon</span> <span class="er">icon</span><span class="ot">=</span><span class="st">"fluent-emoji:orange-circle"</span><span class="kw">&gt;&lt;/iconify-icon&gt;</span> Orange Tutorial<span class="kw">&lt;/a&gt;</span> | <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">"./files/two-props.rda"</span><span class="kw">&gt;</span> <span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"fa-solid fa-person-rays"</span><span class="kw">&gt;&lt;/i&gt;</span> Radiant Tutorial<span class="kw">&lt;/a&gt;</span>&nbsp; | <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">"./files/data/sim-data.zip"</span><span class="kw">&gt;</span> <span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"fa-solid fa-database"</span><span class="kw">&gt;&lt;/i&gt;</span> Datasets<span class="kw">&lt;/a&gt;</span> |</span>
<span id="cb21-53"><a href="#cb21-53"></a>|------------------|-------------------|------------------|------------------|</span>
<span id="cb21-54"><a href="#cb21-54"></a></span>
<span id="cb21-55"><a href="#cb21-55"></a><span class="fu"># Introduction</span></span>
<span id="cb21-56"><a href="#cb21-56"></a></span>
<span id="cb21-57"><a href="#cb21-57"></a>We saw from the diagram created by Allen Downey that *there is only one</span>
<span id="cb21-58"><a href="#cb21-58"></a>test*! We will now use this philosophy to develop a technique that</span>
<span id="cb21-59"><a href="#cb21-59"></a>allows us to mechanize several *Statistical Models* in that way, with</span>
<span id="cb21-60"><a href="#cb21-60"></a>nearly identical code.</span>
<span id="cb21-61"><a href="#cb21-61"></a></span>
<span id="cb21-62"><a href="#cb21-62"></a>We will use two packages in R, <span class="in">`mosaic`</span> to develop our intuition for</span>
<span id="cb21-63"><a href="#cb21-63"></a>what are called **permutation** based statistical tests. (There is also</span>
<span id="cb21-64"><a href="#cb21-64"></a>a more recent package called <span class="in">`infer`</span> in R which can do pretty much all</span>
<span id="cb21-65"><a href="#cb21-65"></a>of this, including visualization. In my opinion, the code is a little</span>
<span id="cb21-66"><a href="#cb21-66"></a>too high-level and does not offer quite the detailed insight that the</span>
<span id="cb21-67"><a href="#cb21-67"></a><span class="in">`mosaic`</span> package does).</span>
<span id="cb21-68"><a href="#cb21-68"></a></span>
<span id="cb21-69"><a href="#cb21-69"></a><span class="fu"># Testing for Two or More Proportions</span></span>
<span id="cb21-70"><a href="#cb21-70"></a></span>
<span id="cb21-71"><a href="#cb21-71"></a>Let us try a dataset with Qualitative / Categorical data. This is the</span>
<span id="cb21-72"><a href="#cb21-72"></a>General Social Survey GSS dataset, and we have people with different</span>
<span id="cb21-73"><a href="#cb21-73"></a>levels of <span class="in">`Education`</span> stating their opinion on the <span class="in">`Death Penalty`</span>. We</span>
<span id="cb21-74"><a href="#cb21-74"></a>want to know if these two Categorical variables have a correlation, i.e.</span>
<span id="cb21-75"><a href="#cb21-75"></a>can the opinions in favour of the <span class="in">`Death Penalty`</span> be explained by the</span>
<span id="cb21-76"><a href="#cb21-76"></a><span class="in">`Education`</span> level?</span>
<span id="cb21-77"><a href="#cb21-77"></a></span>
<span id="cb21-78"><a href="#cb21-78"></a>Since data is Categorical ( both variables ), we need to take <span class="in">`counts`</span></span>
<span id="cb21-79"><a href="#cb21-79"></a>in a table, and then implement a <span class="in">`chi-square test`</span>. In the test, we will</span>
<span id="cb21-80"><a href="#cb21-80"></a>permute the <span class="in">`Education`</span> variable to see if we can see how significant</span>
<span id="cb21-81"><a href="#cb21-81"></a>its *effect size* is.</span>
<span id="cb21-82"><a href="#cb21-82"></a></span>
<span id="cb21-85"><a href="#cb21-85"></a><span class="in">```{r}</span></span>
<span id="cb21-86"><a href="#cb21-86"></a><span class="fu">data</span>(GSS2002)</span>
<span id="cb21-87"><a href="#cb21-87"></a><span class="fu">inspect</span>(GSS2002)</span>
<span id="cb21-88"><a href="#cb21-88"></a></span>
<span id="cb21-89"><a href="#cb21-89"></a><span class="in">```</span></span>
<span id="cb21-90"><a href="#cb21-90"></a></span>
<span id="cb21-91"><a href="#cb21-91"></a>Note how *all* variables are Categorical !! <span class="in">`Education`</span> has five</span>
<span id="cb21-92"><a href="#cb21-92"></a><span class="in">`levels`</span>, and of course <span class="in">`DeathPenalty`</span> has three:</span>
<span id="cb21-93"><a href="#cb21-93"></a></span>
<span id="cb21-96"><a href="#cb21-96"></a><span class="in">```{r}</span></span>
<span id="cb21-97"><a href="#cb21-97"></a>GSS2002 <span class="sc">%&gt;%</span> <span class="fu">count</span>(Education)</span>
<span id="cb21-98"><a href="#cb21-98"></a>GSS2002 <span class="sc">%&gt;%</span> <span class="fu">count</span>(DeathPenalty)</span>
<span id="cb21-99"><a href="#cb21-99"></a></span>
<span id="cb21-100"><a href="#cb21-100"></a><span class="in">```</span></span>
<span id="cb21-101"><a href="#cb21-101"></a></span>
<span id="cb21-102"><a href="#cb21-102"></a>Let us drop NA entries in <span class="in">`Education`</span> and <span class="in">`Death Penalty`</span> and set up a</span>
<span id="cb21-103"><a href="#cb21-103"></a>**Contingency Table**.</span>
<span id="cb21-104"><a href="#cb21-104"></a></span>
<span id="cb21-105"><a href="#cb21-105"></a><span class="in">```{r,warning=FALSE,message=FALSE}</span></span>
<span id="cb21-106"><a href="#cb21-106"></a></span>
<span id="cb21-107"><a href="#cb21-107"></a></span>
<span id="cb21-108"><a href="#cb21-108"></a>gss2002 <span class="ot">&lt;-</span> GSS2002 <span class="sc">%&gt;%</span> </span>
<span id="cb21-109"><a href="#cb21-109"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Education, DeathPenalty) <span class="sc">%&gt;%</span> </span>
<span id="cb21-110"><a href="#cb21-110"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>(., <span class="fu">c</span>(Education, DeathPenalty))</span>
<span id="cb21-111"><a href="#cb21-111"></a></span>
<span id="cb21-112"><a href="#cb21-112"></a></span>
<span id="cb21-113"><a href="#cb21-113"></a></span>
<span id="cb21-114"><a href="#cb21-114"></a>gss_table <span class="ot">&lt;-</span> <span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> Education, <span class="at">data =</span> gss2002)</span>
<span id="cb21-115"><a href="#cb21-115"></a>gss_table <span class="sc">%&gt;%</span> </span>
<span id="cb21-116"><a href="#cb21-116"></a>  <span class="fu">addmargins</span>()</span>
<span id="cb21-117"><a href="#cb21-117"></a></span>
<span id="cb21-118"><a href="#cb21-118"></a><span class="in">```</span></span>
<span id="cb21-119"><a href="#cb21-119"></a></span>
<span id="cb21-120"><a href="#cb21-120"></a><span class="fu">## Contingency Table Plots</span></span>
<span id="cb21-121"><a href="#cb21-121"></a></span>
<span id="cb21-122"><a href="#cb21-122"></a>The Contingency Table can be plotted, as we have seen, using a <span class="in">`mosaic`</span></span>
<span id="cb21-123"><a href="#cb21-123"></a>plot using several packages:</span>
<span id="cb21-124"><a href="#cb21-124"></a></span>
<span id="cb21-125"><a href="#cb21-125"></a>::: panel-tabset</span>
<span id="cb21-126"><a href="#cb21-126"></a><span class="fu">### Using `vcd`</span></span>
<span id="cb21-127"><a href="#cb21-127"></a></span>
<span id="cb21-130"><a href="#cb21-130"></a><span class="in">```{r}</span></span>
<span id="cb21-131"><a href="#cb21-131"></a>vcd<span class="sc">::</span><span class="fu">mosaic</span>(gss_table, <span class="at">gp =</span> shading_hsv)</span>
<span id="cb21-132"><a href="#cb21-132"></a></span>
<span id="cb21-133"><a href="#cb21-133"></a><span class="in">```</span></span>
<span id="cb21-134"><a href="#cb21-134"></a></span>
<span id="cb21-135"><a href="#cb21-135"></a><span class="fu">### Using `ggplot`</span></span>
<span id="cb21-136"><a href="#cb21-136"></a></span>
<span id="cb21-137"><a href="#cb21-137"></a>Need a little more work, to convert the Contigency Table into a tibble:</span>
<span id="cb21-138"><a href="#cb21-138"></a></span>
<span id="cb21-139"><a href="#cb21-139"></a><span class="in">```{r warning=FALSE,message=FALSE}</span></span>
<span id="cb21-140"><a href="#cb21-140"></a><span class="co"># https://stackoverflow.com/questions/19233365/how-to-create-a-marimekko-mosaic-plot-in-ggplot2</span></span>
<span id="cb21-141"><a href="#cb21-141"></a></span>
<span id="cb21-142"><a href="#cb21-142"></a>gss_summary <span class="ot">&lt;-</span> gss2002 <span class="sc">%&gt;%</span></span>
<span id="cb21-143"><a href="#cb21-143"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-144"><a href="#cb21-144"></a>    <span class="at">Education =</span> <span class="fu">factor</span>(</span>
<span id="cb21-145"><a href="#cb21-145"></a>      Education,</span>
<span id="cb21-146"><a href="#cb21-146"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Bachelors"</span>, <span class="st">"Graduate"</span>, <span class="st">"Jr Col"</span>, <span class="st">"HS"</span>, <span class="st">"Left HS"</span>),</span>
<span id="cb21-147"><a href="#cb21-147"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bachelors"</span>, <span class="st">"Graduate"</span>, <span class="st">"Jr Col"</span>, <span class="st">"HS"</span>, <span class="st">"Left HS"</span>)</span>
<span id="cb21-148"><a href="#cb21-148"></a>    ),</span>
<span id="cb21-149"><a href="#cb21-149"></a>    <span class="at">DeathPenalty =</span> <span class="fu">as.factor</span>(DeathPenalty)</span>
<span id="cb21-150"><a href="#cb21-150"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-151"><a href="#cb21-151"></a>  <span class="fu">group_by</span>(Education, DeathPenalty) <span class="sc">%&gt;%</span></span>
<span id="cb21-152"><a href="#cb21-152"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># This is good for a chisq test</span></span>
<span id="cb21-153"><a href="#cb21-153"></a>  </span>
<span id="cb21-154"><a href="#cb21-154"></a>  <span class="co"># Add two more columns to facilitate mosaic/Marrimekko Plot</span></span>
<span id="cb21-155"><a href="#cb21-155"></a>  <span class="co"># </span></span>
<span id="cb21-156"><a href="#cb21-156"></a>  <span class="fu">mutate</span>(<span class="at">edu_count =</span> <span class="fu">sum</span>(count), </span>
<span id="cb21-157"><a href="#cb21-157"></a>         <span class="at">edu_prop =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb21-158"><a href="#cb21-158"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb21-159"><a href="#cb21-159"></a></span>
<span id="cb21-160"><a href="#cb21-160"></a><span class="do">###################################</span></span>
<span id="cb21-161"><a href="#cb21-161"></a></span>
<span id="cb21-162"><a href="#cb21-162"></a></span>
<span id="cb21-163"><a href="#cb21-163"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gss_summary, <span class="fu">aes</span>( <span class="at">x =</span> Education, <span class="at">y =</span> edu_prop)) <span class="sc">+</span></span>
<span id="cb21-164"><a href="#cb21-164"></a>  </span>
<span id="cb21-165"><a href="#cb21-165"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">width =</span> edu_count, <span class="at">fill =</span> DeathPenalty), </span>
<span id="cb21-166"><a href="#cb21-166"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>, </span>
<span id="cb21-167"><a href="#cb21-167"></a>           <span class="at">position =</span> <span class="st">"fill"</span>, </span>
<span id="cb21-168"><a href="#cb21-168"></a>           <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb21-169"><a href="#cb21-169"></a>  </span>
<span id="cb21-170"><a href="#cb21-170"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(edu_prop)), </span>
<span id="cb21-171"><a href="#cb21-171"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb21-172"><a href="#cb21-172"></a></span>
<span id="cb21-173"><a href="#cb21-173"></a></span>
<span id="cb21-174"><a href="#cb21-174"></a><span class="co"># if labels are desired</span></span>
<span id="cb21-175"><a href="#cb21-175"></a> <span class="fu">facet_grid</span>(<span class="sc">~</span> Education, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free_x"</span>) <span class="sc">+</span> </span>
<span id="cb21-176"><a href="#cb21-176"></a>  <span class="fu">theme</span>(<span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"RdYlGn"</span>)) <span class="sc">+</span> </span>
<span id="cb21-177"><a href="#cb21-177"></a>  <span class="co"># theme(panel.spacing.x = unit(0, "npc")) + # if no spacing preferred between bars</span></span>
<span id="cb21-178"><a href="#cb21-178"></a>  <span class="fu">theme_void</span>() </span>
<span id="cb21-179"><a href="#cb21-179"></a></span>
<span id="cb21-180"><a href="#cb21-180"></a><span class="in">```</span></span>
<span id="cb21-181"><a href="#cb21-181"></a></span>
<span id="cb21-182"><a href="#cb21-182"></a><span class="fu">### Using `ggmosaic`</span></span>
<span id="cb21-183"><a href="#cb21-183"></a></span>
<span id="cb21-184"><a href="#cb21-184"></a><span class="in">```{r mosaic-plot,warning=FALSE}</span></span>
<span id="cb21-185"><a href="#cb21-185"></a><span class="co">#library(ggmosaic)</span></span>
<span id="cb21-186"><a href="#cb21-186"></a></span>
<span id="cb21-187"><a href="#cb21-187"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gss2002) <span class="sc">+</span></span>
<span id="cb21-188"><a href="#cb21-188"></a>  <span class="fu">geom_mosaic</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">product</span>(DeathPenalty, Education), <span class="at">fill =</span> DeathPenalty))</span>
<span id="cb21-189"><a href="#cb21-189"></a></span>
<span id="cb21-190"><a href="#cb21-190"></a><span class="in">```</span></span>
<span id="cb21-191"><a href="#cb21-191"></a>:::</span>
<span id="cb21-192"><a href="#cb21-192"></a></span>
<span id="cb21-193"><a href="#cb21-193"></a><span class="fu">## Observed Statistic: the $X^2$ metric</span></span>
<span id="cb21-194"><a href="#cb21-194"></a></span>
<span id="cb21-195"><a href="#cb21-195"></a>When there are multiple proportions involved, the $X^2$ test is what is</span>
<span id="cb21-196"><a href="#cb21-196"></a>used.</span>
<span id="cb21-197"><a href="#cb21-197"></a></span>
<span id="cb21-198"><a href="#cb21-198"></a>::: panel-tabset</span>
<span id="cb21-199"><a href="#cb21-199"></a><span class="fu">### Code</span></span>
<span id="cb21-200"><a href="#cb21-200"></a></span>
<span id="cb21-201"><a href="#cb21-201"></a>Let us now perform the base <span class="in">`chisq test`</span>: We need a <span class="in">`table`</span> and then the</span>
<span id="cb21-202"><a href="#cb21-202"></a><span class="in">`chisq`</span> test: We see that our observed $X^2 = 23.45$:</span>
<span id="cb21-203"><a href="#cb21-203"></a></span>
<span id="cb21-206"><a href="#cb21-206"></a><span class="in">```{r}</span></span>
<span id="cb21-207"><a href="#cb21-207"></a><span class="co"># gss_table &lt;- tally(DeathPenalty ~ Education, data = gss2002)</span></span>
<span id="cb21-208"><a href="#cb21-208"></a><span class="co"># gss_table</span></span>
<span id="cb21-209"><a href="#cb21-209"></a></span>
<span id="cb21-210"><a href="#cb21-210"></a><span class="co"># Get the observed chi-square statistic</span></span>
<span id="cb21-211"><a href="#cb21-211"></a>observedChi2 <span class="ot">&lt;-</span> mosaic<span class="sc">::</span><span class="fu">chisq</span>(<span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> Education, <span class="at">data =</span> gss2002))</span>
<span id="cb21-212"><a href="#cb21-212"></a>observedChi2</span>
<span id="cb21-213"><a href="#cb21-213"></a></span>
<span id="cb21-214"><a href="#cb21-214"></a><span class="co"># Actual chi-square test</span></span>
<span id="cb21-215"><a href="#cb21-215"></a>stats<span class="sc">::</span><span class="fu">chisq.test</span>(<span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> Education, <span class="at">data =</span> gss2002))</span>
<span id="cb21-216"><a href="#cb21-216"></a></span>
<span id="cb21-217"><a href="#cb21-217"></a><span class="in">```</span></span>
<span id="cb21-218"><a href="#cb21-218"></a></span>
<span id="cb21-219"><a href="#cb21-219"></a><span class="fu">### Intuitive Explanation</span></span>
<span id="cb21-220"><a href="#cb21-220"></a></span>
<span id="cb21-221"><a href="#cb21-221"></a>Let us look at the Contingency Table that we have:</span>
<span id="cb21-222"><a href="#cb21-222"></a></span>
<span id="cb21-223"><a href="#cb21-223"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb21-224"><a href="#cb21-224"></a></span>
<span id="cb21-225"><a href="#cb21-225"></a>gss_table <span class="sc">%&gt;%</span> <span class="fu">addmargins</span>()</span>
<span id="cb21-226"><a href="#cb21-226"></a></span>
<span id="cb21-227"><a href="#cb21-227"></a><span class="in">```</span></span>
<span id="cb21-228"><a href="#cb21-228"></a></span>
<span id="cb21-229"><a href="#cb21-229"></a>In the chi-square test, we check whether the two ( or more ) categorical</span>
<span id="cb21-230"><a href="#cb21-230"></a>variables are independent. To do this we perform a simple check on the</span>
<span id="cb21-231"><a href="#cb21-231"></a>Contingency Table. We first *re-compute* the totals in each row and</span>
<span id="cb21-232"><a href="#cb21-232"></a>column, based on what we could **expect** if there was independence</span>
<span id="cb21-233"><a href="#cb21-233"></a>(NULL Hypothesis). If the two variables were independent, then there</span>
<span id="cb21-234"><a href="#cb21-234"></a>should be **no difference** between real and expected scores.</span>
<span id="cb21-235"><a href="#cb21-235"></a></span>
<span id="cb21-236"><a href="#cb21-236"></a>How do we know what scores to expect?</span>
<span id="cb21-237"><a href="#cb21-237"></a></span>
<span id="cb21-238"><a href="#cb21-238"></a>Consider the entry in location (1,1): 117. The number of **expected**</span>
<span id="cb21-239"><a href="#cb21-239"></a>entries there is probability of an entry landing in that square times</span>
<span id="cb21-240"><a href="#cb21-240"></a>the total number of entries:</span>
<span id="cb21-241"><a href="#cb21-241"></a></span>
<span id="cb21-242"><a href="#cb21-242"></a>::: column-body-outset</span>
<span id="cb21-243"><a href="#cb21-243"></a><span class="in">```{=tex}</span></span>
<span id="cb21-244"><a href="#cb21-244"></a><span class="in">\begin{align}</span></span>
<span id="cb21-245"><a href="#cb21-245"></a></span>
<span id="cb21-246"><a href="#cb21-246"></a><span class="in">\text{Expected Value at location[1,1]}</span></span>
<span id="cb21-247"><a href="#cb21-247"></a><span class="in">&amp;= p_{row_1} * p_{col_1} * \text{Total Scores}\\\</span></span>
<span id="cb21-248"><a href="#cb21-248"></a><span class="in">&amp;= \frac{\text{Row-1-Total}}{\text{Total Scores}} * \frac{\text{Col-1-Total}}{\text{Total Scores}} * \text{Total Scores}\\\</span></span>
<span id="cb21-249"><a href="#cb21-249"></a><span class="in">&amp;= \frac{898}{1307} * \frac{189}{1307} * 1307\\\</span></span>
<span id="cb21-250"><a href="#cb21-250"></a><span class="in">&amp;= 130.45</span></span>
<span id="cb21-251"><a href="#cb21-251"></a></span>
<span id="cb21-252"><a href="#cb21-252"></a></span>
<span id="cb21-253"><a href="#cb21-253"></a><span class="in">\end{align}</span></span>
<span id="cb21-254"><a href="#cb21-254"></a><span class="in">```</span></span>
<span id="cb21-255"><a href="#cb21-255"></a>:::</span>
<span id="cb21-256"><a href="#cb21-256"></a></span>
<span id="cb21-257"><a href="#cb21-257"></a>Proceeding in this way for all the 15 entries in the Contingency Table,</span>
<span id="cb21-258"><a href="#cb21-258"></a>we get the "Expected" Contingency Table. Here are both tables for</span>
<span id="cb21-259"><a href="#cb21-259"></a>comparison:</span>
<span id="cb21-260"><a href="#cb21-260"></a></span>
<span id="cb21-261"><a href="#cb21-261"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb21-262"><a href="#cb21-262"></a><span class="co"># using prop.table with appropriate margin argument gives us a slick matrix of probabilities</span></span>
<span id="cb21-263"><a href="#cb21-263"></a></span>
<span id="cb21-264"><a href="#cb21-264"></a>gss_exp <span class="ot">&lt;-</span> gss_table <span class="sc">*</span> gss_table <span class="sc">/</span> ((</span>
<span id="cb21-265"><a href="#cb21-265"></a>  <span class="fu">prop.table</span>(gss_table, <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">prop.table</span>(gss_table, <span class="at">margin =</span> <span class="dv">1</span>)</span>
<span id="cb21-266"><a href="#cb21-266"></a>) <span class="sc">*</span> <span class="dv">1307</span>)</span>
<span id="cb21-267"><a href="#cb21-267"></a></span>
<span id="cb21-268"><a href="#cb21-268"></a>gss_exp <span class="sc">%&gt;%</span> <span class="fu">addmargins</span>()</span>
<span id="cb21-269"><a href="#cb21-269"></a>gss_table <span class="sc">%&gt;%</span> <span class="fu">addmargins</span>()</span>
<span id="cb21-270"><a href="#cb21-270"></a></span>
<span id="cb21-271"><a href="#cb21-271"></a></span>
<span id="cb21-272"><a href="#cb21-272"></a></span>
<span id="cb21-273"><a href="#cb21-273"></a><span class="in">```</span></span>
<span id="cb21-274"><a href="#cb21-274"></a></span>
<span id="cb21-275"><a href="#cb21-275"></a>The $X^2$ statistic is sum of squared differences between <span class="in">`Observed`</span> and</span>
<span id="cb21-276"><a href="#cb21-276"></a><span class="in">`Expected`</span> scores, scaled by the <span class="in">`Expected Scores`</span>. For location <span class="sc">\[</span>1,1<span class="sc">\]</span></span>
<span id="cb21-277"><a href="#cb21-277"></a>this would be: $(117-130)^2/189$. Do try to compute all of these and the</span>
<span id="cb21-278"><a href="#cb21-278"></a>$X^2$ statistic by hand !!</span>
<span id="cb21-279"><a href="#cb21-279"></a>:::</span>
<span id="cb21-280"><a href="#cb21-280"></a></span>
<span id="cb21-281"><a href="#cb21-281"></a><span class="fu">### Hypotheses Definition</span></span>
<span id="cb21-282"><a href="#cb21-282"></a></span>
<span id="cb21-283"><a href="#cb21-283"></a>What would our Hypotheses be?</span>
<span id="cb21-284"><a href="#cb21-284"></a></span>
<span id="cb21-285"><a href="#cb21-285"></a>$$</span>
<span id="cb21-286"><a href="#cb21-286"></a>    H_0: \text{Education does not affect votes for Death Penalty} <span class="sc">\\</span></span>
<span id="cb21-287"><a href="#cb21-287"></a>    H_a: \text{Education affects votes for Death Penalty}</span>
<span id="cb21-288"><a href="#cb21-288"></a>$$</span>
<span id="cb21-289"><a href="#cb21-289"></a></span>
<span id="cb21-290"><a href="#cb21-290"></a><span class="fu">### Permutation Test for `Education`</span></span>
<span id="cb21-291"><a href="#cb21-291"></a></span>
<span id="cb21-292"><a href="#cb21-292"></a>We should now repeat the test with permutations on <span class="in">`Education`</span>:</span>
<span id="cb21-293"><a href="#cb21-293"></a></span>
<span id="cb21-296"><a href="#cb21-296"></a><span class="in">```{r}</span></span>
<span id="cb21-297"><a href="#cb21-297"></a>null_chisq <span class="ot">&lt;-</span> <span class="fu">do</span>(<span class="dv">10000</span>) <span class="sc">*</span> <span class="fu">chisq.test</span>(<span class="fu">tally</span>(DeathPenalty <span class="sc">~</span> <span class="fu">shuffle</span>(Education), <span class="at">data =</span> gss2002))</span>
<span id="cb21-298"><a href="#cb21-298"></a></span>
<span id="cb21-299"><a href="#cb21-299"></a><span class="fu">head</span>(null_chisq)</span>
<span id="cb21-300"><a href="#cb21-300"></a></span>
<span id="cb21-301"><a href="#cb21-301"></a><span class="fu">gf_histogram</span>( <span class="sc">~</span> X.squared, <span class="at">data =</span> null_chisq) <span class="sc">%&gt;%</span> </span>
<span id="cb21-302"><a href="#cb21-302"></a>  <span class="fu">gf_vline</span>(<span class="at">xintercept =</span> observedChi2, <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb21-303"><a href="#cb21-303"></a></span>
<span id="cb21-304"><a href="#cb21-304"></a><span class="fu">prop1</span>(<span class="sc">~</span> X.squared <span class="sc">&gt;=</span> observedChi2, <span class="at">data =</span> null_chisq)</span>
<span id="cb21-305"><a href="#cb21-305"></a></span>
<span id="cb21-306"><a href="#cb21-306"></a><span class="in">```</span></span>
<span id="cb21-307"><a href="#cb21-307"></a></span>
<span id="cb21-308"><a href="#cb21-308"></a>The <span class="in">`p-value`</span> is well below our threshold of $0.05\%$, so we would</span>
<span id="cb21-309"><a href="#cb21-309"></a>conclude that <span class="in">`Education`</span> has a significant effect on <span class="in">`DeathPenalty`</span></span>
<span id="cb21-310"><a href="#cb21-310"></a>opinion!</span>
<span id="cb21-311"><a href="#cb21-311"></a></span>
<span id="cb21-312"><a href="#cb21-312"></a><span class="fu">## Conclusion</span></span>
<span id="cb21-313"><a href="#cb21-313"></a></span>
<span id="cb21-314"><a href="#cb21-314"></a>Why would a permutation test be a good idea here?</span>
<span id="cb21-315"><a href="#cb21-315"></a></span>
<span id="cb21-316"><a href="#cb21-316"></a>In our basic X\^2 test, we calculate the test statistic of X\^2 and look</span>
<span id="cb21-317"><a href="#cb21-317"></a>up a *theoretical* null distribution for that statistic, and see how</span>
<span id="cb21-318"><a href="#cb21-318"></a>unlikely our observed value is.</span>
<span id="cb21-319"><a href="#cb21-319"></a></span>
<span id="cb21-320"><a href="#cb21-320"></a>With a permutation test, there are *no assumptions* of the null</span>
<span id="cb21-321"><a href="#cb21-321"></a>distribution: this is computed based on real data. We note in passing</span>
<span id="cb21-322"><a href="#cb21-322"></a>that, in this case, since the number of <span class="in">`cases`</span> in each cell of the</span>
<span id="cb21-323"><a href="#cb21-323"></a>Contingency Table are fairly high ( <span class="sc">\&gt;</span>= 5) the resulting NULL</span>
<span id="cb21-324"><a href="#cb21-324"></a>distribution is of the $X^2$ variety.</span>
<span id="cb21-325"><a href="#cb21-325"></a></span>
<span id="cb21-326"><a href="#cb21-326"></a><span class="fu">## References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="../../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>